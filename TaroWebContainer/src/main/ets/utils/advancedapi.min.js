var global,_dec,_class,_dec$1,_dec2,_class$1,_dec$2,_dec2$1,_class$2,_dec$3,_dec2$2,_dec3,_dec4,_dec5,_dec6,_dec7,_dec8,_dec9,_dec10,_dec11,_dec12,_dec13,_dec14,_class$3,_dec$4,_class$4,_dec$5,_dec2$3,_class$5,_dec$6,_dec2$4,_dec3$1,_class$6;void 0===global&&(global=globalThis);
import abilityFeatureAbility from "@ohos.ability.featureAbility";
import deviceInfo from "@ohos.deviceInfo";
import display from "@ohos.display";
import I18n from "@ohos.i18n";
import abilityAccessCtrl from "@ohos.abilityAccessCtrl";
import bluetooth from "@ohos.bluetooth";
import geoLocationManager from "@ohos.geoLocationManager";
import wifiManager from "@ohos.wifiManager";
import window from "@ohos.window";
import wantAgent from "@ohos.app.ability.wantAgent";
import backgroundTaskManager from "@ohos.resourceschedule.backgroundTaskManager";
import network from "@system.network";
import radio from "@ohos.telephony.radio";
import wifi from "@ohos.wifi";
import call from "@ohos.telephony.call";
import pasteboard from "@ohos.pasteboard";
import prompt from "@system.prompt";
import promptAction from "@ohos.promptAction";
import router from "@ohos.router";
import fs from "@ohos.file.fs";
import fileuri from "@ohos.file.fileuri";
import http from "@ohos.net.http";
import request$1 from "@ohos.request";
import mediaLibrary from "@ohos.multimedia.mediaLibrary";
import webSocket from "@ohos.net.webSocket";
import bluetoothManager from "@ohos.bluetoothManager";
import access from "@ohos.bluetooth.access";
import ble from "@ohos.bluetooth.ble";
import connection from "@ohos.bluetooth.connection";
import battery from "@ohos.batteryInfo";
import userIAM_userAuth from "@ohos.userIAM.userAuth";
import prompt$1 from "@ohos.prompt";
import sensor from "@ohos.sensor";
import contact from "@ohos.contact";
import vibrator from "@ohos.vibrator";
import inputMethod from "@ohos.inputMethod";
import authentication from "@hms.core.authentication";
import wantConstant from "@ohos.ability.wantConstant";
import bundleManager from "@ohos.bundle.bundleManager";
import image from "@ohos.multimedia.image";
import picker from "@ohos.file.picker";
import media from "@ohos.multimedia.media";
import audio from "@ohos.multimedia.audio";
import avSession from "@ohos.multimedia.avsession";
import cryptoFramework from "@ohos.security.cryptoFramework";
import buffer from "@ohos.buffer";
import util from "@ohos.util";
import settings from "@ohos.settings";
import scanCore from "@hms.core.scan.scanCore";
import scanBarcode from "@hms.core.scan.scanBarcode";
function _toPrimitive(e,t){if("object"!=typeof e||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);if("object"!=typeof(o=o.call(e,t||"default")))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}function _toPropertyKey(e){return"symbol"==typeof(e=_toPrimitive(e,"string"))?e:e+""}function _defineProperty(e,t,o){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _applyDecoratedDescriptor(o,a,e,t,r){var s={};return Object.keys(t).forEach(function(e){s[e]=t[e]}),s.enumerable=!!s.enumerable,s.configurable=!!s.configurable,("value"in s||s.initializer)&&(s.writable=!0),s=e.slice().reverse().reduce(function(e,t){return t(o,a,e)||e},s),r&&void 0!==s.initializer&&(s.value=s.initializer?s.initializer.call(r):void 0,s.initializer=void 0),void 0===s.initializer&&(Object.defineProperty(o,a,s),s=null),s}let context=abilityFeatureAbility.getContext();function initContextOnStageModel(e){(context=e).startAbilityForResult||(context.startAbilityForResult=context.startAbility),context.getAbilityInfo=function(){return new Promise((e,t)=>{try{e(this.abilityInfo)}catch(e){t(e)}})},context.getFilesDir=function(){return new Promise((e,t)=>{try{e(this.filesDir)}catch(e){t(e)}})},context.getCacheDir=function(){return new Promise((e,t)=>{try{e(this.cacheDir)}catch(e){t(e)}})}}class AbilityBase{static getAbilityInfo(){return new Promise((t,o)=>{this.hasAbilityInfo?t(this.abilityInfo):context.getAbilityInfo().then(e=>{this.hasAbilityInfo=!0,this.abilityInfo=e,console.log("[QAFAPI] getAbilityInfo successful. "),t(e)}).catch(e=>{console.error("[QAFAPI] getAbilityInfo failed. Cause: "+JSON.stringify(e)),o(e)})})}}_defineProperty(AbilityBase,"abilityInfo",{}),_defineProperty(AbilityBase,"hasAbilityInfo",!1);class DeivceBase{static getDeviceInfo(){return deviceInfo}}class DisplayBase{static ohosGetDisplay(){let e=null;try{e=display.getDefaultDisplaySync()}catch(e){console.error("[QAFAPI] display error message: "+JSON.stringify(e))}return e}}class ASDevice{async getSystemInfo(){return this.getSystemInfoSync()}getSystemInfoSync(){var{brand:e,productModel:t,osFullName:o,deviceType:a,udid:r,sdkApiVersion:s}=DeivceBase.getDeviceInfo(),i=o.split("-")[0],n=i,c=o.split("-")[1],l=c,d=I18n.System.getSystemLanguage(),{rotation:u,densityPixels:h}=p=DisplayBase.ohosGetDisplay(),{width:p,height:g}=p,p=Math.round(p/h),g=Math.round(g/h),u=1===u||3===u?"landscape":"portrait",{signatureInfo:f,versionName:A,versionCode:m,appInfo:y}=globalThis.bundleInfoForSelf,y=context.resourceManager.getStringSync(y.labelId),f=f.appId,S=context.config.language,{width:v,height:P,top:b}=null==(v=globalThis.lastWindow.getWindowProperties())?void 0:v.windowRect,{isFullScreen:C,isLayoutFullScreen:E}=globalThis.lastWindow.getWindowProperties(),I=globalThis.lastWindow.getWindowAvoidArea(window.AvoidAreaType.TYPE_SYSTEM),I=Math.round(((null==I||null==(I=I.topRect)?void 0:I.height)||0)/h),C=C||E?Math.round(P/h):Math.round((P+I)/h),b=Math.round(b/h),E={deviceType:a,deviceBrand:e,brand:e,deviceModel:t,platform:n,model:t,deviceOrientation:u,devicePixelRatio:h,pixelRatio:h,system:o,osName:n,osVersion:l,version:l,osLanguage:d,language:d,ohosAPILevel:s,romName:i,romVersion:c,appId:f,appName:y,appVersion:A,appVersionCode:m,appLanguage:S,screenWidth:p,screenHeight:g,windowWidth:Math.round(v/h),windowHeight:Math.round(P/h),windowTop:b,windowBottom:C,statusBarHeight:I};return r&&(E.deviceId=r),E}getDeviceInfo(){console.debug("[AdvancedAPI] start ASDevice getDeviceInfo");var{brand:e,productModel:t,osFullName:o,deviceType:a,osFullName:r,udid:s}=DeivceBase.getDeviceInfo(),i=e,n=t,r=r.split("-")[0],{densityPixels:c,rotation:l}=DisplayBase.ohosGetDisplay(),r={platform:r,deviceBrand:i,deviceModel:t,deviceType:a,deviceOrientation:1===l||3===l?"landscape":"portrait",devicePixelRatio:c,system:o,brand:e,model:n};return s&&(r.deviceId=s),r}getWindowInfo(){console.debug("[AdvancedAPI] start ASDevice getWindowInfo");var e=(t=DisplayBase.ohosGetDisplay()).densityPixels,{width:t,height:o}=t,{width:a,height:r,top:s}=null==(a=globalThis.lastWindow.getWindowProperties())?void 0:a.windowRect,{isFullScreen:i,isLayoutFullScreen:n}=globalThis.lastWindow.getWindowProperties(),c=globalThis.lastWindow.getWindowAvoidArea(window.AvoidAreaType.TYPE_SYSTEM),c=Math.round(((null==c||null==(c=c.topRect)?void 0:c.height)||0)/e),i=i||n?Math.round(r/e):Math.round((r+c)/e),s=Math.round(s/e),a=Math.round(a/e),r=Math.round(r/e);return{pixelRatio:e,screenWidth:Math.round(t/e),screenHeight:Math.round(o/e),windowWidth:a,windowHeight:r,windowTop:s,windowBottom:i,statusBarHeight:c}}getAppBaseInfo(){console.debug("[AdvancedAPI] start ASDevice getAppBaseInfo");var{signatureInfo:e,versionName:t,versionCode:o,appInfo:a}=globalThis.bundleInfoForSelf,r=a.debug,a=context.resourceManager.getStringSync(a.labelId),e=e.appId,s=context.config.language,i=(Environment.envProp("colorMode",-1),AppStorage.get("colorMode"));return{appId:e,appName:a,appVersion:t,appVersionCode:o,appLanguage:s,enableDebug:r,theme:0===i?"light":1===i?"dark":"auto"}}getAppAuthorizeSetting(){console.debug("[AdvancedAPI] start ASDevice getAppAuthorizeSetting");var e=abilityAccessCtrl.createAtManager(),t=globalThis.bundleInfoForSelf.appInfo.accessTokenId,o=e=>-1===e?"denied":0===e?"authorized":"config error";let a="not determined";try{a=o(a=e.checkAccessTokenSync(t,"ohos.permission.WRITE_IMAGEVIDEO"))}catch(e){console.debug("[AdvancedAPI] ASDevice getAppAuthorizeSetting checkAccessToken album fail")}let r="not determined";try{r=o(r=e.checkAccessTokenSync(t,"ohos.permission.USE_BLUETOOTH"))}catch(e){console.debug("[AdvancedAPI] ASDevice getAppAuthorizeSetting checkAccessToken bluetooth fail")}let s="not determined";try{s=o(s=e.checkAccessTokenSync(t,"ohos.permission.CAMERA"))}catch(e){console.debug("[AdvancedAPI] ASDevice getAppAuthorizeSetting checkAccessToken camera fail")}let i="not determined";try{i=o(i=e.checkAccessTokenSync(t,"ohos.permission.LOCATION"))}catch(e){console.debug("[AdvancedAPI] ASDevice getAppAuthorizeSetting checkAccessToken location fail")}let n="not determined";try{n=0===e.checkAccessTokenSync(t,"ohos.permission.APPROXIMATELY_LOCATION")?"full":"reduced"}catch(e){console.debug("[AdvancedAPI] ASDevice getAppAuthorizeSetting checkAccessToken locationAccuracy fail")}let c="not determined";try{c=o(c=e.checkAccessTokenSync(t,"ohos.permission.MICROPHONE"))}catch(e){console.debug("[AdvancedAPI] ASDevice getAppAuthorizeSetting checkAccessToken microphone fail")}let l="not determined";try{l=o(l=e.checkAccessTokenSync(t,"ohos.permission.NOTIFICATION_CONTROLLER"))}catch(e){console.debug("[AdvancedAPI] ASDevice getAppAuthorizeSetting checkAccessToken notification fail")}let d="not determined";try{d=o(d=e.checkAccessTokenSync(t,"ohos.permission.READ_CALENDAR"))}catch(e){console.debug("[AdvancedAPI] ASDevice getAppAuthorizeSetting checkAccessToken phoneCalendar fail")}return{albumAuthorized:a,bluetoothAuthorized:r,cameraAuthorized:s,locationAuthorized:i,locationAccuracy:n,microphoneAuthorized:c,notificationAuthorized:l,phoneCalendarAuthorized:d}}getSystemSetting(){let e,t,o,a,r;try{e=!(2!==(e=bluetooth.getState())&&5!==e)}catch(e){console.error("errCode:"+e.code+",errMessage:"+e.message),a=e.message}try{t=geoLocationManager.isLocationEnabled()}catch(e){console.error("errCode:"+e.code+",errMessage:"+e.message),r=e.message}try{o=wifiManager.isWifiActive()}catch(e){console.error("errCode:"+e.code+",errMessage:"+e.message)}var s=DisplayBase.ohosGetDisplay().rotation;return{bluetoothEnabled:e,bluetoothError:a,locationEnabled:t,locationError:r,wifiEnabled:o,deviceOrientation:1===s||3===s?"landscape":"portrait"}}openAppAuthorizeSetting(){var e={deviceId:"",action:"action.settings.app.info",parameters:{settingsParamBundleName:context.applicationInfo.name}};return context.startAbilityForResult(e)}}const ErrorCode$1={SHARE_INSTALLED_ERROR:-1001,SUCCESS:0,COMMON_ERROR:200,USER_REJECT:201,PARAMETER_ERROR:202,SERVICE_UNAVIALABLE:203,SERVICE_TIMEOUT:204,NOT_SUPPORT_SERVICE_COUNTRY:205,NOT_IN_WHITE_LIST:206,SYSTEM_PERMISSION_DENIAL:207,IO_ERROR:300,FILE_NOT_FOUND:301,FILE_EXIST:302,FILE_EXTENSION_NOT_EXIST:303,FILE_PATH_NOT_LEGAL:304,WEB_PAGE_NOT_FOUND:404,QUICKAPP_IN_BACKGROUND:500,LOCATION_SWITCH_CLOSED:1e3,PAY_CHECKKEY_FAIL:1001,SIM_NOT_FOUND:1001,SIGNIN_AUTH_FAIL:1002,OPERATORS_GET_FAIL:1002,ALARM_SYSTEM_ERROR:1003,AGD_COMMON_ERROR:2001,WIDGET_NOT_SUPPORT:2001,CARD_CALL_QUICK_APP_CENTER_FAIL:2003,BI_REPORT_ERROR:4001,PAY_CANCEL_CODE:3e4,PAY_CERTIFICATION_CODE:30102},BLHErrorCode={OK:0,OTHER_ERRORS:200,NOT_INIT:1e4,NOT_AVAILABLE:10001,NO_DEVICE:10002,CONNECTION_FAIL:10003,NO_SERVICE:10004,NO_CHARACTERISTIC:10005,NO_CONNECTION:10006,PROPERTY_NOT_SUPPORT:10007,SYSTEM_ERROR:10008,SYSTEM_NOT_SUPPORT:10009,LOCATION_NOT_TURN_ON:10010,NO_SUCH_INTERFACE:10100,DEVICE_DOES_NOT_EXIST:10101,NOT_AVAILABLE_TIRAMISU:10102},WifiErrorCode={PASSWORD_ERROR:1e3,CONNECTION_TIMEOUT:1001,DUPLICATE_REQUEST:1002,WIFI_NOT_TURNED_ON:1003,GPS_NOT_TURNED_ON:1004,INVALID_SSID:1005};function dataToArray(e){return Array.isArray(e)?e:[e]}class Result{static success(e,t=!1,o=!1){return{method:"success",arguments:dataToArray(e),ignoreComplete:t,ifKeepAlive:o}}static fail(e,t=!1,o=!1){return{method:"fail",arguments:dataToArray(e),ignoreComplete:t,ifKeepAlive:o}}static cancel(e,t=!1,o=!1){return{method:"cancel",arguments:dataToArray(e),ignoreComplete:t,ifKeepAlive:o}}static callback(e,t=!1,o=!1){return{method:"callback",arguments:dataToArray(e),ignoreComplete:t,ifKeepAlive:o}}static destroy(e,t=!1,o=!1){return{method:"destroy",arguments:dataToArray(e),ignoreComplete:t,ifKeepAlive:o}}}class ASLocation{constructor(){this.locationChangeCallbacks=[],this.locationChangeErrorCallback=(e,t)=>{},this.bothCallback=(t,e)=>{if(e)this.locationChangeErrorCallback({errMsg:e[2].arguments[0],errCode:e[2].arguments[1]});else for(let e=0;e<this.locationChangeCallbacks.length;e++)this.locationChangeCallbacks[e].invokeAndKeepAlive(Result.success(t))}}getLocation(){return console.debug("[AdvancedAPI] start ASLocation getLocation"),abilityAccessCtrl.createAtManager().requestPermissionsFromUser(context,["ohos.permission.APPROXIMATELY_LOCATION","ohos.permission.LOCATION"]).then(t=>{var o=t.authResults,a=o.length;for(let e=0;e<a;e++)if(0!==o[e]&&"ohos.permission.APPROXIMATELY_LOCATION"===t.permissions[e])return Promise.reject([["Permissions check failed,auth deny",ErrorCode$1.USER_REJECT]]);try{return geoLocationManager.getCurrentLocation({priority:515,scenario:768,maxAccuracy:0}).then(e=>(console.debug("[AdvancedAPI]  current location: %s",JSON.stringify(e)),Promise.resolve(e))).catch(e=>(console.debug("[AdvancedAPI]  promise, getCurrentLocation: error= %s",JSON.stringify(e)),Promise.reject([[e.message,ErrorCode$1.SERVICE_UNAVIALABLE]])))}catch(e){return console.error("[AdvancedAPI] errCode:"+e.code+",errMessage:"+e.message),Promise.reject([[e.message,ErrorCode$1.SERVICE_UNAVIALABLE]])}})}onLocationChange(e){console.debug("[AdvancedAPI] start ASLocation onLocationChange"),this.locationChangeCallbacks.push(e)}offLocationChange(e){console.debug("[AdvancedAPI] start ASLocation offLocationChange"),e?0<=(e=this.locationChangeCallbacks.indexOf(e))&&this.locationChangeCallbacks.splice(e,1):this.locationChangeCallbacks=[]}onLocationChangeError(e){console.debug("[AdvancedAPI] start ASLocation onLocationChangeError"),this.locationChangeErrorCallback=e}offLocationChangeError(){console.debug("[AdvancedAPI] start ASLocation offLocationChangeError"),this.locationChangeErrorCallback=(e,t)=>{}}startLocationUpdate(){console.debug("[AdvancedAPI] start ASLocation startLocationUpdate");var e=abilityAccessCtrl.createAtManager();try{return e.requestPermissionsFromUser(context,["ohos.permission.APPROXIMATELY_LOCATION","ohos.permission.LOCATION"]).then(t=>{var o=t.authResults,a=o.length;for(let e=0;e<a;e++)if(0!==o[e]&&"ohos.permission.APPROXIMATELY_LOCATION"===t.permissions[e])return Promise.reject([["Permissions check failed,auth deny",ErrorCode$1.USER_REJECT]]);try{return geoLocationManager.on("locationChange",{priority:515,scenario:768,timeInterval:0,distanceInterval:0,maxAccuracy:0},this.bothCallback),Promise.resolve("SUCCESS")}catch(e){return Promise.reject([[e.message,e.code]])}})}catch(e){return Promise.reject([["startLocationUpdate failed",ErrorCode$1.COMMON_ERROR]])}}startLocationUpdateBackground(){console.debug("[AdvancedAPI] start ASLocation startLocationUpdateBackground");var e=abilityAccessCtrl.createAtManager();try{return e.requestPermissionsFromUser(context,["ohos.permission.APPROXIMATELY_LOCATION","ohos.permission.LOCATION","ohos.permission.LOCATION_IN_BACKGROUND"]).then(t=>{var o=t.authResults,a=o.length;for(let e=0;e<a;e++)if(0!==o[e]&&("ohos.permission.APPROXIMATELY_LOCATION"===t.permissions[e]||"ohos.permission.LOCATION_IN_BACKGROUND"===t.permissions[e]))return Promise.reject([["Permissions check failed,auth deny",ErrorCode$1.USER_REJECT]]);AbilityBase.getAbilityInfo().then(e=>{e={wants:[{bundleName:e.bundleName,abilityName:e.name}],operationType:wantAgent.OperationType.START_ABILITY,requestCode:0,wantAgentFlags:[wantAgent.WantAgentFlags.UPDATE_PRESENT_FLAG]},wantAgent.getWantAgent(e).then(e=>backgroundTaskManager.startBackgroundRunning(context,backgroundTaskManager.BackgroundMode.LOCATION,e)).then(()=>{console.debug("[AdvancedAPI]  start bg operation succeeded")}).catch(e=>{console.error("[AdvancedAPI]  start bg operation failed Cause: "+e)})});try{return geoLocationManager.on("locationChange",{priority:515,scenario:768,timeInterval:0,distanceInterval:0,maxAccuracy:0},this.bothCallback),Promise.resolve("SUCCESS")}catch(e){return Promise.reject([[e.message,e.code]])}})}catch(e){return Promise.reject([["startLocationUpdateBackground failed",ErrorCode$1.COMMON_ERROR]])}}stopLocationUpdate(e){console.debug("[AdvancedAPI] start ASLocation stopLocationUpdate"),backgroundTaskManager.stopBackgroundRunning(context).then(()=>{console.debug("[AdvancedAPI]  stop operation succeeded")}).catch(e=>{console.error("[AdvancedAPI]  stop operation fail cause: "+JSON.stringify(e))});try{return geoLocationManager.off("locationChange"),Promise.resolve("SUCCESS")}catch(e){return Promise.reject([["stopLocationUpdate failed",ErrorCode$1.COMMON_ERROR]])}}}class NetworkBase{static ohoSubscribe(e){const{callback:t,fail:o}=e;network.subscribe({success:function(e){console.log("[QAFAPI] success to subscribe network:"+e.metered+"type:,"+e.type),t&&t(e)},fail:function(e,t){console.error("[QAFAPI] fail to subscribe network, code:"+t+", err:"+e),o&&o(e)}})}}const netWorkConnState={UNKNOWN:0,GSM:1,CDMA:2,WCDMA:3,TDSCDMA:4,LTE:5,NR:6};class RadioBase{static ohoGetSignalInformation(e){return new Promise((o,a)=>{radio.getSignalInformation(e,(e,t)=>{e?(console.log("[QAFAPI] Failed to get signal information Data. Cause:"+JSON.stringify(e)),a(e)):(console.log("[QAFAPI] Success to get signal information Data:"+JSON.stringify(t)),o(t))})})}static ohoIsNrSupported(e){try{return radio.isNrSupported(e)}catch(e){console.error("[QAFAPI] Failed get is supported 5G:"+e)}}}class WifiBase{static isWifiActive(){return wifi.isWifiActive()}static scan(){return wifi.scan()}static ohoGetLinkedInfo(){return new Promise((o,a)=>{wifi.getLinkedInfo((e,t)=>{e?(console.log("[QAFAPI] get linked info error:"+e),a(e)):(console.log("[QAFAPI] get wifi linked info: "+JSON.stringify(t)),o(t))})})}static connectionChange(e){wifi.on("wifiConnectionChange",e)}static scanStateChange(e){wifi.on("wifiScanStateChange",e)}static getScanInfos(){return new Promise((t,o)=>{wifi.getScanInfos().then(e=>{t(e)}).catch(e=>{console.info("[QAFAPI] getScanInfos error "+JSON.stringify(e)),o(e)})})}}function jsMethod(s){return(e,t,o)=>{var a=s&&s.common?e.constructor._jsBaseMethods=e.constructor._jsBaseMethods||{}:e.constructor._jsMethods=e.constructor._jsMethods||{},e=void 0!==(s=void 0!==s?s:{}).alias?s.alias:t,r=void 0===s.callback||s.callback;a[e]={methodName:t,callback:r}}}_defineProperty(WifiBase,"ConnState",{SCANNING:0,CONNECTING:1,AUTHENTICATING:2,OBTAINING_IPADDR:3,CONNECTED:4,DISCONNECTING:5,DISCONNECTED:6,UNKNOWN:7}),_defineProperty(WifiBase,"StateType",{OFF:0,ON:1}),_defineProperty(WifiBase,"ScanState",{SUCCESS:1,FAIL:0}),_dec=jsMethod({alias:"getType",common:!1,callback:!0}),_applyDecoratedDescriptor((_class=class{signalType(e){switch(e){case netWorkConnState.GSM:case netWorkConnState.CDMA:e={metered:!0,type:"2G"};break;case netWorkConnState.WCDMA:case netWorkConnState.TDSCDMA:e={metered:!0,type:"3G"};break;case netWorkConnState.LTE:e={metered:!0,type:"4G"};break;case netWorkConnState.NR:e={metered:!0,type:"5G"};break;case netWorkConnState.UNKNOWN:e={metered:!0,type:"none"}}return e}async getType(){const e=await WifiBase.ohoGetLinkedInfo();let a={metered:!1,type:"wifi"};return new Promise((t,o)=>{4===e.connState?t([a]):RadioBase.ohoGetSignalInformation(0).then(e=>{e&&e.signalType?a=this.signalType(e.signalType):a.type="none",t([a])}).catch(e=>{o([[" Failed to get type:"+e.data,e.code]])})})}}).prototype,"getType",[_dec],Object.getOwnPropertyDescriptor(_class.prototype,"getType"),_class.prototype);let NetworkBaseModule=_class;class ASNetwork extends NetworkBaseModule{constructor(){super(),this.callbacks=[],this.networkStateChange()}triggerNetworkStateNotify(t){console.debug("[AdvancedAPI] triggerNetworkStateNotify"),this.callbacks.forEach(e=>{e(t)})}networkStateChange(){NetworkBase.ohoSubscribe({callback:e=>{e=e.type,this.triggerNetworkStateNotify({isConnected:"none"!==e,networkType:e})}})}onSubscribe(e){this.callbacks.push(e)}offSubscribe(e){e?0<=(e=this.callbacks.indexOf(e))&&this.callbacks.splice(e,1):this.callbacks=[]}}class ASPhone{makePhoneCall(e){return e&&e.phoneNumber&&"string"==typeof e.phoneNumber&&""!==e?call.makeCall(e.phoneNumber):new Promise((e,t)=>{t(["param is invalid.",ErrorCode$1.PARAMETER_ERROR])})}}function isMac(e){return/^[A-Fa-f\d]{2}:[A-Fa-f\d]{2}:[A-Fa-f\d]{2}:[A-Fa-f\d]{2}:[A-Fa-f\d]{2}:[A-Fa-f\d]{2}$/.test(e)}function isUuid(e){return/^[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}$/.test(e)}function isLower(e){return e===e.toLowerCase()}function isNumber(e){return"number"==typeof e&&!Number.isNaN(e)&&Number.isFinite(e)}function isString(e){return"string"==typeof e}function isBoolean(e){return"boolean"==typeof e}function isFunction(e){return"function"==typeof e}function isArrayBuffer(e){return"[object ArrayBuffer]"===Object.prototype.toString.call(e)}function isNull(e){return null===e}function isUndefined(e){return void 0===e}function isArray(e){return Array.isArray(e)}function isHexcolor(e){return/^#[0-9a-fA-F]{6}$/i.test(e)||/^#[0-9a-fA-F]{3}$/i.test(e)}function checkDataType(t,e,o,a){let r=!1;try{if(e&&(isNull(t)||isUndefined(t)))throw new Error("The param data is required");if(!isString(o)&&!isArray(o))throw new Error("The param dataType should be a String or an Array");if(!isNull(a)&&!isUndefined(a)&&!isFunction(a))throw new Error("If customCheck exist,it should be a Function");if(!e&&(isNull(t)||isUndefined(t)))return!0;isString(o)?r=checkSingleDataType(t,o):isArray(o)&&(r=o.some(e=>checkSingleDataType(t,e))),r&&isFunction(a)&&(r=a(t))}catch(e){return console.log(e),!1}return r}function checkSingleDataType(e,t){let o=!1;switch(t){case"string":o=isString(e);break;case"number":o=isNumber(e);break;case"boolean":o=isBoolean(e);break;case"function":o=isFunction(e);break;case"arraybuffer":o=isArrayBuffer(e);break;case"array":o=isArray(e);break;case"hexcolor":o=isHexcolor(e);break;case"null":o=isNull(e);break;case"undefined":o=isUndefined(e);break;default:throw new Error("The param dataType is unsupport")}return o}class ClipboardBase{static ohosCreatePlainTextData(e){return pasteboard.createPlainTextData(e)}static ohosGetSystemPasteboard(){return pasteboard.getSystemPasteboard()}}_dec$1=jsMethod({alias:"set",common:!1,callback:!0}),_dec2=jsMethod({alias:"get",common:!1,callback:!0}),_applyDecoratedDescriptor((_class$1=class{constructor(){this.systemPasteboard=ClipboardBase.ohosGetSystemPasteboard()}set(a){return new Promise((t,o)=>{var e=a.text;void 0!==e&&isString(e)?(e=ClipboardBase.ohosCreatePlainTextData(e),this.systemPasteboard.setPasteData(e).then(e=>{t([["setPasteData success"]])}).catch(e=>{o([["Failed to setPasteData. Cause: "+e.message,ErrorCode$1.COMMON_ERROR]])})):o([["inalid param",ErrorCode$1.PARAMETER_ERROR]])})}get(){return new Promise((t,o)=>{this.systemPasteboard.getPasteData().then(e=>{e=e.getPrimaryText(),t([[{text:e}]])}).catch(e=>{o([["Failed to getPasteData. Cause: "+e.message,ErrorCode$1.COMMON_ERROR]])})})}}).prototype,"set",[_dec$1],Object.getOwnPropertyDescriptor(_class$1.prototype,"set"),_class$1.prototype),_applyDecoratedDescriptor(_class$1.prototype,"get",[_dec2],Object.getOwnPropertyDescriptor(_class$1.prototype,"get"),_class$1.prototype);let ClipboardBaseModule=_class$1;class ASClipboard extends ClipboardBaseModule{setClipboardData(a){return new Promise((t,o)=>{var e=a&&a.data;console.info("AdvancedAPI text = "+e),!a||a.showToast&&"boolean"!=typeof a.showToast?o(["param is invalid",ErrorCode$1.PARAMETER_ERROR]):super.set({text:e}).then(([e=[]]=[])=>{void 0!==e.showToast&&!0!==e.showToast||prompt.showToast({message:"内容已复制"}),t(...e)},e=>{o(...e)})})}getClipboardData(){return new Promise((t,o)=>{super.get().then(([e=[]]=[])=>{t(...e)},e=>{o(...e)})})}}class PromptBase{static showToast(o){return new Promise((e,t)=>{promptAction.showToast(o),e()})}static showDialog(o,a){return new Promise((e,t)=>{promptAction.showDialog(o,a)})}static showActionMenu(o,a){return new Promise((e,t)=>{promptAction.showActionMenu(o,a)})}static ohosShowDialog(e){return promptAction.showDialog(e)}}_dec$2=jsMethod({alias:"showToast",common:!1,callback:!1}),_dec2$1=jsMethod({alias:"showDialog",common:!1,callback:!1}),_applyDecoratedDescriptor((_class$2=class{showToast(s={}){return new Promise((e,t)=>{let o=s.message;var a,r=s.duration;try{"object"==typeof o&&(o=JSON.stringify(o))}catch(e){console.info("[QAFAPI] Parameter message translate to text fail",ErrorCode$1.PARAMETER_ERROR)}a=isNumber(o)||isBoolean(o)?o+"":o,this.checkShowToastParam(a,r)?(PromptBase.showToast({message:a,duration:r}),e(["success"])):t([["Parameter is error",ErrorCode$1.PARAMETER_ERROR]])})}checkShowToastParam(e,t){return!!checkDataType(e,!0,"string")&&!!checkDataType(t,!1,["number","string"])}showDialog(e={}){var t,{title:e,message:o,buttons:a,success:r,cancel:s,complete:i}=e;this.checkShowDialogParams(e,o,a,r,s,i)&&(t=isNumber(e)?e+"":e,o=isNumber(o)?o+"":o,e=this.showDialogCallBack(s,i,r),PromptBase.showDialog({title:t,message:o,buttons:a},e))}checkShowDialogParams(e,t,o,a,r,s){return checkDataType(e,!1,["string","number"])?checkDataType(t,!1,["string","number"])?checkDataType(o,!1,"array",e=>!(3<e.length)&&e.every(e=>(e.color=this.hex3to6(e.color),checkDataType(e.text,!1,"string")&&checkDataType(e.color,!1,"hexcolor"))))?checkDataType(a,!1,"function")?checkDataType(r,!1,"function")?!!checkDataType(s,!1,"function")||(console.info("[QAFAPI] Parameter {complete} is error",ErrorCode$1.PARAMETER_ERROR),!1):(console.info("[QAFAPI] Parameter {cancel} is error",ErrorCode$1.PARAMETER_ERROR),!1):(console.info("[QAFAPI] Parameter {success} is error",ErrorCode$1.PARAMETER_ERROR),!1):(console.info("[QAFAPI] Parameter {buttons} is error",ErrorCode$1.PARAMETER_ERROR),!1):(console.info("[QAFAPI] Parameter {message} is error",ErrorCode$1.PARAMETER_ERROR),!1):(console.info("[QAFAPI] Parameter {title} is error",ErrorCode$1.PARAMETER_ERROR),!1)}showDialogCallBack(o,a,r){return(e,t)=>{e?("cancal"===e.message&&o?(console.info("[QAFAPI] showDialog cancel: "+e),o()):console.info("[QAFAPI] showDialog err: "+e),a&&(console.info("[QAFAPI] showDialog complete callback"),a({}))):r&&(console.info("[QAFAPI] showDialog success callback, click button: "+t.index),r(t),a)&&(console.info("[QAFAPI] showDialog complete callback"+t.index),a(t))}}hex3to6(e){return void 0===e?"#000000":4!==e.length?e:"#"+e.slice(e.startsWith("#")?1:0).split("").map(e=>e+e).join("")}}).prototype,"showToast",[_dec$2],Object.getOwnPropertyDescriptor(_class$2.prototype,"showToast"),_class$2.prototype),_applyDecoratedDescriptor(_class$2.prototype,"showDialog",[_dec2$1],Object.getOwnPropertyDescriptor(_class$2.prototype,"showDialog"),_class$2.prototype);let PromptBaseModule=_class$2;const POSITION_VALUES=["top","center","bottom"],DURATION_DEFAULT=1500;class ASPrompt extends PromptBaseModule{constructor(){super(),this.init()}init(){var{height:e,densityDPI:t}=DisplayBase.ohosGetDisplay();this.windowHeihgtVp=e/t*160}showToast(e){return new Promise(async(t,o)=>{var{icon:a,image:r,mask:s}=e;let{title:i,duration:n,position:c}=e;if((a||r||s)&&console.error("[AdvancedAPI] showToast don't support icon, image, mask."),""===(i="string"!=typeof i?JSON.stringify(i):i)||void 0===i)console.error("[AdvancedAPI] showToast params title is required."),o(["showToast params title is required",ErrorCode$1.PARAMETER_ERROR]);else{"string"!=typeof c&&(c=JSON.stringify(c)),"number"!=typeof n&&(n=DURATION_DEFAULT);let e={};if(POSITION_VALUES.includes(c))switch(e={message:i,duration:DURATION_DEFAULT},c){case"top":e.bottom=this.windowHeihgtVp-150;break;case"center":e.bottom=this.windowHeihgtVp/2}else e={message:i,icon:a,image:r,mask:s,duration:n};try{await PromptBase.showToast(e),t()}catch(e){o()}}})}hideToast(){}showDialog(h){return new Promise((o,e)=>{let{title:t="",content:a,cancelText:r="取消",editable:s,confirmText:i="确定",cancelColor:n="#000000",confirmColor:c="#007aff",showCancel:l=!0,placeholderText:d}=h;"string"!=typeof t&&(t=JSON.stringify(t)),"string"!=typeof a&&(a=JSON.stringify(a)),"string"!=typeof r&&(r=JSON.stringify(r)),"string"!=typeof i&&(i=JSON.stringify(i)),"boolean"!=typeof s&&(s=!!s),"string"!=typeof d&&(d=JSON.stringify(d)),checkDataType(n,!1,["hexcolor"])||(console.error("[AdvancedAPI] showModal params cancelColor value is invalid."),n="#000000"),checkDataType(c,!1,["hexcolor"])||(console.error("[AdvancedAPI] showModal params confirmColor value is invalid."),c="#007aff"),"boolean"!=typeof l&&(l=!!l);var u={title:t,message:a,buttons:[{text:i,color:c}]};l&&u.buttons.push({text:r,color:n}),(s||d)&&console.error("[AdvancedAPI] showDialog don't support editable, placeholderText."),u.success=e=>{var t={};0===e.index?t.confirm=!0:1===e.index&&(t.cancel=!0),o(t)},u.cancel=()=>{e()},super.showDialog(u)})}showContextMenu(i){return new Promise((o,e)=>{let{title:t,alertText:a,itemColor:r="#000000"}=i;var s=i.itemList;"string"!=typeof t&&(t=JSON.stringify(t)),"string"!=typeof a&&JSON.stringify(a),Array.isArray(s)?(checkDataType(r,!1,["hexcolor"])||(console.error("[AdvancedAPI] showActionSheet params itemColor value is invalid."),r="#000000"),s=s.map(e=>({text:"string"==typeof e?e:JSON.stringify(e),color:r})),PromptBase.showActionMenu({title:t,buttons:s},(e,t)=>{e?console.error("[AdvancedAPI] showActionMenu err: "+e):(console.debug("[AdvancedAPI] showContextMenu success callback, click button: %d",t.index),o({tapIndex:Number(t.index)}))})):e(["parmas itemList must be array type.",ErrorCode$1.PARAMETER_ERROR])})}}class ASRouter{navigateTo(r){return new Promise((e,t)=>{var o,a;"string"!=typeof r.url?t(["param url",ErrorCode$1.PARAMETER_ERROR]):({url:o,urlParams:a}=getUrlParams(r.url),console.debug("[AdvancedAPI] navigateTo urlParams = %s",JSON.stringify(a)),router.pushUrl({url:o,params:a}).then(()=>{e()}).catch(e=>{console.error(`[AdvancedAPI] pushUrl failed, code is ${e.code}, message is `+e.message),t([e.message,e.code])}))})}redirectTo(r){return new Promise((e,t)=>{var o,a;"string"!=typeof r.url?t(["param url",ErrorCode$1.PARAMETER_ERROR]):({url:o,urlParams:a}=getUrlParams(r.url),console.debug("[AdvancedAPI] redirectTo urlParams = "+JSON.stringify(a)),router.replaceUrl({url:o,params:a}).then(()=>{e()}).catch(e=>{console.error(`[AdvancedAPI] replaceUrl failed, code is ${e.code}, message is `+e.message),t([e.message,e.code])}))})}reLaunch(o){return new Promise(async(e,t)=>{"string"!=typeof o.url&&t(["param url",ErrorCode$1.PARAMETER_ERROR]);try{await this.navigateTo(o),router.clear(),e()}catch(e){t()}})}switchTab(e){return new Promise(async(e,t)=>{t("[AdvancedAPI] switchTab do not support")})}navigateBack(r){return new Promise((e,t)=>{let{delta:o=1}=r;if("number"!=typeof(o=null===o?1:o))t(["parameter delta",ErrorCode$1.PARAMETER_ERROR]);else{var a=Number(router.getLength());o>a&&(o=a-1);try{for(let e=0;e<o;e++)router.back();e()}catch(e){t([e.data,e.code])}}})}}function getUrlParams(e=""){const t={};var o=e.split("?");e=o[0];let a=o[1]||"";return(a=a.split("&")).forEach(e=>{e=e.split("="),t[e[0]]=e[1]}),{url:e,urlParams:t}}class FileioBase{static ohosOpendirSync(e){return new OhosOpendir(e)}static ohosReadSync(e,t){return fs.readSync(e,t)}static ohosUnlinkSync(e){return fs.unlinkSync(e)}static ohosCopy(e,t,o=0){return fs.copyFile(e,t,o)}static ohosMkdirSync(e,t=0){return fs.mkdirSync(e)}static ohosReadTextSync(e,t){return fs.readTextSync(e,t)}static ohosStatSync(e){return fs.statSync(e)}static ohosOpenSync(e,t,o=0){return e&&"string"==typeof e&&e.startsWith("/data/storage/")&&(e=fileuri.getUriFromPath(e)),fs.openSync(e,t)}static ohosWriteSync(e,t,o={}){return fs.writeSync(e,t,o)}static ohosAccessSync(e,t=0){return fs.accessSync(e)}}class OhosOpendir{constructor(e){this.dir=fs.listFileSync(e)}ohosReadsync(){return this.dir}}class Storage{constructor(){this.storage={}}set(e,t){this.storage[e]=t}get(e){return this.storage[e]}remove(e){delete this.storage[e]}clear(){this.storage={}}getKeys(){return Object.keys(this.storage)}getString(){return JSON.stringify(this.storage)}}class ASStorage{constructor(){this.preferences,this._storage=new Storage,this.storagePath=context.filesDir+"/storageData.json",this.storageStat={},this._init()}_init(){try{FileioBase.ohosAccessSync(this.storagePath,1),this.storagefd=FileioBase.ohosOpenSync(this.storagePath,66,438).fd}catch(e){this.storagefd=FileioBase.ohosOpenSync(this.storagePath,66,438).fd,console.debug("[AdvancedAPI] ASStorage create storageData success")}var e=FileioBase.ohosReadTextSync(this.storagePath);if(e){const t=JSON.parse(e);Object.keys(t).forEach(e=>{this._storage.set(e,t[e])}),console.debug("[AdvancedAPI] update preferences success")}this.storageStat=FileioBase.ohosStatSync(this.storagePath)}updateStorageFile(){FileioBase.ohosUnlinkSync(this.storagePath),this.storagefd=FileioBase.ohosOpenSync(this.storagePath,66,438).fd;var e=this._storage.getString(),t={offset:0,length:e.length,position:0};FileioBase.ohosWriteSync(this.storagefd,e,t),this.storageStat=FileioBase.ohosStatSync(this.storagePath)}setStorage(r={}){return new Promise((e,t)=>{var{key:o,data:a}=r;if(o&&a)if("string"!=typeof r.key)t("param is invalid.",ErrorCode$1.PARAMETER_ERROR);else{this._storage.set(r.key,JSON.stringify(r.data));try{this.updateStorageFile(),e()}catch(e){console.error("[AdvancedAPI] write storageFile fail err = "+JSON.stringify(e)),t("setStorage fail",ErrorCode$1.COMMON_ERROR)}}else console.debug("[AdvancedAPI] key or data is require."),t("key or data is require",ErrorCode$1.PARAMETER_ERROR)})}setStorageSync(e){var{key:t,data:o}=e;if(t&&o){if("string"==typeof e.key){this._storage.set(e.key,JSON.stringify(e.data));try{this.updateStorageFile()}catch(e){console.error("[AdvancedAPI] write setStorageSync fail err = "+JSON.stringify(e))}}}else console.debug("[AdvancedAPI] key or data is require.")}getStorage(a){return new Promise(async(e,t)=>{var o;a&&a.key&&"string"==typeof a.key?((o=this._storage.get(a.key))||t("result is invalid.",ErrorCode$1.COMMON_ERROR),e({data:o})):t("param is invalid.",ErrorCode$1.COMMON_ERROR)})}getStorageSync(e={}){if(e&&e.key&&"string"==typeof e.key)return this._storage.get(e.key)}getStorageInfo(){return new Promise((e,t)=>{var o={};o.keys=this._storage.getKeys(),o.currentSize=this.storageStat.size,o.limitSize=Number.MAX_VALUE,e(o)})}getStorageInfoSync(){var e={};return e.keys=this._storage.getKeys(),e.currentSize=this.storageStat.size,e.limitSize=Number.MAX_VALUE,e}removeStorage(o){return new Promise(async(e,t)=>{o&&o.key&&"string"==typeof o.key||(console.debug("[AdvancedAPI] storage.removeStorage fail：invalid param "),t("param is invalid.",ErrorCode$1.COMMON_ERROR)),this._storage.get(o.key)||t("result is invalid.",ErrorCode$1.COMMON_ERROR),this._storage.remove(o.key),this.updateStorageFile(),e()})}removeStorageSync(e){e&&"string"==typeof e?(this._storage.remove(e),this.updateStorageFile()):console.error("[AdvancedAPI] storage.removeStorageSync fail：invalid param ")}clearStorage(){return new Promise(async(e,t)=>{this._storage.clear(),this.updateStorageFile(),e()})}clearStorageSync(){let e;try{e=this._storage.clear(),this.updateStorageFile()}catch(e){console.error("[AdvancedAPI] clear to file failed, err: "+JSON.stringify(e))}return e}}const colors={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function convertColorToHexARGB(e,t){var o,a;return"transparent"===(e=(e=isString(e)?e:"#FFFFFF").trim().match(/^[A-z]+$/)&&colors[e]?`rgb(${colors[e].join(",")})`:e)?"#00000000":((!isNumber(t)||t<0||1<t)&&(t=1),e.startsWith("rgb")?(a=e.split(",")).length<3?e:(4===a.length?(o=a.pop(),a.unshift(o)):a.unshift(String(t)),a.reduce((e,t,o)=>{let a=t.replace(/[^\d\\.]/gi,"");return e+(a=1===(a=(a=0===o?parseInt(255*a):parseInt(a)).toString(16).toUpperCase()).length?"0"+a:a)},"#")):e.startsWith("#")&&7===(e=4===e.length?"#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:e).length?(o=e.slice(1),"#"+(a=1===(a=parseInt(255*t).toString(16).toUpperCase()).length?"0"+a:a)+o):e)}function switchInternalToHapSandBox(e){return e.startsWith("internal://bundle/")?e.replace("internal://bundle",context.bundleCodeDir):e.startsWith("internal://cache/")?e.replace("internal://cache",context.cacheDir):e.startsWith("internal://files/")?e.replace("internal://files",context.filesDir):e.startsWith("internal://preferences/")?e.replace("internal://preferences",context.preferencesDir):e.startsWith("internal://temp/")?e.replace("internal://temp",context.tempDir):e.startsWith("internal://database/")?e.replace("internal://database",context.databaseDir):e.startsWith("internal://distributedFiles/")?e.replace("internal://distributedFiles",context.distributedFilesDir):e}function isFileUri(e){return e&&"string"==typeof e&&(e.startsWith("file://")||e.startsWith("datashare://"))}function isSandboxPath(e){return e&&"string"==typeof e&&(e.startsWith("/data/storage/")||e.startsWith("internal://"))}function getFdFromUriOrSandBoxPath(t){try{return fs.openSync(t,fs.OpenMode.READ_ONLY).fd}catch(e){console.info(`[AdvancedAPI] Can not get file from uri: ${t} `)}throw new Error("file is not exist")}async function getFileAssetFromUri(e){var e={selections:mediaLibrary.FileKey.MEDIA_TYPE+"= ?",selectionArgs:[mediaLibrary.MediaType.FILE.toString(),mediaLibrary.MediaType.IMAGE.toString(),mediaLibrary.MediaType.VIDEO.toString(),mediaLibrary.MediaType.AUDIO.toString()],uri:e},t=await(e=await mediaLibrary.getMediaLibrary(context).getFileAssets(e)).getFirstObject();return e.close(),t}const errMsgMap=new Map([[401,"Parameter error"],[201,"Permission denied"],[3,"URL using bad/illegal format or missing URL"],[7,"Couldn't connect to server"],[23,"Failed writing received data to disk/application"],[25,"Upload failed"],[26,"Failed to open/read local data from file/application"],[28,"Timeout was reached"],[73,"Remote file already exists"],[78,"Remote file not found"],[999,"Unknown Other Error"]]);class ASRequest{request(e){return console.debug("[AdvancedAPI] ASRequest request"),new RequestTask(e)}uploadFile(e){return console.debug("[AdvancedAPI] ASRequest uploadFile : %s",JSON.stringify(e)),new UploadTask(e)}downloadFile(e){return console.debug("[AdvancedAPI] ASRequest downloadFile %s",JSON.stringify(e)),new DownloadTask(e)}}class RequestTask{constructor(a){const{url:r,header:t,method:o="GET",timeout:s,responseType:i,enableCache:n}=a||{};let c=(a||{}).data;const{success:l,fail:d,complete:u}=a||{};if(this.abortFlag=!1,this.fail=d,this.complete=u,this.httpRequest=http.createHttp(),this.headersCallback=new Map,a){let e=!1;for(const g in t)if("content-type"===g.toLowerCase()){t[g].toLowerCase().includes("application/x-www-form-urlencoded")&&(e=!0);break}if(c&&(e||["GET","OPTIONS","DELETE","TRACE","CONNECT"].includes(o))){var h=[];for(const f in c)h.push(encodeURIComponent(f)+"="+encodeURIComponent(c[f]));c=h.join("&")}if(t)for(const A in t)t[A]=""+t[A];var p={method:o,extraData:c||{},header:t,connectTimeout:s,expectDataType:i&&"arraybuffer"===i?http.HttpDataType.ARRAY_BUFFER:http.HttpDataType.STRING,usingCache:n||!1};this.httpRequest.request("string"==typeof r?r:"",p).then(t=>{if(console.debug("[AdvancedAPI] request url %s success",r),l&&!this.abortFlag){let e=t.result;var o=(a||{}).dataType;if(o&&"json"!==o)"object"==typeof t.result&&(e=JSON.stringify(t.result));else if("string"==typeof t.result)try{e=JSON.parse(e)}catch(e){}o={data:e,statusCode:t.responseCode,header:t.header,cookies:"string"==typeof t.cookies?t.cookies?[t.cookies]:[]:t.cookies,errMsg:"request:ok"},this.result=o,l(o)}}).catch(e=>{console.error("[AdvancedAPI] request error: "+JSON.stringify(e)),d&&!this.abortFlag&&(e={errMsg:errMsgMap.has(e.code)?errMsgMap.get(e.code):"Unknown Error"},this.result=e,d(e))}).finally(()=>{u&&!this.abortFlag&&u(this.result),this.httpRequest&&(this.httpRequest.destroy(),this.httpRequest=void 0)})}else console.error("[AdvancedAPI] request error: params illegal")}abort(){console.debug("[AdvancedAPI] request abort"),this.abortFlag=!0,this.httpRequest&&(this.httpRequest.destroy(),this.httpRequest=void 0,this.res={errMsg:"request:fail abort"},this.fail&&this.fail(this.res),this.complete)&&this.complete(this.res)}onHeadersReceived(t){var e=e=>{this.abortFlag||t({header:e})};t?this.headersCallback.has(t)||(this.headersCallback.set(t,e),this.httpRequest&&this.httpRequest.on("headersReceive",e)):console.error("[AdvancedAPI] Invalid, callback is null")}offHeadersReceived(e){e?this.headersCallback.has(e)?(this.httpRequest&&this.httpRequest.off("headersReceive",this.headersCallback.get(e)),this.headersCallback.delete(e)):console.debug("[AdvancedAPI] offHeadersReceived callback invalid"):(this.headersCallback.clear(),this.httpRequest&&this.httpRequest.off("headersReceive"))}}class UploadTask{constructor(e){var{url:t,files:o,filePath:a,name:r,header:s,formData:i}=e||{};const{success:n,fail:c,complete:l}=e||{},d=(this.progressCallback=new Map,this.headersCallback=new Map,[]);o?o.forEach(function(e){var t,o;"string"==typeof e.uri&&(t=e.uri.substring(e.uri.lastIndexOf("/")+1),o=e.uri.substring(e.uri.lastIndexOf(".")+1),d.push({filename:t,name:e.name,uri:e.uri,type:o}))}):"string"==typeof a&&(e=a.substring(a.lastIndexOf("/")+1),o=a.substring(a.lastIndexOf(".")+1),d.push({filename:e,name:r,uri:a,type:o}));var u,h,p=[];for([u,h]of Object.entries(i||{}))p.push({name:u,value:JSON.stringify(h)});e={url:t,header:s||{},method:"POST",files:d,data:p},this.successHandle=e=>{n&&n(e),l&&l(e)},this.failHandle=e=>{c&&c(e),l&&l(e)};try{console.debug("[AdvancedAPI] request upload"),request$1.uploadFile(globalThis.abilityContext,e).then(e=>{if(this.uploadTask=e,this.abortFlag&&(this.abortFlag=!1,this.uploadTask.delete(()=>{this.res={errMsg:"uploadFile:fail abort"},this.failHandle(this.res)})),this.progressFlag){this.progressFlag=!1;for(const t of this.progressCallback.values())this.uploadTask.on("progress",t)}if(this.headersFlag){this.headersFlag=!1;for(const o of this.headersCallback.values())this.uploadTask.on("headerReceive",o)}this.uploadTask.on("headerReceive",this.headersReceivedHandle.bind(this)),this.uploadTask.on("complete",()=>{var e;console.debug("[AdvancedAPI] upload success"),this.res={data:(null==(e=this.receivedData)?void 0:e.body)||{},header:(null==(e=this.receivedData)?void 0:e.headers)||{},cookies:[],statusCode:200,errMsg:"uploadFile:ok"},this.successHandle(this.res)}),this.uploadTask.on("fail",()=>{console.debug("[AdvancedAPI] upload fail"),this.res={errMsg:"uploadFile:fail"},this.failHandle(this.res)})}).catch(e=>{console.error("[AdvancedAPI] upload request error: "+e.message),this.res={errMsg:"uploadFile:fail "+e.message},this.failHandle(this.res)})}catch(e){console.error("[AdvancedAPI] upload request err.code : "+e.code+", err.message : "+e.message),this.res={errMsg:"uploaddFile:fail "+e.message},this.failHandle(this.res)}}abort(){this.res={errMsg:"uploadFile:fail abort"},this.uploadTask?this.uploadTask.delete(()=>{this.failHandle(this.res)}):this.abortFlag=!0}onProgressUpdate(o){function e(e,t){o({progress:Math.ceil(100*e/t),totalBytesSent:e,totalBytesExpectedToSend:t})}o?this.progressCallback.has(o)||(this.progressCallback.set(o,e),this.uploadTask?this.uploadTask.on("progress",e):this.progressFlag=!0):console.error("[AdvancedAPI] Invalid, callback is null")}offProgressUpdate(e){e?this.progressCallback.has(e)?(this.uploadTask&&this.uploadTask.off("progress",this.progressCallback.get(e)),this.progressCallback.delete(e)):console.debug("[AdvancedAPI] offProgressUpdate callback invalid"):(this.progressCallback.clear(),this.uploadTask&&this.uploadTask.off("progress"))}headersReceivedHandle(e){this.receivedData=e}onHeadersReceived(t){var e=e=>{this.abortFlag||t({header:e.headers||{}})};t?this.headersCallback.has(t)||(this.headersCallback.set(t,e),this.uploadTask?this.uploadTask.on("headerReceive",e):this.headersFlag=!0):console.error("[AdvancedAPI] Invalid, callback is null")}offHeadersReceived(e){e?this.headersCallback.has(e)?(this.uploadTask&&this.uploadTask.off("headerReceive",this.headersCallback.get(e)),this.headersCallback.delete(e)):console.debug("[AdvancedAPI] offHeadersReceived callback invalid"):(this.headersCallback.clear(),this.uploadTask&&(this.uploadTask.off("headerReceive"),this.uploadTask.on("headerReceive",this.headersReceivedHandle.bind(this))))}}class DownloadTask{constructor(e){const{url:t,header:o,filePath:a}=e||{},{success:r,fail:s,complete:i}=e||{},n=(this.progressCallback=new Map,"string"==typeof t&&(e=(new Date).getTime(),this.filename="Download_"+e+"_"+t.substring(t.lastIndexOf("/")+1).replace(/[^a-zA-Z0-9.]/,"").slice(-16)),a||"internal://cache/"+this.filename);e=switchInternalToHapSandBox(n),e={url:this.isEncodeUri(t)?t:encodeURI(t),header:o||{},filePath:e},this.successHandle=e=>{r&&r(e),i&&i(e)},this.failHandle=e=>{s&&s(e),i&&i(e)};try{console.debug("[AdvancedAPI] request download"),request$1.downloadFile(globalThis.abilityContext,e).then(e=>{if(this.downloadTask=e,this.abortFlag&&(this.abortFlag=!1,this.downloadTask.delete(()=>{console.debug("[AdvancedAPI] download fail"),this.res={errMsg:"downloadFile:fail abort"},this.failHandle(this.res)})),this.progressFlag){this.progressFlag=!1;for(const t of this.progressCallback.values())this.downloadTask.on("progress",t)}this.downloadTask.on("complete",()=>{console.debug("[AdvancedAPI] download success"),this.res={tempFilePath:n,statusCode:200,errMsg:"downloadFile:ok"},a&&Object.assign(this.res,{filePath:a}),this.downloadTask.getTaskInfo().then(e=>{console.debug("[AdvancedAPI] download info: %s",JSON.stringify(e)),e.downloadTotalBytes&&Object.assign(this.res,{dataLength:e.downloadTotalBytes})}).catch(e=>{console.error("[AdvancedAPI] download request get task info error: "+e.message)}).finally(()=>{this.successHandle(this.res)})}),this.downloadTask.on("fail",()=>{console.debug("[AdvancedAPI] download fail"),this.res={errMsg:"downloadFile:fail"},this.failHandle(this.res)})}).catch(e=>{console.error("[AdvancedAPI] download request error: "+e.message),this.res={errMsg:"downloadFile:fail "+e.message},this.failHandle(this.res)})}catch(e){console.error("[AdvancedAPI] download request err.code : "+e.code+", err.message : "+e.message),this.res={errMsg:"downloadFile:fail "+e.message},this.failHandle(this.res)}}abort(){this.downloadTask?this.downloadTask.delete(()=>{console.debug("[AdvancedAPI] download fail"),this.res={errMsg:"downloadFile:fail abort"},this.failHandle(this.res)}):this.abortFlag=!0}onProgressUpdate(o){function e(e,t){o({progress:Math.ceil(100*e/t),totalBytesWritten:e,totalBytesExpectedToWrite:t})}o?this.progressCallback.has(o)||(this.progressCallback.set(o,e),this.downloadTask?this.downloadTask.on("progress",e):this.progressFlag=!0):console.error("[AdvancedAPI] Invalid, callback is null")}offProgressUpdate(e){e?this.progressCallback.has(e)?this.downloadTask&&(this.downloadTask.off("progress",this.progressCallback.get(e)),this.progressCallback.delete(e)):console.debug("[AdvancedAPI] offProgressUpdate callback invalid"):(this.progressCallback.clear(),this.downloadTask&&this.downloadTask.off("progress"))}onHeadersReceived(e){console.debug("[AdvancedAPI] onHeadersReceived not support")}offHeadersReceived(e){console.debug("[AdvancedAPI] offHeadersReceived not support")}isEncodeUri(e){return!e||/^[a-zA-Z0-9-_.!~*'();/?:@&=+$,#]+$/.test(e)}}class ASSocket{connectSocket(e){return console.debug("[AdvancedAPI] ASSocket connect %s",JSON.stringify(e)),this.task=new SocketTask(e),this.task}sendSocketMessage(e){console.debug("[AdvancedAPI] ASSocket send msg %s",JSON.stringify(e)),this.task.send(e)}closeSocket(e){console.debug("[AdvancedAPI] ASSocket close"),this.task.close(e)}onSocketOpen(e){console.debug("[AdvancedAPI] ASSocket onOpen"),this.task.onOpen(e)}onSocketError(e){this.task.onError(e)}onSocketMessage(e){this.task.onMessage(e)}onSocketClose(e){this.task.onClose(e)}}class SocketTask{constructor(e){var{url:t,header:o}=e||{};const{success:a,fail:r,complete:s}=e||{};this.state="close",this.ws=webSocket.createWebSocket(),this.ws.connect(t,{header:o}).then(e=>{this.res={errMsg:"connectSocket:ok"},a&&a(this.res)}).catch(e=>{console.error("[AdvancedAPI] SocketTask connect fail, error: "+JSON.stringify(e)),this.res={errMsg:e.message},r&&r(this.res)}).finally(()=>{s&&s(this.res)}),this.ws.on("open",(e,t)=>{console.debug("[AdvancedAPI] SocketTask on open, value: %s",JSON.stringify(t)),this.state="open",this.onOp&&this.onOp({})}),this.ws.on("error",e=>{console.error("[AdvancedAPI] SocketTask on error, error: "+JSON.stringify(e)),this.onErr&&this.onErr({})}),this.ws.on("message",(e,t)=>{console.debug("[AdvancedAPI] SocketTask on message, msg: %s",t),this.onMsg&&this.onMsg({data:t})}),this.ws.on("close",(e,t)=>{console.debug("[AdvancedAPI] SocketTask on close, code is %d reason is %s",t.code,t.reason),this.state="close",this.onCls&&this.onCls({})})}send(e){var t=e&&e.data||"";const{success:o,fail:a,complete:r}=e||{};"close"===this.state?(console.error("[AdvancedAPI] socket is closed"),this.res={errMsg:"sendSocketMessage:fail WebSocket is not connected"},a&&a(this.res),r&&r(this.res)):this.ws.send(t).then(e=>{this.res={errMsg:"sendSocketMessage:ok"},o&&o(this.res)},e=>{console.error("[AdvancedAPI] SocketTask send fail, error: "+JSON.stringify(e)),this.res={errMsg:e.message},a&&a(this.res)}).finally(()=>{r&&r(this.res)})}close(e){var{code:t,reason:o}=e||{};const{success:a,fail:r,complete:s}=e||{};"close"===this.state?(console.error("[AdvancedAPI] socket is closed"),this.res={errMsg:"closeSocket:fail WebSocket is not connected"},r&&r(this.res),s&&s(this.res)):this.ws.close({code:t,reason:o}).then(e=>{this.state="close",this.res={errMsg:"closeSocket:ok"},a&&a(this.res)}).catch(e=>{console.error("[AdvancedAPI] SocketTask close fail, error: "+JSON.stringify(e)),this.res={errMsg:e.message},r&&r(this.res)}).finally(()=>{s&&s(this.res)})}onOpen(e){"function"==typeof e?this.onOp=e:console.error("[AdvancedAPI] illegal callback")}onError(e){"function"==typeof e?this.onErr=e:console.error("[AdvancedAPI] illegal callback")}onClose(e){"function"==typeof e?this.onCls=e:console.error("[AdvancedAPI] illegal callback")}onMessage(e){"function"==typeof e?this.onMsg=e:console.error("[AdvancedAPI] illegal callback")}}const SCAN_MODE={LIMITED:5,DURATION:0};class BluetoothBase{static getPermissions(){const t=["ohos.permission.ACCESS_BLUETOOTH"],o=abilityAccessCtrl.createAtManager();return new Promise(async e=>{0===(await o.requestPermissionsFromUser(context,t)).authResults[0]?e(!0):e(!1)})}static onStateChange(e){try{return access.on("stateChange",e)}catch(e){console.warn("[AdvancedAPI] on bondStateChange fail")}}static on(e){try{return connection.on("bluetoothDeviceFind",e)}catch(e){console.warn("[AdvancedAPI] on fail")}}static onBLE(e){try{ble.on("BLEDeviceFind",e)}catch(e){console.warn("[AdvancedAPI] BLE.on.BLEDeviceFind fail")}}static createGattClientDevice(e){try{return ble.createGattClientDevice(e)}catch(e){console.warn("[AdvancedAPI] createGattClientDevice fail")}}static enableBluetooth(){try{return access.enableBluetooth()}catch(e){console.warn("[AdvancedAPI] enableBluetooth fail")}}static disableBluetooth(){try{return access.disableBluetooth()}catch(e){console.warn("[AdvancedAPI] disableBluetooth fail")}}static bluetoothState(){try{return access.getState()}catch(e){console.error("[AdvancedAPI] getState fail,  errCode: "+e.code+", errMessage: "+e.message)}}static startBluetoothDiscovery(){connection.setBluetoothScanMode(connection.ScanMode.SCAN_MODE_LIMITED_DISCOVERABLE,SCAN_MODE.DURATION);try{return connection.startBluetoothDiscovery()}catch(e){console.warn("[AdvancedAPI] startBluetoothDiscovery fail")}}static off(){try{return connection.off("bluetoothDeviceFind")}catch(e){console.warn("[AdvancedAPI] off fail")}}static getRemoteDeviceName(e){try{return connection.getRemoteDeviceName(e)}catch(e){console.warn("[AdvancedAPI] getRemoteDeviceName fail")}}static stopBluetoothDiscovery(){try{return connection.stopBluetoothDiscovery()}catch(e){console.warn("[AdvancedAPI] no need to stop")}}static startBLEScan(e){try{ble.startBLEScan(null,{interval:e,dutyMode:ble.ScanDuty.SCAN_MODE_LOW_POWER,matchMode:ble.MatchMode.MATCH_MODE_AGGRESSIVE})}catch(e){console.error("[QAFAPI] startBLEScan errCode:"+e.code+",errMessage:"+e.message)}}static stopBLEScan(){try{ble.stopBLEScan()}catch(e){console.error("[QAFAPI] stopBLEScan errCode:"+e.code+",errMessage:"+e.message)}}static offBLE(){try{ble.off("BLEDeviceFind")}catch(e){console.warn("[AdvancedAPI] BLE.off.BLEDeviceFind fail")}}static getProfile(e){try{return bluetoothManager.getProfileInstance(e).getConnectionDevices()}catch(e){console.warn("[AdvancedAPI] getProfileInstance fail")}}static getConnectedBLEDevices(){try{return ble.getConnectedBLEDevices()}catch(e){console.error("[AdvancedAPI]getConnectedBLEDevices errCode:"+e.code+",errMessage:"+e.message)}}}const BLESTATE={STATE_ON:2,STATE_OFF:0,INDEX:1,STATE_CONNECTED:2,STATE_DISCONNECTED:0},DEFAULT={OPEN:!1,OPEN_MSG:"快应用加载器想要开启蓝牙",CLOSE_MSG:"快应用加载器请求关闭蓝牙",ALLOW_BUTTON:"允许",REFUSE_BUTTON:"拒绝"};_dec$3=jsMethod({alias:"openAdapter",common:!1,callback:!0}),_dec2$2=jsMethod({alias:"closeAdapter",common:!1,callback:!0}),_dec3=jsMethod({alias:"getAdapterState",common:!1,callback:!0}),_dec4=jsMethod({alias:"startDevicesDiscovery",common:!1,callback:!0}),_dec5=jsMethod({alias:"stopDevicesDiscovery",common:!1,callback:!0}),_dec6=jsMethod({alias:"getDevices",common:!1,callback:!0}),_dec7=jsMethod({alias:"getConnectedDevices",common:!1,callback:!0}),_dec8=jsMethod({alias:"createBLEConnection",common:!1,callback:!0}),_dec9=jsMethod({alias:"closeBLEConnection",common:!1,callback:!0}),_dec10=jsMethod({alias:"getBLEDeviceServices",common:!1,callback:!0}),_dec11=jsMethod({alias:"getBLEDeviceCharacteristics",common:!1,callback:!0}),_dec12=jsMethod({alias:"readBLECharacteristicValue",common:!1,callback:!0}),_dec13=jsMethod({alias:"writeBLECharacteristicValue",common:!1,callback:!0}),_dec14=jsMethod({alias:"notifyBLECharacteristicValueChange",common:!1,callback:!0}),_applyDecoratedDescriptor((_class$3=class{constructor(){_defineProperty(this,"BLECharacteristicCallback",e=>{console.debug("[AdvancedAPI] characteristicChange triger valueChange:"+JSON.stringify(e));var{serviceUuid:t,characteristicUuid:o}=e,e=new Uint8Array(e.characteristicValue),a={deviceId:this.deviceIdBle,serviceId:t,characteristicId:o,value:e};for(const r of this.BLECharacteristicListeners)r(a)}),this.onadapterstatechange,this.ondevicefound,this.allowDuplicatesKey=!1,this.interval=0,this.state={available:BluetoothBase.bluetoothState()===BLESTATE.STATE_ON,discovering:!1},this.deviceIdBle,this.scanResult=[],this.gattClient=null,this.isOnBle={mode:!1},this.stateBLE={},this.services=[],this.bleCharacteristic={},this.characteristicValue=null,this.isInit=!1,this.devicesFoundListeners=[],this.adapterStateChangeListeners=[],this.BLEConnectionStateListeners=[],this.BLECharacteristicListeners=[]}openAdapter(e){const{operateAdapter:a=DEFAULT.OPEN}=e||{},r=BluetoothBase.bluetoothState()===BLESTATE.STATE_ON;return new Promise((t,o)=>{r?t([["bluetooth is turned"]]):a?this.promptTemp(DEFAULT.OPEN_MSG).then(e=>{e.index===BLESTATE.INDEX?(BluetoothBase.enableBluetooth()&&t([[BLHErrorCode.OK]]),this.state.available=!0):o([["user reject",BLHErrorCode.SYSTEM_ERROR]])}):o([["not available",BLHErrorCode.NOT_AVAILABLE]])})}closeAdapter(e){const{operateAdapter:o=DEFAULT.OPEN}=e||{},a=BluetoothBase.bluetoothState()===BLESTATE.STATE_OFF;return new Promise((t,e)=>{a?e([["bluetooth is not turned",BLHErrorCode.NOT_INIT]]):o?this.promptTemp(DEFAULT.CLOSE_MSG).then(e=>{if(e.index===BLESTATE.INDEX){BluetoothBase.disableBluetooth()&&t([[BLHErrorCode.OK]]),this.state.available=!1;try{BluetoothBase.offBLE()}catch(e){console.error("[QAFAPI] OpenHarmony Error ondevicefound,error Message:"+e)}}}):t([["closeBluetoothAdapter success"]])})}getAdapterState(){const t=BluetoothBase.bluetoothState()===BLESTATE.STATE_ON;return new Promise(e=>{e({discovering:this.state.discovering,available:t})})}startDevicesDiscovery(i){const t=BluetoothBase.bluetoothState()===BLESTATE.STATE_ON;return new Promise((e,o)=>{if(t){if(i){var{services:a,allowDuplicatesKey:r,interval:s}=i;if(a&&!isArray(a)||r&&!isBoolean(r)||s&&!isNumber(s))return void o([["invalidParam",BLHErrorCode.SYSTEM_ERROR]]);let t=[];if(a){if(!a.every(e=>(t.push({serviceUuid:e}),isUuid(e.toLowerCase()))))return void o([["uuid invalid",BLHErrorCode.NO_DEVICE]]);this.isOnBle.mode=!0}else t=null;r&&(this.allowDuplicatesKey=r),s&&(this.interval=s)}BluetoothBase.startBLEScan(this.interval),BluetoothBase.startBluetoothDiscovery()?(this.state.discovering=!0,e("ok")):o([["[QAFAPI] openHarmony startBluetoothDiscovery fail",BLHErrorCode.CONNECTION_FAIL]])}else o([["bluetooth is not turned",BLHErrorCode.NOT_AVAILABLE]])})}stopDevicesDiscovery(){return new Promise((e,t)=>{var o;BluetoothBase.bluetoothState()?(BluetoothBase.stopBLEScan(),o=BluetoothBase.stopBluetoothDiscovery(),this.state.discovering=!1,o?(e("ok"),this.devicesFoundListeners=[],this.isOnBle.mode=!1,this.interval=0,this.allowDuplicatesKey=!1):e("ok")):t(["bluetooth is not turned",BLHErrorCode.NOT_AVAILABLE])})}getDevices(){const o=BluetoothBase.bluetoothState()===BLESTATE.STATE_ON;return new Promise((e,t)=>{o?e([[{devices:this.scanResult}]]):t([["bluetooth is not turned",BLHErrorCode.NOT_AVAILABLE]])})}saveDevice(e){!this.allowDuplicatesKey&&this.isRepeat(this.scanResult,e.deviceId)||this.scanResult.push(e)}onFoundEvent(e){const o=this.getTemp();if(e[0]&&e[0].deviceId){var{deviceId:t,rssi:a,data:r}=e[0];o.deviceId=t,o.RSSI=a,o.serviceData=r;try{const s=BluetoothBase.createGattClientDevice(t);s.connect(),s.getDeviceName((e,t)=>{o.name=t,o.localName=t;try{s.disconnect(),s.close()}catch(e){console.warn("[QAFAPI] close client fail: "+JSON.stringify(e))}this.saveDevice(o)})}catch(e){console.warn("[QAFAPI] close client fail: "+JSON.stringify(e))}}else o.deviceId=e[0],o.name=BluetoothBase.getRemoteDeviceName(o.deviceId),o.localName=o.name,console.debug("[QAFAPI] onFoundEvent:"+JSON.stringify(o)),this.saveDevice(o)}getConnectedDevices(r){return new Promise((e,o)=>{if(BluetoothBase.bluetoothState()===BLESTATE.STATE_ON)if(r&&r.services&&isArray(r.services)&&0!==r.services.length){console.debug("[QAFAPI] services :  "+JSON.stringify(r.services));var t=r.services.every(e=>isUuid(e.toLowerCase()))||!1;if(r&&t){let t=[];try{t=BluetoothBase.getConnectedBLEDevices()}catch(e){console.error("[QAFAPI] errCode:"+e.code+",errMessage:"+e.message)}console.debug("[QAFAPI] BleDeviceIds = "+JSON.stringify(t));try{[1,4,6,7].forEach(e=>{e=BluetoothBase.getProfile(e),console.error("[QAFAPI] profiles"+JSON.stringify(e)),e&&(t=[...t,...e])})}catch(e){console.error("[QAFAPI] getProfile fail"+e)}if((t=t.reduce((e,t)=>e.includes(t)?e:[...e,t],[]))&&0!==t.length){const a=[];t.forEach(e=>{a.push({name:BluetoothBase.getRemoteDeviceName(e),deviceId:e})}),e([[{devices:a}]])}else o([["no device",BLHErrorCode.NO_DEVICE]])}else console.debug("[QAFAPI] invalidParam  services "),o([["invalidParam",BLHErrorCode.SYSTEM_ERROR]])}else o([["invalidParam",BLHErrorCode.SYSTEM_ERROR]]);else o([["bluetooth is not turned",BLHErrorCode.NOT_AVAILABLE]])})}createBLEConnection(e){const{deviceId:a,timeout:r}=e||{};return new Promise((e,t)=>{if(BluetoothBase.bluetoothState()===BLESTATE.STATE_ON)if(r&&!isNumber(r))t([["invalidParam",BLHErrorCode.SYSTEM_ERROR]]);else if(a&&isString(a)){this.gattClient=BluetoothBase.createGattClientDevice(a),this.gattClient.on("BLEConnectionStateChange",e=>{var t=2===e.state;this.stateBLE[e.deviceId]!==t&&(this.stateBLE[e.deviceId]=t)});try{this.gattClient.on("BLECharacteristicChange",this.BLECharacteristicCallback),console.debug("[AdvancedAPI] BLECharacteristicChange Registration succeeded.")}catch(e){console.error("AdvancedAPI BLECharacteristicChange Registration fail "+e.message)}const o=this.gattClient.connect();r?setTimeout(()=>{o?(e("ok"),this.deviceIdBle=a):t([["connection timed out",BLHErrorCode.CONNECTION_FAIL]])},r):o?(e("ok"),this.deviceIdBle=a):t([["fail connection",BLHErrorCode.CONNECTION_FAIL]])}else t([["invalidParam",BLHErrorCode.SYSTEM_ERROR]]);else t([["bluetooth is not turned",BLHErrorCode.NOT_AVAILABLE]])})}closeBLEConnection(e){const o=(e||{}).deviceId;return new Promise((e,t)=>{if(o&&isString(o))try{this.gattClient.disconnect(),this.gattClient.close(),this.gattClient=null,this.stateBLE[o]=!1,e("ok")}catch(e){t([["Failed to disconnect the Bluetooth connection",BLHErrorCode.SYSTEM_ERROR]])}else t([["Deviceid must be written",BLHErrorCode.SYSTEM_ERROR]])})}getBLEDeviceServices(e){const o=(e||{}).deviceId;return new Promise((t,e)=>{if(o&&isString(o))if(isMac(o))if(BluetoothBase.bluetoothState()===BLESTATE.STATE_ON){console.debug("[QAFAPI] getServices deviceId:"+o+" this.deviceIdBLE = "+this.deviceIdBle);let e;this.gattClient&&o===this.deviceIdBle?(console.debug("[QAFAPI] getServices deviceId:"+o),e=this.gattClient):((e=BluetoothBase.createGattClientDevice(o)).connect(),this.gattClient=e,this.deviceIdBle=o),e.getServices().then(e=>{const o=[];e.forEach(e=>{console.debug("[QAFAPI] getServices services = "+JSON.stringify(e));var{serviceUuid:e,isPrimary:t}=e,e={uuid:e,isPrimary:t};o.push(e)}),this.services=e,t([[{services:o}]])}).catch(e=>{console.error("[QAFAPI] getServices fail:"+JSON.stringify(e)),t([[{services:[]}]])})}else e([["bluetooth is not turned",BLHErrorCode.NOT_AVAILABLE]]);else e([["deviceId is not MAC",BLHErrorCode.SYSTEM_ERROR]]);else e([["invalidParam",BLHErrorCode.SYSTEM_ERROR]])})}getBLEDeviceCharacteristics(e){return new Promise((a,r)=>{if(e){const{deviceId:t,serviceId:s}=e;if(console.info("[QAFAPI] getBLEDeviceCharacteristics deviceId:"+t+" serviceId = "+s),t&&isString(t)&&s&&isString(s)){console.info("[QAFAPI] getBLEDeviceCharacteristics deviceId:"+t+" this.deviceIdBLE = "+this.deviceIdBle);let e;this.gattClient&&t===this.deviceIdBle?(console.info("[QAFAPI] getBLEDeviceCharacteristics deviceId:"+t),e=this.gattClient):((e=BluetoothBase.createGattClientDevice(t)).connect(),this.gattClient=e,this.deviceIdBle=t),e.getServices().then(e=>{let t;if(this.services.forEach(e=>{console.info("[QAFAPI] serviceId = "+JSON.stringify(e)),e.serviceUuid===s&&(t=e)}),t){const o=[];(this.bleDescriptor=t).characteristics.forEach(e=>{console.info("[QAFAPI] Servicesfound item = "+JSON.stringify(e)),o.push({uuid:e.characteristicUuid,properties:e.properties})}),a([[{characteristics:o}]])}else r([["Service not found",BLHErrorCode.NO_SERVICE]])}).catch(e=>{console.error("[QAFAPI] OpenHarmony Error getServices value,error Message:"+e),r([["property not support",BLHErrorCode.PROPERTY_NOT_SUPPORT]])})}else r([["invalidParam",BLHErrorCode.SYSTEM_ERROR]])}else r([["invalidParam",BLHErrorCode.SYSTEM_ERROR]])})}readBLECharacteristicValue(e){return new Promise((a,r)=>{if(e){const{deviceId:s,serviceId:i,characteristicId:n}=e;isString(s)&&isString(i)&&isString(n)&&s&&i&&isUuid(i.toLowerCase())&&n&&isUuid(n.toLowerCase())?isMac(s.toLowerCase())?this.queryBLECharacteristic(s,i).then(e=>{var t=[],e={serviceUuid:i.toLowerCase(),characteristicUuid:n.toLowerCase(),descriptorUuid:e.descriptorUuid,descriptorValue:e.descriptorValue},e=(t.push(e),{serviceUuid:i.toLowerCase(),characteristicUuid:n.toLowerCase(),characteristicValue:this.characteristicValue,descriptors:t}),t=(console.debug("[QAFAPI] characteristicIn = "+JSON.stringify(e)),null);let o;if(this.gattClient&&this.deviceIdBle===s)try{o=this.gattClient.readCharacteristicValue(e)}catch(e){r([[e.message,ErrorCode$1.PARAMETER_ERROR]]),console.error("[QAFAPI]readBLECharacteristicValue errCode:"+e.code+",errMessage:"+e.message)}else try{t=BluetoothBase.createGattClientDevice(s),o=t.readCharacteristicValue(e)}catch(e){r([[e.message,ErrorCode$1.PARAMETER_ERROR]]),console.error("[QAFAPI]readBLECharacteristicValue errCode:"+e.code+",errMessage:"+e.message)}o?o.then(e=>{a([e])}).catch(e=>{console.error("[AdvancedAPI] Failed to read characteristic value"+e.message),r([["property not support",BLHErrorCode.PROPERTY_NOT_SUPPORT]])}):r([["property not support",BLHErrorCode.PROPERTY_NOT_SUPPORT]])}).catch(e=>{r([["Bluetooth not available",BLHErrorCode.SYSTEM_ERROR]])}):r([["deviceId is not MAC",BLHErrorCode.SYSTEM_ERROR]]):r([["invalidParam",BLHErrorCode.SYSTEM_ERROR]])}else r([["invalidParam",BLHErrorCode.SYSTEM_ERROR]])})}writeBLECharacteristicValue(e){return new Promise((a,r)=>{if(e){const{deviceId:s,serviceId:i,characteristicId:n,value:c}=e;isString(s)&&isString(i)&&isString(n)&&isArrayBuffer(c)&&isMac(s)&&s&&i&&isUuid(i.toLowerCase())&&n&&isUuid(n.toLowerCase())&&isLower(n.toLowerCase())&&c?this.queryBLECharacteristic(s,i).then(e=>{var t=[],e={serviceUuid:i.toLowerCase(),characteristicUuid:n.toLowerCase(),descriptorUuid:e.descriptorUuid,descriptorValue:e.descriptorValue},e=(t.push(e),{serviceUuid:i.toLowerCase(),characteristicUuid:n.toLowerCase(),characteristicValue:c,descriptors:t}),t=(console.debug("[QAFAPI] characteristicIn = "+JSON.stringify(e)),null);let o;if(this.gattClient&&this.deviceIdBle===s)try{o=this.gattClient.writeCharacteristicValue(e)}catch(e){r([[e.message,ErrorCode$1.PARAMETER_ERROR]]),console.error("[QAFAPI]writeCharacteristicValue errCode:"+e.code+",errMessage:"+e.message)}else try{t=BluetoothBase.createGattClientDevice(s),o=t.writeCharacteristicValue(e)}catch(e){r([[e.message,ErrorCode$1.PARAMETER_ERROR]]),console.error("[QAFAPI]readBLECharacteristicValue errCode:"+e.code+",errMessage:"+e.message)}o?a("ok"):r([["property not support",BLHErrorCode.PROPERTY_NOT_SUPPORT]])}).catch(e=>{r([["Bluetooth not available",BLHErrorCode.SYSTEM_ERROR]])}):r([["invalidParam",BLHErrorCode.SYSTEM_ERROR]])}else r([["invalidParam",BLHErrorCode.SYSTEM_ERROR]])})}queryBLECharacteristic(t,r){return new Promise((o,a)=>{if(this.descriptors&&t.toLowerCase()===this.deviceIdBle.toLowerCase())o(this.descriptors);else{let e;this.gattClient&&t.toLowerCase()===this.deviceIdBle.toLowerCase()?(console.info("[QAFAPI] queryBLECharacteristic deviceId:"+t),e=this.gattClient):((e=BluetoothBase.createGattClientDevice(t)).connect(),this.gattClient=e,this.deviceIdBle=t),e.getServices().then(e=>{let t;e.forEach(e=>{e.serviceUuid.toLowerCase()===r.toLowerCase()&&(t=e)}),t?t.characteristics.forEach(e=>{e.serviceUuid.toLowerCase()===r.toLowerCase()?(this.characteristicValue=e.characteristicValue,e.descriptors.forEach(e=>{e.serviceUuid.toLowerCase()===r.toLowerCase()?(this.descriptors=e,console.info("[QAFAPI] Servicesfound descriptor = "+JSON.stringify(e)),o(this.descriptors)):a([["characteristics not found",BLHErrorCode.NO_SERVICE]])})):(console.error("[AdvancedAPI] characteristics not found"),a([["characteristics not found",BLHErrorCode.NO_SERVICE]]))}):a([["Service not found",BLHErrorCode.NO_SERVICE]])}).catch(e=>{console.error("[AdvancedAPI] getServices fail:"+e.message),a([["Service not found",BLHErrorCode.NO_SERVICE]])})}})}notifyBLECharacteristicValueChange(e){return new Promise((a,r)=>{if(e){const{deviceId:s,serviceId:i,characteristicId:n,state:c}=e;s&&isString(s)&&i&&isString(i)&&isUuid(i.toLowerCase())&&n&&isString(n)&&isUuid(n.toLowerCase())&&c&&isBoolean(c)?isMac(s.toLowerCase())?this.queryBLECharacteristic(s,i).then(e=>{console.debug("[QAFAPI] desc = "+JSON.stringify(e));var t=[],e={serviceUuid:i.toLowerCase(),characteristicUuid:n.toLowerCase(),descriptorUuid:e.descriptorUuid,descriptorValue:e.descriptorValue},e=(t.push(e),{serviceUuid:i.toLowerCase(),characteristicUuid:n.toLowerCase(),characteristicValue:this.characteristicValue,descriptors:t}),t=(console.debug("[QAFAPI] BLECharacteristic = "+JSON.stringify(e)),null);let o;if(this.gattClient&&this.deviceIdBle===s)try{o=this.gattClient.setNotifyCharacteristicChanged(e,c)}catch(e){return r([[e.message,ErrorCode$1.PARAMETER_ERROR]]),void console.error("[QAFAPI]setNotifyCharacteristicChanged errCode:"+e.code+",errMessage:"+e.message)}else try{t=BluetoothBase.createGattClientDevice(s),o=t.setNotifyCharacteristicChanged(e,c)}catch(e){return r([[e.message,ErrorCode$1.PARAMETER_ERROR]]),void console.error("[QAFAPI]setNotifyCharacteristicChanged errCode:"+e.code+",errMessage:"+e.message)}o?(console.debug("[QAFAPI] notify success"),a("ok")):r([["property not support",BLHErrorCode.PROPERTY_NOT_SUPPORT]])}):r([["deviceId is not MAC",BLHErrorCode.SYSTEM_ERROR]]):r([["invalidParam",BLHErrorCode.SYSTEM_ERROR]])}else r([["invalidParam",BLHErrorCode.SYSTEM_ERROR]])})}getBLEDeviceRSSI(a){return new Promise((t,o)=>{if(this.gattClient&&this.deviceIdBle===a)this.gattClient.getRssiValue().then(e=>{t(e)}).catch(e=>{o(e.message)});else try{var e=BluetoothBase.createGattClientDevice(a);e.connect(),this.gattClient=e,this.deviceIdBle=a,e.getRssiValue().then(e=>{t(e)}).catch(e=>{o(e.message)})}catch(e){o(e.message)}})}getTemp(){return{RSSI:"",localName:"",advertisData:"",advertisServiceUUIDs:"",name:"",serviceData:"",deviceId:""}}isRepeat(e,t){return e.some(e=>e.deviceId===t)}promptTemp(e){return PromptBase.ohosShowDialog({message:e,buttons:[{text:DEFAULT.REFUSE_BUTTON,color:"#1358e7"},{text:DEFAULT.ALLOW_BUTTON,color:"#1358e7"}]})}}).prototype,"openAdapter",[_dec$3],Object.getOwnPropertyDescriptor(_class$3.prototype,"openAdapter"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"closeAdapter",[_dec2$2],Object.getOwnPropertyDescriptor(_class$3.prototype,"closeAdapter"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"getAdapterState",[_dec3],Object.getOwnPropertyDescriptor(_class$3.prototype,"getAdapterState"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"startDevicesDiscovery",[_dec4],Object.getOwnPropertyDescriptor(_class$3.prototype,"startDevicesDiscovery"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"stopDevicesDiscovery",[_dec5],Object.getOwnPropertyDescriptor(_class$3.prototype,"stopDevicesDiscovery"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"getDevices",[_dec6],Object.getOwnPropertyDescriptor(_class$3.prototype,"getDevices"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"getConnectedDevices",[_dec7],Object.getOwnPropertyDescriptor(_class$3.prototype,"getConnectedDevices"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"createBLEConnection",[_dec8],Object.getOwnPropertyDescriptor(_class$3.prototype,"createBLEConnection"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"closeBLEConnection",[_dec9],Object.getOwnPropertyDescriptor(_class$3.prototype,"closeBLEConnection"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"getBLEDeviceServices",[_dec10],Object.getOwnPropertyDescriptor(_class$3.prototype,"getBLEDeviceServices"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"getBLEDeviceCharacteristics",[_dec11],Object.getOwnPropertyDescriptor(_class$3.prototype,"getBLEDeviceCharacteristics"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"readBLECharacteristicValue",[_dec12],Object.getOwnPropertyDescriptor(_class$3.prototype,"readBLECharacteristicValue"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"writeBLECharacteristicValue",[_dec13],Object.getOwnPropertyDescriptor(_class$3.prototype,"writeBLECharacteristicValue"),_class$3.prototype),_applyDecoratedDescriptor(_class$3.prototype,"notifyBLECharacteristicValueChange",[_dec14],Object.getOwnPropertyDescriptor(_class$3.prototype,"notifyBLECharacteristicValueChange"),_class$3.prototype);let BluetoothBaseModule=_class$3;class ASBluetooth extends BluetoothBaseModule{constructor(){super(),this.deviceFoundCallback=void 0,this.adapterStateCallback=void 0,this.BLEConnectionStateCallback=void 0,this.initBluetoothDeviceFound(),this.initBluetoothAdapterStateChange(),this.initBLEConnectionStateChange()}openBluetoothAdapter(){return new Promise(async(e,t)=>{if(!await BluetoothBase.getPermissions())return t(["permission fail",ErrorCode.USER_REJECT]);BluetoothBase.bluetoothState()===BLESTATE.STATE_ON?(this.isInit=!0,e("ok")):t([["not available",BLHErrorCode.NOT_AVAILABLE]])})}closeBluetoothAdapter(){const o=BluetoothBase.bluetoothState()===BLESTATE.STATE_OFF;return new Promise((e,t)=>{if(o)t([["bluetooth is not turned",BLHErrorCode.NOT_AVAILABLE]]);else{if(this.isInit=!1,BluetoothBase.stopBluetoothDiscovery(),this.state.discovering=!1,this.deviceIdBle="",this.scanResult=[],this.gattClient)try{this.gattClient.disconnect(),this.gattClient.close(),this.gattClient=null}catch(e){}this.isOnBle={mode:!1},this.stateBLE={},this.services=[],this.bleCharacteristic={},this.characteristicValue=null,this.devicesFoundListeners=[],this.adapterStateChangeListeners=[],this.BLEConnectionStateListeners=[],this.BLECharacteristicListeners=[],e("ok")}})}startBluetoothDevicesDiscovery(e){return this.isInit?this.startDevicesDiscovery(e):new Promise((e,t)=>{console.warn("[AdvancedAPI] bluetooth is no init"),t([["not init",BLHErrorCode.NOT_INIT]])})}stopBluetoothDevicesDiscovery(e){return this.isInit?this.stopDevicesDiscovery(e):new Promise((e,t)=>{console.warn("[AdvancedAPI] bluetooth is no init"),t([["not init",BLHErrorCode.NOT_INIT]])})}initBluetoothDeviceFound(){this.deviceFoundCallback=e=>{this.onFoundEvent(e);for(const t of this.devicesFoundListeners)setTimeout(()=>{t([this.scanResult])},this.interval)};try{BluetoothBase.on(this.deviceFoundCallback),BluetoothBase.onBLE(this.deviceFoundCallback)}catch(e){console.error("[AdvancedAPI] openHarmony ondevicefound fail "+e)}}onBluetoothDeviceFound(e){this.devicesFoundListeners.push(e)}offBluetoothDeviceFound(e){void 0===e?this.devicesFoundListeners.splice(0):"function"!=typeof e?console.error("[AdvancedAPI] offBluetoothAdapterStateChange, param is invalid:"+typeof e):-1<(e=this.devicesFoundListeners.indexOf(e))&&this.devicesFoundListeners.splice(e,1)}initBluetoothAdapterStateChange(){this.adapterStateCallback=e=>{var t=this.state.available;if(2===e?this.state.available=!0:0===e&&(this.state.available=!1),t!==this.state.available)for(const o of this.adapterStateChangeListeners)o(t)};try{BluetoothBase.onStateChange(e=>{this.adapterStateCallback(e)})}catch(e){console.error("[AdvancedAPI] onBluetoothAdapterStateChange errCode:"+e.code+",errMessage:"+e.message)}}onBluetoothAdapterStateChange(e){this.adapterStateChangeListeners.push(e)}offBluetoothAdapterStateChange(e){void 0===e?this.devicesFoundListeners.splice(0):"function"!=typeof e?console.error("[AdvancedAPI] offBluetoothAdapterStateChange, param is invalid:"):-1<(e=this.adapterStateChangeListeners.indexOf(e))&&this.adapterStateChangeListeners.splice(e,1)}getConnectedBluetoothDevices(e){return this.isInit?this.getConnectedDevices(e):new Promise((e,t)=>{console.warn("[AdvancedAPI] bluetooth is no init"),t([["not init",BLHErrorCode.NOT_INIT]])})}getBluetoothDevices(){return this.isInit?this.getDevices():new Promise((e,t)=>{console.warn("[AdvancedAPI] bluetooth is no init"),t([["not init",BLHErrorCode.NOT_INIT]])})}getBluetoothAdapterState(){return this.isInit?this.getAdapterState():new Promise((e,t)=>{console.warn("[AdvancedAPI] bluetooth is no init"),t([["not init",BLHErrorCode.NOT_INIT]])})}asSetBLEMTU(a){return new Promise((t,o)=>{if(a&&a.deviceId&&a.mtu)if(isString(a.deviceId)&&isNumber(a.mtu))try{console.debug("[AdvancedAPI] asSetBLEMTU deviceId:"+a.deviceId+" this.deviceIdBLE = "+this.deviceIdBle);let e;this.gattClient&&a.deviceId.toLowerCase()===this.deviceIdBle.toLowerCase()?(console.debug("[AdvancedAPI] asSetBLEMTU deviceId:"+a.deviceId),e=this.gattClient):((e=BluetoothBase.createGattClientDevice(a.deviceId)).connect(),this.gattClient=e,this.deviceIdBle=a.deviceId),this.gattClient.setBLEMtuSize(a.mtu),t("ok")}catch(e){console.error("[AdvancedAPI] setBLEMtuSize fail, errCode:"+e.code+",errMessage:"+e.message),o([[e.message,BLHErrorCode.SYSTEM_ERROR]])}else console.error("[AdvancedAPI] setBLEMTU fail, params error"),o([["param error",BLHErrorCode.SYSTEM_ERROR]]);else console.error("[AdvancedAPI] setBLEMTU fail, params error"),o([["param error",BLHErrorCode.SYSTEM_ERROR]])})}asWriteBLECharacteristicValue(e){return this.writeBLECharacteristicValue(e)}asReadBLECharacteristicValue(e){return this.readBLECharacteristicValue(e)}initBLEConnectionStateChange(){this.BLEConnectionStateCallback=t=>{this.BLEConnectionStateListeners.forEach(e=>{e(t)})},this.stateBLE=new Proxy({},{get:(e,t)=>e[t],set:(e,t,o)=>(e={deviceId:t,connected:e[t]=o},console.debug("AdvancedAPI bleConnectionStateChange"),this.BLEConnectionStateCallback(e),!0)})}asOnBLEConnectionStateChange(e){this.BLEConnectionStateListeners.push(e)}asOffBLEConnectionStateChange(e){void 0===e?this.BLEConnectionStateListeners.splice(0):"function"!=typeof e?console.error("[AdvancedAPI] offBLEConnectionStateChange, param is invalid:"):-1<(e=this.BLEConnectionStateListeners.indexOf(e))&&this.BLEConnectionStateListeners.splice(e,1)}asOnBLECharacteristicValueChange(e){this.BLECharacteristicListeners.push(e)}asOffBLECharacteristicValueChange(e){void 0===e?this.BLECharacteristicListeners.splice(0):"function"!=typeof e?console.error("[AdvancedAPI] offBLECharacteristicValueChange, param is invalid:"):-1<(e=this.BLECharacteristicListeners.indexOf(e))&&this.BLECharacteristicListeners.splice(e,1)}asNotifyBLECharacteristicValueChange(e){return console.debug("[AdvancedAPI] params = "+JSON.stringify(e)),this.notifyBLECharacteristicValueChange(e)}asGetBLEDeviceServices(e){return this.getBLEDeviceServices(e)}asGetBLEDeviceRSSI(e){return new Promise((t,o)=>{e&&e.deviceId&&"string"==typeof e.deviceId?this.getBLEDeviceRSSI(e.deviceId).then(e=>{t({rssi:e})}).catch(e=>{o([[e,BLHErrorCode.SYSTEM_ERROR]])}):o([["invalidParams",BLHErrorCode.SYSTEM_ERROR]])})}asGetBLEDeviceCharacteristics(e){return this.getBLEDeviceCharacteristics(e)}asCreateBLEConnection(e){return e&&console.info("[AdvancedAPI] asCreateBLEConnection params = "+JSON.stringify(e)),this.createBLEConnection(e)}asCloseBLEConnection(e){return this.closeBLEConnection(e)}}class ASWindow{constructor(){this.windowClass}getWindowClass(){return new Promise((t,o)=>{this.windowClass?t(this.windowClass):window.getLastWindow(context).then(e=>{this.windowClass=e,t(e)}).catch(e=>{console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e)),o(e)})})}setBackgroundColor(s){return new Promise((t,o)=>{const{backgroundColor:a,backgroundColorTop:e,backgroundColorBottom:r}=s;(e||r)&&console.error("[AdvancedAPI] backgroundColorTop, backgroundColorBottom do not support."),this.getWindowClass().then(e=>{e.setWindowBackgroundColor(convertColorToHexARGB(a)),t()},e=>{o([e.data,e.code])}).catch(e=>{console.error("[AdvancedAPI] setBackgroundColor fail error = "+e),o([e.data,e.code])})})}setBackgroundTextStyle(e){return new Promise((e,t)=>{console.error("[AdvancedAPI] setBackgroundTextStyle dont support."),t()})}onWindowResize(r){try{this.getWindowClass().then(e=>{e.on("windowSizeChange",e=>{var{densityPixels:t,width:o,height:a}=DisplayBase.ohosGetDisplay(),o=Math.round(o/t),a=Math.round(a/t);console.info(`[AdvancedAPI] Succeeded in enabling the listener for window size changes. Data: ${o} `+a),r({size:{windowWidth:o,windowHeight:a}})})})}catch(e){console.error("[AdvancedAPI] Failed to enable the listener for window size changes. Cause: "+JSON.stringify(e))}}offWindowResize(){try{this.getWindowClass().then(e=>{e.off("windowSizeChange",e=>{console.info("[AdvancedAPI] Succeeded in enabling the listener for window size changes. Data: "+JSON.stringify(e))})})}catch(e){console.error("[AdvancedAPI] Failed to enable the listener for window size changes. Cause: "+JSON.stringify(e))}}}const BatteryChargeState={NONE:0,ENABLE:1,DISABLE:2,FULL:3};class BatteryBase{static getBatteryInfo(){return battery}}_dec$4=jsMethod({alias:"getStatus",common:!1,callback:!0}),_applyDecoratedDescriptor((_class$4=class{getStatus(){return new Promise((e,t)=>{var o=BatteryBase.getBatteryInfo(),a={};o.chargingStatus||o.batterySOC?(a.charging=[BatteryChargeState.ENABLE,BatteryChargeState.FULL].includes(o.chargingStatus),a.level=o.batterySOC/100,e([[a]])):t([["fail to get battery level code:",ErrorCode$1.COMMON_ERROR]])})}}).prototype,"getStatus",[_dec$4],Object.getOwnPropertyDescriptor(_class$4.prototype,"getStatus"),_class$4.prototype);let BatteryBaseModule=_class$4;class ASBatteryInfo extends BatteryBaseModule{asGetBatteryInfo(){return this.getStatus()}}_dec$5=jsMethod({alias:"scan",common:!1}),_dec2$3=jsMethod({alias:"getConnectedWifi",common:!1}),_applyDecoratedDescriptor((_class$5=class{constructor(){this.SecureType={WPA:"wpa",WEP:"wep"}}isSecure(e=""){return!(!(e=e.toLowerCase()).includes(this.SecureType.WPA)&&!e.includes(this.SecureType.WEP))}getSignalStrength(e){return e+100}scan(){return new Promise((e,t)=>{WifiBase.isWifiActive()?WifiBase.scan()?e([["scan success"]]):t([["scan fail",WifiErrorCode.WIFI_NOT_TURNED_ON]]):t([["wifi not turned on",WifiErrorCode.WIFI_NOT_TURNED_ON]])})}getConnectedWifi(n){return new Promise((s,i)=>{WifiBase.isWifiActive()?WifiBase.ohoGetLinkedInfo().then(async e=>{if(e.connState===WifiBase.ConnState.DISCONNECTED)i([["wifi is not connected",ErrorCode$1.COMMON_ERROR]]);else if(n){var t={SSID:e.ssid};s([[t]])}else{var o={BSSID:e.bssid,SSID:e.ssid,frequency:e.frequency,signalStrength:this.getSignalStrength(e.rssi),secure:!1};let t;var a=await WifiBase.getScanInfos(),r=a.length;for(let e=0;e<r;e++)if(a[e].bssid===o.BSSID&&a[e].ssid===o.SSID){t=a[e].capabilities;break}t&&(o.secure=this.isSecure(t)),s([[o]])}}):i([["wifi not turned on",WifiErrorCode.WIFI_NOT_TURNED_ON]])})}}).prototype,"scan",[_dec$5],Object.getOwnPropertyDescriptor(_class$5.prototype,"scan"),_class$5.prototype),_applyDecoratedDescriptor(_class$5.prototype,"getConnectedWifi",[_dec2$3],Object.getOwnPropertyDescriptor(_class$5.prototype,"getConnectedWifi"),_class$5.prototype);let WifiBaseModule=_class$5;class ASWifi extends WifiBaseModule{constructor(){super(),this.connectCallbacks=[],this.connectWithPartialInfo=[],this._connectByNetId=[],this.wifiScanCallbacks=[],this.connectionChange(),this.scanChange()}startWifi(e){return new Promise((e,t)=>{wifi.isWifiActive()||wifi.enableWifi()?(console.debug("[AdvancedAPI] enableWifi success"),e()):(console.debug("[AdvancedAPI] enableWifi fail"),t(["wifi not turned on",WifiErrorCode.WIFI_NOT_TURNED_ON]))})}stopWifi(){return new Promise((e,t)=>{!wifi.isWifiActive()||wifi.disableWifi()?(console.debug("[AdvancedAPI] stopWifi success"),e()):(console.debug("[AdvancedAPI] stopWifi fail"),t(["system not support",ErrorCode$1.COMMON_ERROR]))})}getConnectedWifi(a={}){return new Promise((t,o)=>{var{partialInfo:e=!1}=a;super.getConnectedWifi(e).then(([[e]])=>{t({wifi:e})},e=>{o(...e)})})}getWifiList(e){return new Promise((t,o)=>{super.scan().then(([e=[]]=[])=>{t(...e)},e=>{o(...e)})})}onGetWifiList(e){"function"!=typeof e?console.error("[AdvancedAPI] param is invalid."):this.wifiScanCallbacks.push(e)}offGetWifiList(e){0<=(e=this.wifiScanCallbacks.indexOf(e))?this.wifiScanCallbacks.splice(e,1):this.wifiScanCallbacks=[]}connectWifi(n){return new Promise(async(t,o)=>{const{SSID:a,BSSID:e="",password:r="",maunal:s=!1}=n;if(isString(a))if(isString(e))if(isString(r)){try{if((await this.getConnectedWifi()).wifi.SSID===a)return void t()}catch(e){console.debug("[AdvancedAPI] wifi is not connected.")}try{var i=await wifi.addDeviceConfig({ssid:a,bssid:e,preSharedKey:r,securityType:3,isHiddenSsid:!1});console.debug("[AdvancedAPI] addDeviceConfig success netId = %d",i),this._connectByNetId.push(e=>{(e.wifi.SSID===a?t:o)()}),s?console.error("[AdvancedAPI] 不支持跳转系统wlan页面"):wifi.connectToNetwork(i)}catch(e){console.error("[AdvancedAPI] connectWifi addDeviceConfig fail err = "+e),o(["system not support",ErrorCode$1.COMMON_ERROR])}}else console.error("[AdvancedAPI] connectWifi invalid password"),o(["wifi password error",WifiErrorCode.PASSWORD_ERROR]);else console.error("[AdvancedAPI] connectWifi invalid BSSID"),o(["wifi BSSID error",WifiErrorCode.PASSWORD_ERROR]);else console.error("[AdvancedAPI] connectWifi invalid SSID"),o(["wifi SSID error",WifiErrorCode.PASSWORD_ERROR])})}onWifiConnected(e){"function"!=typeof e?console.error("[AdvancedAPI] param is invalid."):this.connectCallbacks.push(e)}offWifiConnected(e){0<=(e=this.connectCallbacks.indexOf(e))?this.connectCallbacks.splice(e,1):this.connectCallbacks=[]}connectionChange(){WifiBase.connectionChange(e=>{e===WifiBase.StateType.ON?this.getConnectedWifi().then(({wifi:e})=>{e.state=WifiBase.StateType.ON,this.triggerConnectCallbacks({wifi:e}),this.triggerConnectWithPartialInfo({wifi:e}),this.triggerConnectById({wifi:e})},()=>{var e={BSSID:"",signalStrength:0,state:WifiBase.StateType.ON,secure:!1,SSID:""};this.triggerConnectCallbacks({wifi:e}),this.triggerConnectWithPartialInfo({wifi:e})}):e===WifiBase.StateType.OFF&&(e={BSSID:"",signalStrength:0,state:WifiBase.StateType.OFF,secure:!1,SSID:""},this.triggerConnectCallbacks({wifi:e}),this.triggerConnectWithPartialInfo({wifi:e}))})}scanChange(){WifiBase.scanStateChange(e=>{e===WifiBase.ScanState.SUCCESS&&WifiBase.getScanInfos().then(e=>{console.debug("[AdvancedAPI] onGetWifiList getScanInfos success"),e=e.map(e=>({BSSID:e.bssid,SSID:e.ssid,frequency:e.frequency,signalStrength:super.getSignalStrength(e.rssi),secure:super.isSecure(e.capabilities)})),this.triggerScanCallbacks({wifiList:e})})})}triggerConnectCallbacks(t){console.debug("[AdvancedAPI] triggerConnectCallbacks"),t.errMsg="onWifiConnected:ok",t.errCode=0,this.connectCallbacks.forEach(e=>{e(t)})}triggerConnectById(t){console.debug("[AdvancedAPI] triggerConnectById"),this._connectByNetId.forEach(e=>{e(t)}),this._connectByNetId=[]}triggerScanCallbacks(t){console.debug("[AdvancedAPI] wifiScanCallbacks"),this.wifiScanCallbacks.forEach(e=>{e(t)})}onWifiConnectedWithPartialInfo(e){"function"!=typeof e?console.error("[AdvancedAPI] param is invalid."):this.connectWithPartialInfo.push(e)}offWifiConnectedWithPartialInfo(e){0<=(e=this.connectWithPartialInfo.indexOf(e))?this.connectWithPartialInfo.splice(e,1):this.connectWithPartialInfo=[]}triggerConnectWithPartialInfo(e){console.debug("[AdvancedAPI] triggerConnectWithPartialInfo");const t={SSID:e.wifi.SSID};this.connectWithPartialInfo.forEach(e=>{e({wifi:t})})}}const AUTH_RESULT={PERMISSION_CHECK_FAIL:201,PARAM_ERROR:401,FAIL:12500001,OPEN_ERROR:12500002,USER_CANCEL:12500003,TIME_OUT:12500004,TYPE_UNSUPPORTED:12500005,TRUSTED_LEVEL_UNSUPPORTED:12500006,TASK_BUSY:12500007,AUTHENTICATOR_LOCKED:12500009,NOT_ENROLLED:12500010};function toUint8Arr(e){var t=[];for(const a of e){var o=a.charCodeAt(0);o<128?t.push(o):o<2048?(t.push(192+(o>>6)),t.push(128+(63&o))):o<65536&&(t.push(224+(o>>12)),t.push(128+(o>>6&63)),t.push(128+(63&o)))}return Uint8Array.from(t)}class ASAuthentication{start(n){return new Promise((t,o)=>{if("facial"!==(n&&n.requestAuthModes||""))o({errCode:90003,errMsg:"The authentication type is not supported."});else{var e=toUint8Arr(n.challenge),a=n&&n.authContent||"",r=userIAM_userAuth.UserAuthType.FACE,s=userIAM_userAuth.AuthTrustLevel.ATL1;try{var i=userIAM_userAuth.getAuthInstance(e,r,s);i.on("result",{callback:e=>{console.debug("[AdvancedAPI] authV9 result "+e.result),console.debug("[AdvancedAPI] authV9 token "+e.token),console.debug("[AdvancedAPI] authV9 remainAttempts "+e.remainAttempts),console.debug("[AdvancedAPI] authV9 lockoutDuration "+e.lockoutDuration),e.result===AUTH_RESULT.PERMISSION_CHECK_FAIL?o({errCode:90002,errMsg:"Permission verification failed."}):e.result===AUTH_RESULT.PARAM_ERROR?o({errCode:90004,errMsg:"Incorrect parameters."}):e.result===AUTH_RESULT.FAIL?o({errCode:90009,errMsg:"Authentication failed."}):e.result===AUTH_RESULT.OPEN_ERROR?o({errCode:90009,errMsg:"General operation error."}):e.result===AUTH_RESULT.USER_CANCEL?o({errCode:90008,errMsg:"The operation is canceled."}):e.result===AUTH_RESULT.TIME_OUT?o({errCode:90007,errMsg:"The operation is time-out."}):e.result===AUTH_RESULT.TYPE_UNSUPPORTED?o({errCode:90003,errMsg:"The authentication type is not supported."}):e.result===AUTH_RESULT.TRUSTED_LEVEL_UNSUPPORTED?o({errCode:90003,errMsg:"The authentication trust level is not supported."}):e.result===AUTH_RESULT.TASK_BUSY?o({errCode:90010,errMsg:"The authentication task is busy."}):e.result===AUTH_RESULT.AUTHENTICATOR_LOCKED?o({errCode:90010,errMsg:"The authenticator is locked."}):e.result===AUTH_RESULT.NOT_ENROLLED?o({errCode:90011,errMsg:"The type of credential has not been enrolled."}):t({authMode:"facial",resultJSON:"",resultJSONSignature:"",errCode:0,errMsg:void 0})}}),i.on("tip",{callback:e=>{switch(e.tip){case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_TOO_BRIGHT:prompt$1.showToast({message:"光线太强，获取的图像太亮。"});break;case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_TOO_DARK:prompt$1.showToast({message:"光线太暗，获取的图像太暗。"});break;case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_TOO_CLOSE:prompt$1.showToast({message:"人脸距离设备过近。"});break;case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_TOO_FAR:prompt$1.showToast({message:"人脸距离设备过远。"});break;case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_TOO_HIGH:prompt$1.showToast({message:"设备太高，仅获取到人脸上部。"});break;case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_TOO_LOW:prompt$1.showToast({message:"设备太低，仅获取到人脸下部。"});break;case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_TOO_RIGHT:prompt$1.showToast({message:"设备太靠右，仅获取到人脸右部。"});break;case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_TOO_LEFT:prompt$1.showToast({message:"设备太靠左，仅获取到人脸左部。"});break;case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_TOO_MUCH_MOTION:prompt$1.showToast({message:"在图像采集过程中，用户人脸移动太快。"});break;case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_POOR_GAZE:prompt$1.showToast({message:"没有正视摄像头。"});break;case userIAM_userAuth.FaceTips.FACE_AUTH_TIP_NOT_DETECTED:prompt$1.showToast({message:"没有检测到人脸信息。"});break;default:console.debug("[AdvancedAPI] %s",JSON.stringify(e))}}}),a&&(console.debug("[AdvancedAPI] showToast authContent = %s",a),prompt$1.showToast({message:a})),i.start(),console.debug("[AdvancedAPI] authV9 start success")}catch(e){console.debug("[AdvancedAPI] authV9 start error = %s",e),o({errCode:90007,errMsg:"General operation fail."})}}})}getSupportedType(){return console.debug("[AdvancedAPI] start getSupportedType"),new Promise(e=>{e({supportMode:["facial"]})})}isEnrolled(a){return console.debug("[AdvancedAPI] start isEnrolled"),new Promise((e,t)=>{var o=a&&a.checkAuthMode||"";"fingerPrint"===o?e({isEnrolled:!1,errMsg:""}):"facial"===o&&e({isEnrolled:!1,errMsg:"The type of credential has not been enrolled."})})}}class OhosSensorBase{static ohosSubscribeAccelerometer(e){const{interval:t,callback:o}=e;sensor.on(sensor.SensorType.SENSOR_TYPE_ID_ACCELEROMETER,e=>{o(e)},{interval:t})}static ohosUnsubscribeAccelerometer(){sensor.off(sensor.SensorType.SENSOR_TYPE_ID_ACCELEROMETER)}static ohosSubscribeCompass(e){const t=e.callback;sensor.on(sensor.SensorType.SENSOR_TYPE_ID_ORIENTATION,e=>{t(e)})}static ohosUnsubscribeCompass(){sensor.off(sensor.SensorType.SENSOR_TYPE_ID_ORIENTATION)}static ohosSubscribeGyroscope(e){const{intervalValue:t,callback:o}=e;sensor.on(sensor.SensorId.GYROSCOPE,e=>{o(e)},{interval:t})}static ohosUnsubscribeGyroscope(){sensor.off(sensor.SensorId.GYROSCOPE)}}const intervalType=[{label:"game",value:2e7},{label:"ui",value:6e7},{label:"normal",value:2e8}];class ASAccelerometer{constructor(){this.callBackSet=new Set,this.defaultInterval="normal"}onAccelerometerChange(o){return new Promise((e,t)=>{"function"!=typeof o||this.callBackSet.has(o)?t("param is invalid.",ErrorCode$1.PARAMETER_ERROR):(this.callBackSet.add(o),t=intervalType.find(e=>e.label===this.defaultInterval).value,OhosSensorBase.ohosSubscribeAccelerometer({interval:t,callback:e=>{var t={x:e.x,y:e.y,z:e.z};for(const o of this.callBackSet.keys())o(t)}}),e())})}offAccelerometerChange(o){return new Promise((e,t)=>{"function"!=typeof o?(this.callBackSet.clear(),OhosSensorBase.ohosUnsubscribeAccelerometer(),e()):this.callBackSet.has(o)?(this.callBackSet.delete(o),0===this.callBackSet.size&&OhosSensorBase.ohosUnsubscribeAccelerometer(),e()):t("param is invalid.",ErrorCode$1.COMMON_ERROR)})}startAccelerometer(r){return new Promise((e,t)=>{let o=intervalType.find(e=>e.label===this.defaultInterval).value;var a;r.interval&&"string"==typeof r.interval&&(a=intervalType.find(e=>e.label===r.interval))&&(o=a.value),OhosSensorBase.ohosSubscribeAccelerometer({interval:o,callback:e=>{var t={x:e.x,y:e.y,z:e.z};for(const o of this.callBackSet.keys())o(t)}}),e()})}stopAccelerometer(){return new Promise((e,t)=>{OhosSensorBase.ohosUnsubscribeAccelerometer(),e()})}}class ASCompass{constructor(){this.callBackCompassSet=new Set}onCompassChange(o){return new Promise(async(e,t)=>{"function"!=typeof o||this.callBackCompassSet.has(o)?t("param is invalid.",ErrorCode$1.PARAMETER_ERROR):(this.callBackCompassSet.add(o),OhosSensorBase.ohosSubscribeCompass({callback:e=>{var t={direction:e.alpha,accuracy:e.alpha?3:0};for(const o of this.callBackCompassSet.keys())o(t)}}),e())})}offCompassChange(o){return new Promise(async(e,t)=>{"function"==typeof o&&this.callBackCompassSet.has(o)?(this.callBackCompassSet.delete(o),0===this.callBackCompassSet.size&&OhosSensorBase.ohosUnsubscribeCompass(),e("success")):t("param is invalid.",ErrorCode$1.PARAMETER_ERROR)})}startCompass(e){return new Promise(async(e,t)=>{OhosSensorBase.ohosSubscribeCompass({callback:e=>{var t={direction:e.alpha,accuracy:e.alpha?3:0};for(const o of this.callBackCompassSet.keys())o(t)}}),e("success")})}stopCompass(){return new Promise(async(e,t)=>{OhosSensorBase.ohosUnsubscribeCompass(),e("success")})}}const intervalType$1=[{label:"game",value:2e7},{label:"ui",value:6e7},{label:"normal",value:2e8}];class ASGyroscope{constructor(){this.callBackGyroscopeSet=new Set}onGyroscopeChange(o){return new Promise((e,t)=>{"function"!=typeof o||this.callBackGyroscopeSet.has(o)?t("param is invalid.",ErrorCode$1.PARAMETER_ERROR):(this.callBackGyroscopeSet.add(o),e())})}startGyroscope(r={}){return new Promise((e,t)=>{let o=intervalType$1.find(e=>"normal"===e.label).value;var a;r.interval&&"string"==typeof r.interval&&(a=intervalType$1.find(e=>e.label===r.interval))&&(o=a.value),OhosSensorBase.ohosSubscribeGyroscope({intervalValue:o,callback:e=>{var t={x:e.x,y:e.y,z:e.z};for(const o of this.callBackGyroscopeSet.keys())o(t)}}),e()})}stopGyroscope(){return new Promise((e,t)=>{OhosSensorBase.ohosUnsubscribeGyroscope(),e()})}}class ASContact{addPhoneContact(L){return new Promise(async(t,o)=>{try{if(0!==(e=(await abilityAccessCtrl.createAtManager().requestPermissionsFromUser(context,["ohos.permission.WRITE_CONTACTS"])).authResults)[0])return void o(["request permission fail",ErrorCode$1.USER_REJECT]);console.debug("[AdvancedAPI] request WRITE_CONTACTS permission success")}catch(e){return void o(["request permission fail",ErrorCode$1.USER_REJECT])}var{photoFilePath:e,nickName:a="",lastName:r="",middleName:s="",firstName:i="",remark:n,mobilePhoneNumber:c,weChatNumber:l,addressCountry:d="",addressState:u="",addressCity:h="",addressStreet:p="",addressPostalCode:g,organization:f,url:A,workPhoneNumber:m,workFaxNumber:y,hostNumber:S,email:v,title:P,workAddressCountry:b="",workAddressState:C="",workAddressCity:E="",workAddressStreet:I="",workAddressPostalCode:k,homeFaxNumber:R,homePhoneNumber:T,homeAddressCountry:w="",homeAddressState:B="",homeAddressCity:_="",homeAddressStreet:M="",homeAddressPostalCode:O}=L;l||console.error("[AdvancedAPI] weChatNumber do not support."),i?(l={name:{familyName:r,middleName:s,givenName:i,fullName:r+s+i},nickName:{nickName:a},emails:[{email:v,displayName:"邮箱"}],phoneNumbers:[{phoneNumber:T,labelId:contact.PhoneNumber.NUM_HOME},{phoneNumber:c,labelId:contact.PhoneNumber.NUM_MOBILE},{phoneNumber:R,labelId:contact.PhoneNumber.NUM_FAX_HOME},{phoneNumber:y,labelId:contact.PhoneNumber.NUM_FAX_WORK},{phoneNumber:m,labelId:contact.PhoneNumber.NUM_WORK},{phoneNumber:S,labelId:contact.PhoneNumber.NUM_COMPANY_MAIN}],portrait:{uri:e},postalAddresses:[{city:_,country:w,postcode:O,street:M,postalAddress:w+B+_+M,labelId:contact.PostalAddress.ADDR_HOME},{city:E,country:b,postcode:k,street:I,postalAddress:b+C+E+I,labelId:contact.PostalAddress.ADDR_WORK},{city:h,country:d,postcode:g,street:p,postalAddress:d+u+h+p,labelId:contact.PostalAddress.CUSTOM_LABEL}],websites:[{website:A}],note:{noteContent:n},organization:{name:f,title:P}},contact.addContact(l).then(e=>{console.debug("[AdvancedAPI] addContact callback: success contactId = "+e),t()}).catch(e=>{console.debug("[AdvancedAPI] addContact callback: err->"+JSON.stringify(e)),o([e.data,e.code])})):(console.error("[AdvancedAPI] firstName is required."),o(["fail Missing required parameter `firstName`",ErrorCode$1.PARAMETER_ERROR]))})}}class ASVibrator{vibrate(){return new Promise((t,o)=>{this.triggerVibrate({duration:200}).then(e=>{t(e)}).catch(e=>{o([e.data,e.code])})})}vibrateLong(){return new Promise((t,o)=>{this.triggerVibrate({duration:400}).then(e=>{t(e)}).catch(e=>{o([e.data,e.code])})})}vibrateShort(){return new Promise((t,o)=>{this.triggerVibrate({duration:15}).then(e=>{t(e)}).catch(e=>{o([e.data,e.code])})})}triggerVibrate(a){return new Promise((t,o)=>{var e={type:"time",duration:a.duration};vibrator.startVibration(e,{id:0,usage:"alarm"}).then(e=>{console.debug("[AdvancedAPI] startVibration success"),t(e)},e=>{console.error("[AdvancedAPI] startVibration fail err = "+JSON.stringify(e)),o(e)}).catch(e=>{console.error("[AdvancedAPI] startVibration fail err = "+JSON.stringify(e)),o(e)})})}}class ASCapture{constructor(){this.captureCallback=null}onUserCaptureScreen(t){if(t)try{window.getLastWindow(globalThis.abilityContext).then(e=>{this.windowClass=e,this.captureCallback&&(this.windowClass.off("screenshot"),this.captureCallback=null),this.captureCallback=t,console.info("[AdvancedAPI] Succeeded in obtaining the top window. Listen to screenshot event.");try{this.windowClass.on("screenshot",function(){t("ohos not support path")})}catch(e){console.error("[AdvancedAPI] Failed to register callback. Cause: "+JSON.stringify(e))}}).catch(e=>{console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e))})}catch(e){console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e))}else console.error("[AdvancedAPI] params illegal, empty callback")}offUserCaptureScreen(t){try{window.getLastWindow(globalThis.abilityContext).then(e=>{this.windowClass=e,console.info("[AdvancedAPI] Succeeded in obtaining the top window. Unsubscribe screenshot event.");try{!t||this.captureCallback&&this.captureCallback===t?(this.windowClass.off("screenshot"),this.captureCallback=null):console.info("[AdvancedAPI] Invalid callback.")}catch(e){console.error("[AdvancedAPI] Failed to unregister callback. Cause: "+JSON.stringify(e))}}).catch(e=>{console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e))})}catch(e){console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e))}}setUserCaptureScreen(a){return new Promise((t,o)=>{try{window.getLastWindow(globalThis.abilityContext).then(e=>{this.windowClass=e,console.info("[AdvancedAPI] Succeeded in obtaining the top window.");try{this.windowClass.setWindowPrivacyMode(!a).then(()=>{console.info("[AdvancedAPI] Succeeded in setting screenshot mode to "+a),t({errMsg:"success",errCode:0,errSubject:""})}).catch(e=>{console.error("[AdvancedAPI] Failed to set screenshot mode. Cause: "+JSON.stringify(e)),o([e.message,e.code])})}catch(e){console.error("[AdvancedAPI] Failed to set screenshot mode. Cause:"+JSON.stringify(e)),o([e.message,e.code])}}).catch(e=>{console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e)),o([e.message,e.code])})}catch(e){console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e)),o([e.message,e.code])}})}}class ASKeyboard{constructor(){this.changeCallback=new Map}hideKeyboard(){return new Promise((e,t)=>{try{inputMethod.getController().hideTextInput().then(()=>{console.debug("[AdvancedAPI] Succeeded in hiding softKeyboard."),e()}).catch(e=>{console.error("[AdvancedAPI] Failed to hideSoftKeyboard: "+JSON.stringify(e)),t()})}catch(e){console.error("[AdvancedAPI] Failed to get inputMethod Controller. Cause: "+JSON.stringify(e)),t()}})}onKeyboardHeightChange(o){if(o)try{window.getLastWindow(globalThis.abilityContext).then(e=>{this.windowClass=e;const t=DisplayBase.ohosGetDisplay().densityPixels;this.changeCallback.has(o)||this.changeCallback.set(o,function(e){o({height:Math.round(e/t)})}),console.info("[AdvancedAPI] Succeeded in obtaining the top window. Listen to keyboard height change");try{this.windowClass.on("keyboardHeightChange",this.changeCallback.get(o))}catch(e){console.error("[AdvancedAPI] Failed to enable the listener for keyboard height changes. Cause: "+JSON.stringify(e))}}).catch(e=>{console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e))})}catch(e){console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e))}else console.error("[AdvancedAPI] params illegal, empty callback")}offKeyboardHeightChange(t){try{window.getLastWindow(globalThis.abilityContext).then(e=>{this.windowClass=e,console.info("[AdvancedAPI] Succeeded in obtaining the top window. Unsubscribe keyboard change event.");try{t?this.changeCallback.has(t)?(this.windowClass.off("keyboardHeightChange",this.changeCallback.get(t)),this.changeCallback.delete(t)):console.info("[AdvancedAPI] Invalid callback."):(this.windowClass.off("keyboardHeightChange"),this.changeCallback.clear())}catch(e){console.error("[AdvancedAPI] Failed to unregister callback. Cause: "+JSON.stringify(e))}}).catch(e=>{console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e))})}catch(e){console.error("[AdvancedAPI] Failed to obtain the top window. Cause: "+JSON.stringify(e))}}}class ASAccount{async login(){return this.silentLoginWithPromise()}async getUserInfo(){const a=(new authentication.HuaweiIDProvider).createAuthorizationWithHuaweiIDRequest();return a.scopes=["profile"],a.permissions=["https://www.huawei.com/auth/account/base.profile/serviceauthcode","idtoken"],a.forceAuthorization=!0,a.state="xxxx",new authentication.AuthenticationController(context).executeRequest(a).then(e=>{var t,o=e.state;return a.state!==o?Promise.reject(["auth fail,The state is different:"+o]):(e=(o=e.data).avatarUri,t=o.nickName,o=o.authorizationCode,Promise.resolve({userInfo:{nickName:t,avatarUri:e},code:o}))}).catch(e=>Promise.reject(["auth fail,error:"+e.errMsg,e.code]))}loginWithUI(){const t=(new authentication.HuaweiIDProvider).createLoginWithHuaweiIDRequest();return t.forceLogin=!0,t.state="xxxx",new authentication.AuthenticationController(context).executeRequest(t).then(e=>this.handleResult(e,t)).catch(e=>Promise.reject(["login fail,error:"+e.errMsg,e.code]))}silentLoginWithPromise(){const t=(new authentication.HuaweiIDProvider).createLoginWithHuaweiIDRequest();return t.forceLogin=!1,t.state="xxxx",new authentication.AuthenticationController(context).executeRequest(t).then(e=>this.handleResult(e,t)).catch(e=>1001502001===e.code?this.loginWithUI():Promise.reject(["login fail,error:"+e.errMsg,e.code]))}handleResult(e,t){var o,a=e.state;return t.state!==a?Promise.reject(["login fail,The state is different:"+a]):(a=(t=e.data).authorizationCode,e=t.idToken,o=t.openID,t=t.unionID,Promise.resolve({code:a,idToken:e,openID:o,unionID:t}))}}class MediaLibraryBase{static getPermissions(){const e=["ohos.permission.READ_MEDIA","ohos.permission.WRITE_MEDIA"],o=abilityAccessCtrl.createAtManager();return new Promise(t=>{o.requestPermissionsFromUser(context,e).then(e=>{e=e.authResults.reduce((e,t)=>e+t),t(0===e)})})}static getMediaType(e){return mediaLibrary.MediaType[e]}static getFileKey(){return mediaLibrary.FileKey}static getMedia(){return mediaLibrary.getMediaLibrary(context)}static createAsset(e,t,o,a){return t=mediaLibrary.MediaType[t],e.createAsset(t,o,a)}static closeAsset(e,o){return new Promise(t=>{e.close(o,e=>{t(void 0===e)})})}static getPublicDirectory(e,t){return e.getPublicDirectory(mediaLibrary.DirectoryType[t])}static getFd(e){return new Promise(t=>{e.open("rw").then(e=>{t(e)}).catch(()=>{t(!1)})})}}class WantConstantBase{static getAction(e){return wantConstant.Action[e]}}const version="3.7.7",VERSION=version,_hasBuffer="function"==typeof Buffer,_TD="function"==typeof TextDecoder?new TextDecoder:void 0,_TE="function"==typeof TextEncoder?new TextEncoder:void 0,b64ch="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",b64chs=Array.prototype.slice.call(b64ch),b64tab=(e=>{let o={};return e.forEach((e,t)=>o[e]=t),o})(b64chs),b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,_fromCC=String.fromCharCode.bind(String),_U8Afrom="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),_mkUriSafe=e=>e.replace(/=/g,"").replace(/[+\/]/g,e=>"+"==e?"-":"_"),_tidyB64=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),btoaPolyfill=t=>{let o,a,r,s,i="";var e=t.length%3;for(let e=0;e<t.length;){if(255<(a=t.charCodeAt(e++))||255<(r=t.charCodeAt(e++))||255<(s=t.charCodeAt(e++)))throw new TypeError("invalid character found");o=a<<16|r<<8|s,i+=b64chs[o>>18&63]+b64chs[o>>12&63]+b64chs[o>>6&63]+b64chs[63&o]}return e?i.slice(0,e-3)+"===".substring(e):i},_btoa="function"==typeof btoa?e=>btoa(e):_hasBuffer?e=>Buffer.from(e,"binary").toString("base64"):btoaPolyfill,_fromUint8Array=_hasBuffer?e=>Buffer.from(e).toString("base64"):o=>{var a=[];for(let e=0,t=o.length;e<t;e+=4096)a.push(_fromCC.apply(null,o.subarray(e,e+4096)));return _btoa(a.join(""))},fromUint8Array=(e,t=!1)=>t?_mkUriSafe(_fromUint8Array(e)):_fromUint8Array(e),cb_utob=e=>{var t;return e.length<2?(t=e.charCodeAt(0))<128?e:t<2048?_fromCC(192|t>>>6)+_fromCC(128|63&t):_fromCC(224|t>>>12&15)+_fromCC(128|t>>>6&63)+_fromCC(128|63&t):(t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320),_fromCC(240|t>>>18&7)+_fromCC(128|t>>>12&63)+_fromCC(128|t>>>6&63)+_fromCC(128|63&t))},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=e=>e.replace(re_utob,cb_utob),_encode=_hasBuffer?e=>Buffer.from(e,"utf8").toString("base64"):_TE?e=>_fromUint8Array(_TE.encode(e)):e=>_btoa(utob(e)),encode=(e,t=!1)=>t?_mkUriSafe(_encode(e)):_encode(e),encodeURI$1=e=>encode(e,!0),re_btou=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,cb_btou=e=>{switch(e.length){case 4:var t=((7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3))-65536;return _fromCC(55296+(t>>>10))+_fromCC(56320+(1023&t));case 3:return _fromCC((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return _fromCC((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=e=>e.replace(re_btou,cb_btou),atobPolyfill=t=>{if(t=t.replace(/\s+/g,""),!b64re.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(3&t.length));let o,a="",r,s;for(let e=0;e<t.length;)o=b64tab[t.charAt(e++)]<<18|b64tab[t.charAt(e++)]<<12|(r=b64tab[t.charAt(e++)])<<6|(s=b64tab[t.charAt(e++)]),a+=64===r?_fromCC(o>>16&255):64===s?_fromCC(o>>16&255,o>>8&255):_fromCC(o>>16&255,o>>8&255,255&o);return a},_atob="function"==typeof atob?e=>atob(_tidyB64(e)):_hasBuffer?e=>Buffer.from(e,"base64").toString("binary"):atobPolyfill,_toUint8Array=_hasBuffer?e=>_U8Afrom(Buffer.from(e,"base64")):e=>_U8Afrom(_atob(e).split("").map(e=>e.charCodeAt(0))),toUint8Array=e=>_toUint8Array(_unURI(e)),_decode=_hasBuffer?e=>Buffer.from(e,"base64").toString("utf8"):_TD?e=>_TD.decode(_toUint8Array(e)):e=>btou(_atob(e)),_unURI=e=>_tidyB64(e.replace(/[-_]/g,e=>"-"==e?"+":"/")),decode=e=>_decode(_unURI(e)),isValid=e=>"string"==typeof e&&(e=e.replace(/\s+/g,"").replace(/={0,2}$/,""),!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)),_noEnum=e=>({value:e,enumerable:!1,writable:!0,configurable:!0}),extendString=function(){var e=(e,t)=>Object.defineProperty(String.prototype,e,_noEnum(t));e("fromBase64",function(){return decode(this)}),e("toBase64",function(e){return encode(this,e)}),e("toBase64URI",function(){return encode(this,!0)}),e("toBase64URL",function(){return encode(this,!0)}),e("toUint8Array",function(){return toUint8Array(this)})},extendUint8Array=function(){var e=(e,t)=>Object.defineProperty(Uint8Array.prototype,e,_noEnum(t));e("toBase64",function(e){return fromUint8Array(this,e)}),e("toBase64URI",function(){return fromUint8Array(this,!0)}),e("toBase64URL",function(){return fromUint8Array(this,!0)})},extendBuiltins=()=>{extendString(),extendUint8Array()},gBase64={version:version,VERSION:VERSION,atob:_atob,atobPolyfill:atobPolyfill,btoa:_btoa,btoaPolyfill:btoaPolyfill,fromBase64:decode,toBase64:encode,encode:encode,encodeURI:encodeURI$1,encodeURL:encodeURI$1,utob:utob,btou:btou,decode:decode,isValid:isValid,fromUint8Array:fromUint8Array,toUint8Array:toUint8Array,extendString:extendString,extendUint8Array:extendUint8Array,extendBuiltins:extendBuiltins};class ASImage{constructor(){_defineProperty(this,"getArrayBuffer",async(e,t,o,a,r)=>{var s,i,n;return void 0!==a||void 0!==r?(a=r||a||0,n=image.createImageSource(t),i=image.createImagePacker(),r=(s=await n.getImageInfo()).size.width/r,n=await n.createPixelMap({desiredSize:{width:a,height:s.size.height/r}}),await i.packing(n,{format:"image/jpeg",quality:e})):(a=image.createImageSource(t),s=image.createImagePacker(),r={format:"image/jpeg",quality:e},i=await a.getImageInfo(),n=await a.createPixelMap({desiredSize:{width:i.size.width,height:i.size.height}}),await s.packing(n,r))})}chooseImage(n){return n=n||{},new Promise(async(e,t)=>{if(!await MediaLibraryBase.getPermissions())return t(["permission fail",ErrorCode$1.USER_REJECT]);if(n.count&&"number"!=typeof n.count)return t(['chooseImage:fail parameter `count`. Expected Number with value NaN, got String with value "'+n.count+'".',ErrorCode$1.PARAMETER_ERROR]);n.count<1&&(n.count=9);let o=[];if(n.sourceType&&1===n.sourceType.length&&n.sourceType.includes("camera")){var a=await bundleManager.getBundleInfoForSelf(bundleManager.BundleFlag.GET_BUNDLE_INFO_DEFAULT);if(0!==(a=await context.startAbilityForResult({action:WantConstantBase.getAction("ACTION_IMAGE_CAPTURE"),parameters:{uri:"capture",callBundleName:a.name}})).resultCode)return t(["Failed to pull up camera app",ErrorCode$1.SERVICE_UNAVIALABLE]);if(o=[a.want.parameters.resourceUri],!a.want.parameters.resourceUri)return}else(a=new picker.PhotoSelectOptions).MIMEType=picker.PhotoViewMIMETypes.IMAGE_TYPE,a.maxSelectNumber=n.count,a=await(new picker.PhotoViewPicker).select(a),o=a.photoUris;if(!o)return t(["get uri fail",ErrorCode$1.SERVICE_UNAVIALABLE]);if("cancel"!==o){var r,s=[],i=[];for(let e=0;e<o.length;e++)n.sizeType&&1===n.sizeType.length&&n.sizeType.includes("compressed")?(r=await this.compressImage({src:o[e]})).tempFilePath&&(s.push(r.tempFilePath),i.push({path:r.tempFilePath,size:r.tempSize,name:r.tempName,type:r.tempFilePath.split(".").pop()})):(r=await getFileAssetFromUri(o[e]),s.push(o[e]),i.push({path:o[e],size:r.size,name:r.displayName,type:r.displayName.split(".").pop()}));return e({tempFilePaths:s,tempFiles:i})}})}async previewImage(e){}closePreviewImage(e){}getImageInfo(c){return new Promise(async(e,t)=>{try{var o,a,r,s,i,n=c.src;return isFileUri(n)?(a={0:"up",90:"right",180:"down",270:"left"}[(o=await getFileAssetFromUri(n)).orientation],e({width:o.width,height:o.height,path:n,orientation:a,type:o.displayName.split(".").pop()})):isSandboxPath(n)?(r=image.createImageSource(switchInternalToHapSandBox(n)),s=n.split(".").pop(),e({width:(i=await r.getImageInfo()).size.width,height:i.size.height,path:c.src,orientation:"up",type:s})):t(["get uri fail",ErrorCode$1.SERVICE_UNAVIALABLE])}catch(e){return t(["get uri fail",ErrorCode$1.SERVICE_UNAVIALABLE])}})}saveImageToPhotosAlbum(e){return new Promise(async(o,a)=>{var r=e.filePath;if(!await MediaLibraryBase.getPermissions())return a(["permission fail",ErrorCode$1.USER_REJECT]);if("string"!=typeof r)return a(["filePath format is not supported.",ErrorCode$1.PARAMETER_ERROR]);if(isFileUri(r))return i=getFdFromUriOrSandBoxPath(n=r),s=fs.statSync(i).size,s=new ArrayBuffer(s),FileioBase.ohosReadSync(i,s),i=await getFileAssetFromUri(n),n=MediaLibraryBase.getMedia(),c=await MediaLibraryBase.getPublicDirectory(n,"DIR_IMAGE"),i="IMAGE_"+(new Date).getTime()+"_"+i.displayName,n=await MediaLibraryBase.createAsset(n,"IMAGE",i,c),(i=await MediaLibraryBase.getFd(n))?(FileioBase.ohosWriteSync(i,s),await MediaLibraryBase.closeAsset(n,i),void o({path:n.uri})):void a(["saveImageToPhotosAlbum fail, src not exist.",ErrorCode$1.PARAMETER_ERROR]);if(isSandboxPath(r)){let e=r;if(e.startsWith("internal://")&&(e=switchInternalToHapSandBox(r)),!fs.accessSync(e))return void a(["saveImageToPhotosAlbum fail, src not exist.",ErrorCode$1.PARAMETER_ERROR]);if(!(c=fs.openSync(e,fs.OpenMode.READ_ONLY)))return void a(["saveImageToPhotosAlbum fail, src not exist.",ErrorCode$1.PARAMETER_ERROR]);var s=c.fd,i=fs.statSync(e).size,n=new ArrayBuffer(i),c=(FileioBase.ohosReadSync(s,n),MediaLibraryBase.getMedia()),i=await MediaLibraryBase.getPublicDirectory(c,"DIR_IMAGE");let t="IMAGE_"+(new Date).getTime()+"_"+e.split("/").splice(-1,1).toString();return t.includes(".")||(t+=".jpg"),s=await MediaLibraryBase.createAsset(c,"IMAGE",t,i),(c=await MediaLibraryBase.getFd(s))?(FileioBase.ohosWriteSync(c,n),await MediaLibraryBase.closeAsset(s,c),void o({path:s.uri})):void a(["saveImageToPhotosAlbum fail, src not exist.",ErrorCode$1.PARAMETER_ERROR])}if(r.startsWith("data:image/")&&2===(i=r.split(";")).length&&i[1].startsWith("base64")){var n=i[0].replace("data:image/",""),t=gBase64.atob(r.split(",")[1]),c=MediaLibraryBase.getMedia(),s=await MediaLibraryBase.getPublicDirectory(c,"DIR_IMAGE"),i="IMAGE_"+(new Date).getTime()+"."+n,r=await MediaLibraryBase.createAsset(c,"IMAGE",i,s);if(n=await MediaLibraryBase.getFd(r)){var c=new ArrayBuffer(t.length),l=new Uint8Array(c);for(let e=0;e<t.length;e++)l[e]=t.charCodeAt(e);FileioBase.ohosWriteSync(n,l.buffer),await MediaLibraryBase.closeAsset(r,n),o({path:r.uri})}else a(["saveImageToPhotosAlbum fail, src not exist.",ErrorCode$1.PARAMETER_ERROR])}else a(["filePath format is not supported.",ErrorCode$1.PARAMETER_ERROR])})}compressImage(g){return new Promise(async(o,e)=>{var a=switchInternalToHapSandBox(g.src),r=0<=(a.split("/").pop()||"").indexOf(".")&&g.src.toLowerCase().split(".").pop()||"jpg";let s=g.quality||80;if(!await MediaLibraryBase.getPermissions())return e(["permission fail",ErrorCode$1.USER_REJECT]);if(s&&"number"!=typeof s)return e(["compressImage fail, input parameter quality is illegal.",ErrorCode$1.PARAMETER_ERROR]);(100<s||s<0)&&(s=80);try{let t;if(isSandboxPath(a)){if(!fs.accessSync(a))return void e(["compressImage fail, src not exist.",ErrorCode$1.PARAMETER_ERROR]);var i=fs.openSync(a,fs.OpenMode.READ_ONLY);if(!i)return void e(["compressImage fail, src not exist.",ErrorCode$1.PARAMETER_ERROR]);t=i.fd}else isFileUri(a)&&(t=getFdFromUriOrSandBoxPath(a));if(["jpg","png","webp","jpeg"].includes(r)){var n=await this.getArrayBuffer(s,t,r,g.compressHeight,g.compressedWidth),c=(new Date).getTime(),l="IMAGE_"+c,d=context.tempDir+"/"+c+"/"+l+"."+g.src.toLowerCase().split(".").pop();let e;try{await fs.mkdir(context.tempDir+"/"+c),fs.openSync(d,fs.OpenMode.CREATE);var u=fs.openSync(d,fs.OpenMode.READ_WRITE),h=(FileioBase.ohosWriteSync(u.fd,n),fs.openSync(d,fs.OpenMode.READ_ONLY)),p=fs.statSync(h.fd);e=p.size,fs.closeSync(u)}catch(a){console.info(""+JSON.stringify(a))}o({tempFilePath:d,tempSize:e,tempName:l})}}catch(a){e(["compressImage fail, src not exist.",ErrorCode$1.PARAMETER_ERROR])}})}}class ASRecorder{constructor(){this.recorder=globalThis.commonAvRecorder,this.recorderMgr=null}getRecorderManager(){if(this.recorderMgr)return this.recorderMgr;try{if(this.recorder)return this.recorderMgr=this.initRecorderManager(this.recorder),this.recorderMgr}catch(e){}}initRecorderManager(r){var e={};const s=MediaLibraryBase.getMedia();let p,g,f,A,m,y,S,v=!0,P,b;return r.on("stateChange",async(e,t)=>{switch(console.info("[AdvancedAPI] case state has changed, new state is :"+e),e){case"idle":v=!0;break;case"prepared":break;case"started":v?(v=!1,p&&p()):(console.info("[AdvancedAPI] case state has changed, new state is : Resume"),2===t&&S&&S(),A&&A());break;case"paused":2===t&&y&&y(),g&&g();break;case"stopped":var o=(new Date).getTime(),a=context.cacheDir+"/"+o+"/RECORD_"+(new Date).getTime()+".m4a";try{await fs.mkdir(context.cacheDir+"/"+o),fs.openSync(a,fs.OpenMode.CREATE);var r=fs.openSync(a,fs.OpenMode.READ_WRITE),s=MediaLibraryBase.getMedia(),i=MediaLibraryBase.getFileKey(),n=MediaLibraryBase.getMediaType("AUDIO"),c={selections:i.MEDIA_TYPE+"= ?",selectionArgs:[n.toString()],uri:P.uri},l=await(await s.getFileAssets(c)).getFirstObject(),d=await l.open("r"),u=fs.statSync(d),h=new ArrayBuffer(u.size);FileioBase.ohosReadSync(d,h),FileioBase.ohosWriteSync(r.fd,h),fs.closeSync(r),await P.close(b),await l.close(d)}catch(e){console.info(""+JSON.stringify(e))}f&&f({tempFilePath:a}),v=!0;break;case"released":break;case"error":m&&m();break;default:console.info("[AdvancedAPI] case state is unknown")}}),e.start=async e=>{var t,o,a;await MediaLibraryBase.getPermissions()&&({sampleRate:e=48e3,numberOfChannels:a=2,encodeBitRate:o=48e3,duration:t=null}=e=e||{},o={audioBitrate:o,audioChannels:a,audioCodec:media.CodecMimeType.AUDIO_AAC,audioSampleRate:e,fileFormat:media.ContainerFormatType.CFT_MPEG_4},a=await MediaLibraryBase.getPublicDirectory(s,"DIR_AUDIO"),e=(new Date).getTime().toString(16)+".m4a",P=await MediaLibraryBase.createAsset(s,"AUDIO",e,a),b=await MediaLibraryBase.getFd(P),e={audioSourceType:media.AudioSourceType.AUDIO_SOURCE_TYPE_MIC,profile:o,url:"fd://"+b},0===(await abilityAccessCtrl.createAtManager().requestPermissionsFromUser(context,["ohos.permission.MICROPHONE"])).authResults[0])?(await r.prepare(e).catch(e=>{console.error(e)}),await r.start(),t&&setTimeout(async()=>{await r.stop(),await MediaLibraryBase.closeAsset(P,b)},t)):console.info('{"errMsg":"permission fail"}')},e.pause=()=>{r.pause()},e.resume=()=>{r.resume()},e.stop=async()=>{await r.stop(),await MediaLibraryBase.closeAsset(P,b)},e.onStart=e=>{p=e},e.onPause=e=>{g=e},e.onStop=e=>{f=e},e.onResume=e=>{A=e},e.onInterruptionBegin=e=>{y=e},e.onInterruptionEnd=e=>{S=e},e.onFrameRecorded=e=>{},e.onError=e=>{m=e},e}}class ASMediaFile{chooseFile(e){const i=["FILE","IMAGE","VIDEO","AUDIO"];return new Promise(async(e,t)=>{if(!await MediaLibraryBase.getPermissions())return t(["permission fail",ErrorCode$1.USER_REJECT]);var t=new picker.DocumentSelectOptions,o=await(new picker.DocumentViewPicker).select(t);if(o){var a=[],r=[];for(let e=0;e<o.length;e++){var s=await getFileAssetFromUri(o[e]);a.push(o[e]),r.push({path:o[e],size:s.size,name:s.displayName,type:i[s.mediaType]})}e({tempFilePaths:a,tempFiles:r})}})}}const StateType={IDLE:"idle",INITIALIZED:"initialized",PREPARED:"prepared",PLAYING:"playing",PAUSED:"paused",COMPLETED:"completed",STOPPED:"stopped",RELEASED:"released",ERROR:"error"};class ASAudio{createInnerAudioContext(){return new InnerAudioContext}}class InnerAudioContext{constructor(){_defineProperty(this,"count",0),_defineProperty(this,"stopFlag",!1),this.tempSrc="",this.startTimeS=0,this.autoplayS=!1,this.playbackRateS=1,this.bufferedS=0,this.volumeS=1,this.tempLoop=!1,this.onCanplayCallback=null,this.onPlayCallback=null,this.onPauseCallback=null,this.onStopCallback=null,this.onEndedCallback=null,this.onTimeUpdateCallback=null,this.onErrorCallback=null,this.onWaitingCallback=null,this.onSeekedCallback=null,this.onSeekingCallback=null,this.init()}async init(){this.avPlayer=await media.createAVPlayer(),this.avPlayer.on("seekDone",e=>{console.info("AVPlayer seek succeeded, seek time is "+e),this.onSeekedCallback&&this.onSeekedCallback({})}),this.avPlayer.on("error",e=>{console.error(`Invoke avPlayer failed, code is ${e.code}, message is `+e.message),this.avPlayer.reset(),this.onErrorCallback&&this.onErrorCallback(e)}),this.avPlayer.on("stateChange",async(e,t)=>{switch(e){case"idle":console.info("AVPlayer state idle called."),this.stopFlag&&(this.avPlayer.url=this.tempSrc,this.stopFlag=!1);break;case"initialized":console.info("AVPlayerstate initialized called."),this.avPlayer.prepare().then(()=>{console.info("AVPlayer prepare succeeded."),this.onCanplayCallback&&this.onCanplayCallback({})},e=>{console.error(`Invoke prepare failed, code is ${e.code}, message is `+e.message)});break;case"prepared":console.info("AVPlayer state prepared called."),0===this.count&&this.autoplayS&&(this.avPlayer.play(),this.onPlayCallback&&this.onPlayCallback({}),this.startTimeS)&&(this.onSeekingCallback&&this.onSeekingCallback({}),this.avPlayer.seek(this.startTimeS)),this.count++,this.avPlayer.loop=this.tempLoop,this.avPlayer.setVolume(this.volumeS),this.avPlayer.setSpeed(this.playbackRateS);break;case"playing":console.info("AVPlayer state playing called."),this.avPlayer.loop=this.tempLoop,this.avPlayer.setVolume(this.volumeS),this.avPlayer.setSpeed(this.playbackRateS);break;case"paused":console.info("AVPlayer state paused called."),this.avPlayer.loop=this.tempLoop,this.avPlayer.setVolume(this.volumeS),this.avPlayer.setSpeed(this.playbackRateS);break;case"completed":console.info("AVPlayer state completed called."),this.onEndedCallback&&this.onEndedCallback({}),this.avPlayer.loop=this.tempLoop,this.avPlayer.setVolume(this.volumeS),this.avPlayer.setSpeed(this.playbackRateS);break;case"stopped":console.info("AVPlayer state stopped called."),this.avPlayer.reset(),this.stopFlag=!0;break;case"released":console.info("AVPlayer state released called.");break;default:console.info("AVPlayer state unknown called.")}}),this.avPlayer.on("timeUpdate",e=>{this.onTimeUpdateCallback&&this.onTimeUpdateCallback(e/1e3)}),this.avPlayer.on("bufferingUpdate",(e,t)=>{console.info(`[AdvancedAPI] avPlayer bufferingUpdate ${e} `+t),3===e&&0!==t&&(this.bufferedS=t,this.avPlayer.currentTime/1e3>=this.avPlayer.duration*t/1e5)&&this.onWaitingCallback&&this.onWaitingCallback({})}),this.avPlayer.on("audioInterrupt",e=>{console.info("[AdvancedAPI]  audioInterrupt:"+JSON.stringify(e)),e.hintType===audio.InterruptHint.INTERRUPT_HINT_PAUSE&&(this.avPlayer.pause(),this.onPauseCallback)&&this.onPauseCallback({})}),this.avPlayer.on("endOfStream",()=>{console.info("[AdvancedAPI]  rePlay:endOfStream success"),this.avPlayer.loop&&(this.avPlayer.play(),this.startTimeS)&&(this.onSeekingCallback&&this.onSeekingCallback({}),this.avPlayer.seek(this.startTimeS))})}get duration(){return this.avPlayer?this.avPlayer.duration/1e3:(console.error("[AdvancedAPI] avPlayer is not exist, get duration fail"),0)}get currentTime(){return this.avPlayer?this.avPlayer.currentTime/1e3:(console.error("[AdvancedAPI] avPlayer is not exist, get currentTime fail"),0)}get paused(){return this.avPlayer?this.avPlayer.state===StateType.PAUSED:(console.error("[AdvancedAPI] avPlayer is not exist, get paused fail"),!0)}get loop(){return this.tempLoop}set loop(e){"boolean"!=typeof e?console.error(`[AdvancedAPI] loop: ${e} is invalid`):(this.tempLoop=e,this.avPlayer&&[StateType.PREPARED,StateType.PLAYING,StateType.PAUSED,StateType.COMPLETED].includes(this.avPlayer.state)&&(console.info("current state is "+this.avPlayer.state+" can set loop"),this.avPlayer.loop=e))}get volume(){return this.volumeS}set volume(e){"number"!=typeof e?console.error(`[AdvancedAPI] volume: ${e} is invalid`):(this.volumeS=e,this.avPlayer&&[StateType.PREPARED,StateType.PLAYING,StateType.PAUSED,StateType.COMPLETED].includes(this.avPlayer.state)&&(console.info("current state is "+this.avPlayer.state+" can set volume"),this.avPlayer.setVolume(e)))}get autoplay(){return this.autoplayS}set autoplay(e){"boolean"!=typeof e?console.error(`[AdvancedAPI] autoplay: ${e} is invalid`):this.autoplayS=e}get startTime(){return this.startTimeS/1e3}set startTime(e){"number"!=typeof e?console.error(`[AdvancedAPI] startTIme: ${e} is invalid`):this.startTimeS=1e3*e}get src(){return this.avPlayer?this.avPlayer.url:(console.error("[AdvancedAPI] avPlayer is not exist, get src fail"),"")}set src(e){if("string"!=typeof e)console.error(`[AdvancedAPI] src: ${e} is invalid`);else if(this.avPlayer)if(e&&(e.startsWith("http:")||e.startsWith("https:")||e.startsWith("datashare:")||e.startsWith("internal://")))if(this.avPlayer.state!==StateType.IDLE)console.error("current state is "+this.avPlayer.state+" can not set url");else{let t;if(e.startsWith("http:")||e.startsWith("https:"))t=e;else if(e.startsWith("internal://"))try{var o=switchInternalToHapSandBox(e),a=fs.openSync(o,fs.OpenMode.READ_ONLY).fd;t="fd://"+a}catch(o){console.info(""+JSON.stringify(o))}else if(e.startsWith("datashare:"))try{var r=MediaLibraryBase.getMedia(),s=MediaLibraryBase.getFileKey(),i=MediaLibraryBase.getMediaType("AUDIO"),n={selections:s.MEDIA_TYPE+"= ?",selectionArgs:[i.toString()],uri:e};return void r.getFileAssets(n).then(e=>{e.getFirstObject().then(e=>{MediaLibraryBase.getFd(e).then(e=>{t="fd://"+e,this.avPlayer.url&&t!==this.avPlayer.url&&this.avPlayer.reset(),this.avPlayer.url=t})})})}catch(o){return void console.error(`[AdvancedAPI] src: ${e} is invalid`)}this.avPlayer.url&&t!==this.avPlayer.url&&this.avPlayer.reset(),this.avPlayer.url=t,this.tempSrc=t}else console.error(`[AdvancedAPI] src: ${e} is invalid`);else console.error("[AdvancedAPI] avPlayer is not exist, set src fail")}get buffered(){return this.avPlayer?this.avPlayer.duration*this.bufferedS/1e5:(console.error("[AdvancedAPI] avPlayer is not exist, get buffered fail"),0)}get playbackRate(){return this.playbackRateS}set playbackRate(e){"number"!=typeof e?console.error(`[AdvancedAPI] speed: ${e} is invalid`):(e=e<=.75?media.PlaybackSpeed.SPEED_FORWARD_0_75_X:.75<e&&e<=1?media.PlaybackSpeed.SPEED_FORWARD_1_00_X:1<e&&e<=1.25?media.PlaybackSpeed.SPEED_FORWARD_1_25_X:1.25<e&&e<=1.75?media.PlaybackSpeed.SPEED_FORWARD_1_75_X:media.PlaybackSpeed.SPEED_FORWARD_2_00_X,this.playbackRateS=e,this.avPlayer&&[StateType.PREPARED,StateType.PLAYING,StateType.PAUSED,StateType.COMPLETED].includes(this.avPlayer.state)&&(console.info("current state is "+this.avPlayer.state+" can not set playbackRate"),this.avPlayer.setSpeed(e)))}play(){this.avPlayer?[StateType.PREPARED,StateType.PAUSED,StateType.COMPLETED].includes(this.avPlayer.state)?(this.tempSrc&&""===this.avPlayer.url&&(this.avPlayer.url=this.tempSrc),this.avPlayer.play(),this.onPlayCallback&&this.onPlayCallback({})):console.error("current state is "+this.avPlayer.state+" can not play"):console.error("[AdvancedAPI] avPlayer is not exist, play fail")}pause(){var e;this.avPlayer?(e=this.avPlayer.state,StateType.PLAYING!==e?console.error("current state is "+this.avPlayer.state+"can not pause"):(this.avPlayer.pause(),this.onPauseCallback&&this.onPauseCallback({}))):console.error("[AdvancedAPI] avPlayer is not exist, pause fail")}stop(){this.avPlayer?[StateType.PREPARED,StateType.PLAYING,StateType.PAUSED,StateType.COMPLETED].includes(this.avPlayer.state)?(this.avPlayer.stop(),this.onStopCallback&&this.onStopCallback({})):console.error("current state is "+this.avPlayer.state+" can not stop"):console.error("[AdvancedAPI] avPlayer is not exist, stop fail")}seek(e){this.avPlayer?[StateType.PREPARED,StateType.PLAYING,StateType.PAUSED,StateType.COMPLETED].includes(this.avPlayer.state)?(this.onSeekingCallback&&this.onSeekingCallback({}),this.avPlayer.seek(1e3*e)):console.error("current state is "+this.avPlayer.state+" can not seek"):console.error("[AdvancedAPI] avPlayer is not exist, seek fail")}destroy(){this.avPlayer?this.avPlayer.release():console.error("[AdvancedAPI] avPlayer is not exist")}onCanplay(e){this.onCanplayCallback=e}offCanplay(){this.onCanplayCallback=null}onPlay(e){this.onPlayCallback=e}offPlay(){this.onPlayCallback=null}onPause(e){this.onPauseCallback=e}offPause(){this.onPauseCallback=null}onStop(e){this.onStopCallback=e}offStop(){this.onStopCallback=null}onEnded(e){this.onEndedCallback=e}offEnded(){this.onEndedCallback=null}onTimeUpdate(e){this.onTimeUpdateCallback=e}offTimeUpdate(){this.onTimeUpdateCallback=null}onError(e){this.onErrorCallback=e}offError(){this.onErrorCallback=null}onPrev(e){console.info("ios only")}onNext(e){console.info("ios only")}onWaiting(e){this.onWaitingCallback=e}offWaiting(){this.onWaitingCallback=null}onSeeking(e){this.onSeekingCallback=e}offSeeking(){this.onSeekingCallback=null}onSeeked(e){this.onSeekedCallback=e}offSeeked(){this.onSeekedCallback=null}}const ORI={0:"left",90:"up",180:"right",270:"down"};class ASViedo{chooseVideo(a){return AppStorage.SetOrCreate("tempFilePaths",""),a=a||{},new Promise(async(e,t)=>{if(!await MediaLibraryBase.getPermissions())return t(["permission fail",ErrorCode$1.USER_REJECT]);let c=[];if(a.sourceType&&1===a.sourceType.length&&a.sourceType.includes("camera")){var o=await bundleManager.getBundleInfoForSelf(bundleManager.BundleFlag.GET_BUNDLE_INFO_DEFAULT);if(0!==(o=await context.startAbilityForResult({action:WantConstantBase.getAction("ACTION_VIDEO_CAPTURE"),parameters:{uri:"video",callBundleName:o.name}})).resultCode)return t(["Failed to pull up camera app",ErrorCode$1.SERVICE_UNAVIALABLE]);if(c=[o.want.parameters.resourceUri],!o.want.parameters.resourceUri)return}else(o=new picker.PhotoSelectOptions).MIMEType=picker.PhotoViewMIMETypes.VIDEO_TYPE,o.maxSelectNumber=1,o=await(new picker.PhotoViewPicker).select(o),c=o.photoUris;if(!c)return t(["get uri fail",ErrorCode$1.SERVICE_UNAVIALABLE]);if("cancel"!==c){let t,o,a,r,s,i,n;for(let e=0;e<c.length;e++){var l=await getFileAssetFromUri(c[e]);t=c[e],o={path:c[e],size:l.size,name:l.displayName,type:l.displayName.split(".").pop()},a=l.duration/1e3,r=l.size,s=l.height,i=l.width,n=l.displayName}return e({tempFilePath:t,tempFile:o,duration:a,size:r,height:s,width:i,name:n})}})}chooseMedia(c){return c=c||{},new Promise(async(e,t)=>{if(!await MediaLibraryBase.getPermissions())return t(["permission fail",ErrorCode$1.USER_REJECT]);(!c.count||c.count<1)&&(c.count=9);var o=new picker.PhotoSelectOptions;if(o.MIMEType=picker.PhotoViewMIMETypes.IMAGE_VIDEO_TYPE,c.mediaType&&Array.isArray(c.mediaType)&&c.mediaType.some(e=>"image"!==e&&"video"!==e&&"mix"!==e))return t(["chooseMedia:fail parameter `mediaType`. Expected mediaType is array image|video|mix.",ErrorCode$1.PARAMETER_ERROR]);if(c.mediaType&&c.mediaType.includes("image")&&(o.MIMEType=picker.PhotoViewMIMETypes.IMAGE_TYPE),c.mediaType&&c.mediaType.includes("video")&&(o.MIMEType=picker.PhotoViewMIMETypes.VIDEO_TYPE),c.mediaType&&(c.mediaType.includes("video")&&c.mediaType.includes("image")||c.mediaType.includes("mix"))&&(o.MIMEType=picker.PhotoViewMIMETypes.IMAGE_VIDEO_TYPE),c.count&&"number"!=typeof c.count)return t(['chooseMedia:fail parameter `count`. Expected Number with value NaN, got String with value "'+c.count+'".',ErrorCode$1.PARAMETER_ERROR]);o.maxSelectNumber=c.count;var a=(await(new picker.PhotoViewPicker).select(o)).photoUris;if(!a.length)return t(["get uri fail",ErrorCode$1.SERVICE_UNAVIALABLE]);if("cancel"!==a){var r=[],s=[];for(let e=0;e<a.length;e++){var i=await getFileAssetFromUri(a[e]),n=(r.push(a[e]),{path:a[e],size:i.size,name:i.displayName,width:i.width,height:i.height,type:i.displayName.split(".").pop()});i.duration&&(n.duration=i.duration/1e3),s.push(n)}e({tempFilePaths:r,tempFiles:s})}})}getVideoInfo(P){return new Promise(async(e,t)=>{var o,a;if(!await MediaLibraryBase.getPermissions())return t(["permission fail",ErrorCode$1.USER_REJECT]);try{if(isFileUri(r=P.src))return o=await getFileAssetFromUri(r),a=ORI[o.orientation],e({width:o.width,height:o.height,path:r,orientation:a,type:o.displayName.split(".").pop(),duration:o.duration/1e3,size:Math.round(o.size/1024),bitrate:Math.round(8*o.size*1e3/(1024*o.duration))});if(isSandboxPath(r)){var r,s=(r=switchInternalToHapSandBox(r)).split(".").pop(),i={src:r,mimeType:"video/*",relativePath:"Videos/"},n=MediaLibraryBase.getMedia(),c=await n.storeMediaAsset(i),l=MediaLibraryBase.getFileKey(),d=MediaLibraryBase.getMediaType("VIDEO"),u={selections:l.MEDIA_TYPE+"= ?",selectionArgs:[d.toString()],uri:c},h=(await new Promise(e=>setTimeout(e,500)),await n.getFileAssets(u)),p=await h.getFirstObject(),g=p.width,f=p.height,A=ORI[p.orientation],m=p.duration/1e3,y=Math.round(p.size/1024),S=Math.round(8*p.size*1e3/(1024*p.duration)),v={width:g,height:f,path:P.src,orientation:A,type:s,duration:m,size:y,bitrate:S};try{await p.trash(!0),await n.deleteAsset(p.uri)}catch(e){console.debug("[AdvancedAPI] delete tempFile fail: %s",e.message)}return h.close(),e(v)}return t(["get uri fail",ErrorCode$1.SERVICE_UNAVIALABLE])}catch(e){console.debug("[AdvancedAPI] getVideoInfo err %s",JSON.stringify(e)),t([e.message,e.code])}})}saveVideoToPhotosAlbum(n){return new Promise(async(e,t)=>{var o,a,r,s,i=n.filePath;return await MediaLibraryBase.getPermissions()?"string"!=typeof i?t(["filePath format is not supported.",ErrorCode$1.PARAMETER_ERROR]):isFileUri(i)?(r=getFdFromUriOrSandBoxPath(a=i),o=fs.statSync(r).size,o=new ArrayBuffer(o),FileioBase.ohosReadSync(r,o),r=await getFileAssetFromUri(a),a=MediaLibraryBase.getMedia(),s=await MediaLibraryBase.getPublicDirectory(a,"DIR_VIDEO"),r="VIDEO_"+(new Date).getTime()+"_"+r.displayName,a=await MediaLibraryBase.createAsset(a,"VIDEO",r,s),(r=await MediaLibraryBase.getFd(a))?(FileioBase.ohosWriteSync(r,o),await MediaLibraryBase.closeAsset(a,r),void e({path:a.uri})):void t(["saveVideoToPhotosAlbum fail, src not exist.",ErrorCode$1.PARAMETER_ERROR])):isSandboxPath(i)?fs.accessSync(s=i)&&(o=fs.openSync(s,fs.OpenMode.READ_ONLY))&&(r=o.fd,a=fs.statSync(s).size,o=new ArrayBuffer(a),FileioBase.ohosReadSync(r,o),s=MediaLibraryBase.getMedia(),a=await MediaLibraryBase.getPublicDirectory(s,"DIR_VIDEO"),r="VIDEO_"+(new Date).getTime()+"_"+i.split("/").splice(-1,1).toString(),i=await MediaLibraryBase.createAsset(s,"VIDEO",r,a),s=await MediaLibraryBase.getFd(i))?(FileioBase.ohosWriteSync(s,o),await MediaLibraryBase.closeAsset(i,s),void e({path:i.uri})):void t(["saveVideoToPhotosAlbum fail, src not exist.",ErrorCode$1.PARAMETER_ERROR]):void t(["filePath format is not supported.",ErrorCode$1.PARAMETER_ERROR]):t(["permission fail",ErrorCode$1.USER_REJECT])})}}class ASCamera{createCameraContext(){return new CameraContext}}class CameraContext{constructor(){this.videoPath=null}async takePhoto(e={}){var t=e.success||function(){},o=e.fail||function(){},e=e.complete||function(){};if(!await MediaLibraryBase.getPermissions())return e(),o({errMsg:"permission fail"});var a=await bundleManager.getBundleInfoForSelf(bundleManager.BundleFlag.GET_BUNDLE_INFO_DEFAULT);if(0===(a=await context.startAbilityForResult({action:WantConstantBase.getAction("ACTION_IMAGE_CAPTURE"),parameters:{uri:"capture",callBundleName:a.name}})).resultCode){var r=a.want.parameters.resourceUri;if(!a.want.parameters.resourceUri)return o({errMsg:"takePhoto fail"}),void e();var a=MediaLibraryBase.getMedia(),s=MediaLibraryBase.getFileKey(),i=MediaLibraryBase.getMediaType("IMAGE"),s={selections:s.MEDIA_TYPE+"= ?",selectionArgs:[i.toString()],uri:r},r=await(i=await(await a.getFileAssets(s)).getFirstObject()).open("r"),s=(new Date).getTime(),n=context.cacheDir+"/"+s+"/"+i.displayName;try{await fs.mkdir(context.cacheDir+"/"+s),fs.openSync(n,fs.OpenMode.CREATE);var c=fs.openSync(n,fs.OpenMode.READ_WRITE),l=new ArrayBuffer(i.size);FileioBase.ohosReadSync(r,l),FileioBase.ohosWriteSync(c.fd,l),fs.closeSync(c),await i.close(r),t({tempImagePath:n})}catch(e){console.info(""+JSON.stringify(e))}finally{if(i)try{await i.trash(!0),await a.deleteAsset(i.uri)}catch(e){console.debug("[AdvancedAPI] delete tempFile fail: %s",e.message)}}}else o({errMsg:"takePhoto fail"});e()}setZoom(){}async startRecord(e={}){var t=e.success||function(){},o=e.fail||function(){},e=e.complete||function(){};if(!await MediaLibraryBase.getPermissions())return e(),o({errMsg:"permission fail"});try{var a=await bundleManager.getBundleInfoForSelf(bundleManager.BundleFlag.GET_BUNDLE_INFO_DEFAULT),r=await context.startAbilityForResult({action:WantConstantBase.getAction("ACTION_VIDEO_CAPTURE"),parameters:{uri:"video",callBundleName:a.name}});if(0===r.resultCode){var s=r.want.parameters.resourceUri;if(!r.want.parameters.resourceUri)return void e();var i=MediaLibraryBase.getMedia(),n=MediaLibraryBase.getFileKey(),c=MediaLibraryBase.getMediaType("VIDEO"),l={selections:n.MEDIA_TYPE+"= ?",selectionArgs:[c.toString()],uri:s},d=await(await i.getFileAssets(l)).getFirstObject(),u=await d.open("r"),h=(new Date).getTime(),p=context.cacheDir+"/"+h+"/"+d.displayName;this.videoPath=p;try{await fs.mkdir(context.cacheDir+"/"+h),fs.openSync(p,fs.OpenMode.CREATE);var g=fs.openSync(p,fs.OpenMode.READ_WRITE),f=new ArrayBuffer(d.size);FileioBase.ohosReadSync(u,f),FileioBase.ohosWriteSync(g.fd,f),fs.closeSync(g),await d.close(u),t()}catch(e){console.info(""+JSON.stringify(e))}finally{if(d)try{await d.trash(!0),await i.deleteAsset(d.uri)}catch(e){console.debug("[AdvancedAPI] delete tempFile fail: %s",e.message)}}}}catch(e){o({errMsg:"startRecord fail"})}e()}stopRecord(e={}){var t=e.success||function(){},o=e.fail||function(){},e=e.complete||function(){},a=this.videoPath;this.videoPath?t({tempVideoPath:a}):o({errMsg:"stopRecord fail"}),e()}onCameraFrame(){}}const StateType$1={IDLE:"idle",PLAYING:"playing",PAUSED:"paused",STOPPED:"stopped",ERROR:"error"};function createAVSession(t){console.debug("[AdvancedAPI] createAVSession begin"),avSession.createAVSession(context,"player","audio").then(e=>{console.debug("[AdvancedAPI] createAVSession succeed"),t.avSession=e})}function destroyAVSession(e){console.debug("[AdvancedAPI] destroyAVSession begin"),null===e.avSession?console.debug("[AdvancedAPI] avSession is null"):e.avSession.destroy()}function startBackgroundTask(){AbilityBase.getAbilityInfo().then(e=>{e={wants:[{bundleName:e.bundleName,abilityName:e.name}],operationType:wantAgent.OperationType.START_ABILITY,requestCode:0,wantAgentFlags:[wantAgent.WantAgentFlags.UPDATE_PRESENT_FLAG]},wantAgent.getWantAgent(e).then(e=>backgroundTaskManager.startBackgroundRunning(context,backgroundTaskManager.BackgroundMode.AUDIO_PLAYBACK,e)).then(()=>{console.debug("[AdvancedAPI]  start bg operation succeeded")}).catch(e=>{console.error("[AdvancedAPI]  start bg operation failed Cause: "+e)})})}function stopBackgroundTask(){backgroundTaskManager.stopBackgroundRunning(context).then(()=>{console.debug("[AdvancedAPI]  stop operation succeeded")}).catch(e=>{console.error("[AdvancedAPI]  stop operation fail cause: "+JSON.stringify(e))})}class ASBGAudio{constructor(){this.backgroundAudioManager=new BackgroundAudioManager}getBackgroundAudioManager(){return this.backgroundAudioManager.audioPlayer||(this.backgroundAudioManager=new BackgroundAudioManager),this.backgroundAudioManager}}class BackgroundAudioManager{constructor(){this.bufferedS=0,this.avSession=null,this.startTimeS=0,this.onWaitingCallback=null,this.titleS=null,this.epnameS=null,this.singerS=null,this.coverImgUrlS=null,this.webUrlS=null,this.protocolS="http",this.onFinishCallback=null,this.tempSrc="",this.onCanplayCallback=null,this.onPlayCallback=null,this.onPauseCallback=null,this.onStopCallback=null,this.onTimeUpdateCallback=null,this.onErrorCallback=null,this.init()}init(){this.audioPlayer=media.createAudioPlayer(),this.audioPlayer.on("finish",()=>{destroyAVSession(this),stopBackgroundTask(),this.onFinishCallback&&this.onFinishCallback({})}),this.audioPlayer.on("dataLoad",()=>{this.onCanplayCallback&&this.onCanplayCallback({})}),this.audioPlayer.on("bufferingUpdate",(e,t)=>{console.info(`[AdvancedAPI] bgAudio bufferingUpdate ${e} `+t),3===e&&0!==t&&(this.bufferedS=t,this.audioPlayer.currentTime/1e3>=this.audioPlayer.duration*t/1e5)&&this.onWaitingCallback&&this.onWaitingCallback({})}),this.audioPlayer.on("audioInterrupt",e=>{console.info("[AdvancedAPI]  audioInterrupt:"+JSON.stringify(e)),e.hintType===audio.InterruptHint.INTERRUPT_HINT_PAUSE&&this.audioPlayer.pause(),e.hintType===audio.InterruptHint.INTERRUPT_HINT_RESUME&&this.audioPlayer.play()}),this.audioPlayer.on("play",()=>{this.onPlayCallback&&this.onPlayCallback({})}),this.audioPlayer.on("pause",()=>{this.onPauseCallback&&this.onPauseCallback({})}),this.audioPlayer.on("timeUpdate",e=>{this.onTimeUpdateCallback&&this.onTimeUpdateCallback(e/1e3)}),this.audioPlayer.on("error",e=>{this.onErrorCallback&&this.onErrorCallback(e)})}get duration(){return this.audioPlayer.duration/1e3}get currentTime(){return this.audioPlayer.currentTime/1e3}get paused(){return this.audioPlayer.state===StateType$1.PAUSED}get src(){return this.audioPlayer.src}set src(t){if("string"!=typeof t)console.error(`[AdvancedAPI] src: ${t} is invalid`);else if(t&&(t.startsWith("http:")||t.startsWith("https:")||isFileUri(t)||isSandboxPath(t))){let e;if(t.startsWith("http:")||t.startsWith("https:"))e=t;else if(isFileUri(t)||isSandboxPath(t))try{var o=getFdFromUriOrSandBoxPath(t);e="fd://"+o}catch(e){console.info(""+JSON.stringify(e))}this.audioPlayer.src&&e!==this.audioPlayer.src&&this.audioPlayer.reset(),this.audioPlayer.src=e,this.tempSrc=t,this.audioPlayer.play(),this.startTimeS&&this.audioPlayer.seek(this.startTimeS),startBackgroundTask(),createAVSession(this)}else console.error(`[AdvancedAPI] src: ${t} is invalid`)}get startTime(){return this.startTimeS/1e3}set startTime(e){this.startTimeS=1e3*e}get buffered(){return this.audioPlayer.duration*this.bufferedS/1e5}get title(){return this.titleS}set title(e){this.titleS=e}get epname(){return this.epnameS}set epname(e){this.epnameS=e}get singer(){return this.singerS}set singer(e){this.singerS=e}get coverImgUrl(){return this.coverImgUrlS}set coverImgUrl(e){this.coverImgUrlS=e}get webUrl(){return this.webUrlS}set webUrl(e){this.webUrlS=e}get protocol(){return this.protocolS}set protocol(e){this.protocolS=e}play(){var e=this.audioPlayer.state;[StateType$1.PAUSED,StateType$1.STOPPED,StateType$1.IDLE].includes(e)&&(this.tempSrc&&""===this.audioPlayer.src&&(this.src=this.tempSrc),this.audioPlayer.play(),startBackgroundTask(),createAVSession(this))}pause(){var e=this.audioPlayer.state;StateType$1.PLAYING===e&&this.audioPlayer.pause()}stop(){var e=this.audioPlayer.state;[StateType$1.PAUSED,StateType$1.PLAYING].includes(e)&&(this.audioPlayer.stop(),this.onStopCallback&&this.onStopCallback({}),this.audioPlayer.release(),this.init(),destroyAVSession(this),stopBackgroundTask())}seek(e){var t=this.audioPlayer.state;[StateType$1.PAUSED,StateType$1.PLAYING].includes(t)&&this.audioPlayer.seek(1e3*e)}onCanplay(e){this.onCanplayCallback=e}onPlay(e){this.onPlayCallback=e}onPause(e){this.onPauseCallback=e}onStop(e){this.onStopCallback=e}onEnded(e){this.onFinishCallback=e}onTimeUpdate(e){this.onTimeUpdateCallback=e}onError(e){this.onErrorCallback=e}onPrev(e){console.info("ios only")}onNext(e){console.info("ios only")}onWaiting(e){this.onWaitingCallback=e}}class SecurityBase{static rsa(a,r){return new Promise(async(e,t)=>{var o;try{await(o=cryptoFramework.createMd(a)).update(r),e((await o.digest()).data)}catch(e){console.error("[QAFAPI]: rsa fail error code: "+e.code+", message is: "+e.message),t(e)}})}}class FileCallback{constructor({success:e,fail:t,complete:o}){checkDataType(e,!1,"function")&&(this.successFn=e),checkDataType(t,!1,"function")&&(this.failFn=t),checkDataType(o,!1,"function")&&(this.completeFn=o)}success(...e){if(this.successFn)try{this.successFn(...e)}catch(e){console.error(e)}if(this.completeFn)try{this.completeFn(...e)}catch(e){console.error(e)}}fail(...e){if(this.failFn)try{this.failFn(...e)}catch(e){console.error(e)}if(this.completeFn)try{this.completeFn(...e)}catch(e){console.error(e)}}}const openMode=fs.OpenMode,ERROR={PARAMETER_ERROR:1001},modeReflect={ax:"a","ax+":"a+",wx:"w","wx+":"w+"},ENCODING=["utf8","utf-8","ascii","base64","binary","hex","ucs2","ucs-2","utf16le","utf-16le","latin1"];function getOpenMode(e){let t;switch(e){case"a":t=openMode.CREATE|openMode.APPEND;break;case"a+":t=openMode.CREATE|openMode.READ_WRITE|openMode.APPEND;break;case"as":t=openMode.SYNC|openMode.CREATE|openMode.APPEND;break;case"as+":t=openMode.SYNC|openMode.CREATE|openMode.READ_WRITE|openMode.APPEND;break;case"r":t=openMode.READ_ONLY;break;case"r+":t=openMode.READ_WRITE;break;case"w":t=openMode.CREATE|openMode.WRITE_ONLY|openMode.TRUNC;break;case"w+":t=openMode.CREATE|openMode.READ_WRIT|openMode.TRUNC}return t}function getFileTypeMode(e){return e.isBlockDevice()?24576:e.isCharacterDevice()?8192:e.isDirectory()?16384:e.isFIFO()?4096:e.isFile()?32768:e.isSocket()?49152:e.isSymbolicLink()?40960:void 0}function mkdirRecursive(e,t){var o=t.shift();e=e||o?e+"/"+o:"",o&&!fs.accessSync(e)&&fs.mkdirSync(e),0<t.length&&mkdirRecursive(e,t)}function obtainUpperPath(e){var t=e.lastIndexOf("/");return{index:t,upperPath:e.substring(0,t)}}function obtainFileName(e){var t=e.lastIndexOf("/"),o=e.substring(t);return{index:t,fileName:e.endsWith("/")?e.substring(e.lastIndexOf("/",e.length-2)+1,e.length-1):o}}function checkFd(e,t){let o={};var a;return checkDataType(t,!0,"string")?(a=Number(t),""===t||isNaN(a)?{checkMsg:o={errMsg:e+": fail, invalid fd"},isValid:!1}:{isValid:!0,fd:a}):{checkMsg:o={errno:ERROR.PARAMETER_ERROR,errMsg:e+": fail, invalid fd"},isValid:!1}}function checkFdSync(e,t){var o;return!checkDataType(t,!0,"string")||(o=Number(t),""===t)||isNaN(o)?{errMsg:e+": fail invalid fd",isValid:!1}:{isValid:!0,fd:o}}function checkEncoding(e,t){return t?checkDataType(t,!1,"string")?ENCODING.includes(t)?{isValid:!0}:{checkMsg:e+":fail Unknown encoding: "+t,isValid:!1}:{checkMsg:e+":fail invalid encoding: "+t,isValid:!1}:{isValid:!0}}function checkPath(e,t,o){let a={};return checkDataType(o,!0,"string")?""===o?{checkMsg:a={errMsg:e+": fail permission denied, open:''"},isValid:!1}:{isValid:!0}:{checkMsg:a={errno:ERROR.PARAMETER_ERROR,errMsg:e+`: fail, ${t} should be String instead of: `+typeof o},isValid:!1}}function checkPathExistence(e,t,o){let a={};return checkDataType(o,!0,"string")?""===o?{checkMsg:a={errMsg:e+": fail permission denied, open:''"},isValid:!1}:fs.accessSync(o)?{isValid:!0}:{checkMsg:a={errMsg:e+": fail no such file or directory, open: "+o},isValid:!1}:{checkMsg:a={errno:ERROR.PARAMETER_ERROR,errMsg:e+`: fail, ${t} should be String instead of: `+typeof o},isValid:!1}}function checkPathSync(e,t,o){return""!==o&&checkDataType(o,!0,"string")?{isValid:!0}:{errMsg:e+`: failed, ${t} should be a non-empty string`,isValid:!1}}function checkPathExistenceSync(e,t,o){return""!==o&&checkDataType(o,!0,"string")?fs.accessSync(o)?{isValid:!0}:{errMsg:e+": fail no such file or directory: "+o,isValid:!1}:{errMsg:e+`: failed, ${t} should be a non-empty string`,isValid:!1}}const ERROR$1={PARAMETER_ERROR:1001},DEFAULT_ENCODING="utf-8",DEFAULT_POSITION=0,DEFAULT_LENGTH=0,DEFAULT_FLAG="r",DEFAULT_OFFSET=0,FLAG=["a","ax","a+","ax+","as","as+","r","r+","w","wx","w+","wx+"];class FileSystemManager{constructor(){this.pathDir=context.filesDir}access({path:e,success:t,fail:o,complete:a}){const r=new FileCallback({success:t,fail:o,complete:a});checkDataType(e,!0,"string")?fs.access(e).then(e=>{e?(console.debug("[AdvancedAPI] file access exist"),r.success({errMsg:"access:ok"})):r.fail({errMsg:"access:fail no such file or directory"})},e=>{console.debug("[AdvancedAPI] access failed with error message: %s, code = %d",e.message,e.code)}):r.fail({errMsg:"access:fail parameter error: parameter.path should be String",errno:ERROR$1.PARAMETER_ERROR})}accessSync(e){if(!checkDataType(e,!0,"string"))throw new Error("accessSync:fail path must be a string");if(!fs.accessSync(e))throw new Error("accessSync:fail no such file or directory")}appendFile({filePath:e,data:t,encoding:o=DEFAULT_ENCODING,success:a,fail:r,complete:s}){const i=new FileCallback({success:a,fail:r,complete:s});if(checkDataType(e,!0,"string"))if(checkDataType(t,!0,["string","arraybuffer"]))if(fs.accessSync(e)){const n=fs.openSync(e,fs.OpenMode.READ_WRITE|fs.OpenMode.APPEND);fs.write(n.fd,t).then(e=>{i.success({errMsg:"appendFile:ok"}),fs.closeSync(n)}).catch(e=>{console.error("[AdvancedAPI] appendFile failed with error message: "+e.message+", error code: "+e.code),i.fail({errMsg:"appendFile:fail "+e.message})})}else i.fail({errMsg:`appendFile:fail no such file or directory, open "${e}"`});else i.fail({errMsg:"access:fail parameter error: parameter.data should be String/ArrayBuffer",errno:ERROR$1.PARAMETER_ERROR});else i.fail({errMsg:"access:fail parameter error: parameter.filePath should be String",errno:ERROR$1.PARAMETER_ERROR})}appendFileSync(e,t,o=DEFAULT_ENCODING){if(!checkDataType(e,!0,"string"))throw new Error("access:fail parameter error: parameter.filePath should be String");if(!checkDataType(t,!0,["string","arraybuffer"]))throw new Error("access:fail parameter error: parameter.data should be String/ArrayBuffer");if(!fs.accessSync(e))throw new Error(`appendFile:fail no such file or directory, open "${e}"`);e=fs.openSync(e,fs.OpenMode.READ_WRITE|fs.OpenMode.APPEND),fs.writeSync(e.fd,t)}open({filePath:e,flag:t=DEFAULT_FLAG,success:o,fail:a,complete:r}){const s=new FileCallback({success:o,fail:a,complete:r});if(checkDataType(e,!0,"string")){if(FLAG.includes(t)||(t=DEFAULT_FLAG),Object.keys(modeReflect).includes(t)){if(fs.accessSync(e))return void s.fail({errMsg:"open:fail EXIST: file already exists"});console.debug("[AdvancedAPI] access fail"),t=modeReflect[t]}fs.open(e,getOpenMode(t),(e,t)=>{e?(console.error("[AdvancedAPI] open failed with error message: "+e.message+", error code: "+e.code),s.fail({errMsg:"open:fail "+e.message,errno:ERROR$1.NO_SUCH_FILE_OR_DIRECTORY})):s.success({fd:t.fd.toString(),errMsg:"open:ok"})})}else s.fail({errMsg:"open:fail parameter error: parameter.filePath should be String",errno:ERROR$1.PARAMETER_ERROR})}openSync({filePath:e,flag:t}){if(!checkDataType(e,!0,"string"))throw new Error("openSync:fail parameter error: parameter.filePath should be String");if(FLAG.includes(t)||(t=DEFAULT_FLAG),Object.keys(modeReflect).includes(t)){if(fs.accessSync(e))throw new Error("openSync:fail EXIST: file already exists");console.debug("[AdvancedAPI] access fail"),t=modeReflect[t]}return fs.openSync(e,getOpenMode(t)).fd.toString()}close({fd:e,success:t,fail:o,complete:a}){const r=new FileCallback({success:t,fail:o,complete:a});""!==e&&checkDataType(e,!0,"string")?(e=Number(e),isNaN(e)?r.fail({errMsg:"close:fail bad file descriptor"}):fs.close(e,e=>{e?r.fail({errMsg:"close:fail bad file descriptor"}):r.success({errMsg:"close:ok"})})):r.fail({errMsg:"close:fail invalid fd",errno:ERROR$1.PARAMETER_ERROR})}closeSync({fd:e}){if(""===e||!checkDataType(e,!0,"string"))throw new Error("closeSync:fail invalid fd");if(e=Number(e),isNaN(e))throw new Error("closeSync:fail invalid fd");fs.closeSync(e)}copyFile({srcPath:e,destPath:t,success:o,fail:a,complete:r}){const s=new FileCallback({success:o,fail:a,complete:r});if((o=checkPathExistence("copyFile","srcPath",e)).isValid)if((a=checkPath("copyFile","destPath",t)).isValid)if(fs.statSync(e).isDirectory())s.fail({errMsg:"copyFile: fail illegal operation on a directory, open: "+e});else{if(fs.accessSync(t)){if((r=fs.statSync(t)).isDirectory())t+=obtainFileName(e).fileName;else if(r.isFile()&&e!==t)return void s.fail({errMsg:"copyFile: fail copyFile failed"})}else if(r=obtainUpperPath(t),!fs.accessSync(r.upperPath))return void s.fail({errMsg:"copyFile: fail no such file or directory, open: "+t});fs.copyFile(e,t).then(()=>{s.success({errMsg:"copyFile: ok"})}).catch(e=>{s.fail({errMsg:`copyFile: failed with error message: ${e.message}, error code: `+e.code})})}else s.fail(a.checkMsg);else s.fail(o.checkMsg)}copyFileSync(e,t){var o=checkPathExistenceSync("copyFileSync","srcPath",e);if(!o.isValid)throw new Error(o.errMsg);if(!(o=checkPathSync("copyFileSync","destPath",t)).isValid)throw new Error(o.errMsg);if(fs.statSync(e).isDirectory())throw new Error("copyFileSync: fail illegal operation on a directory: "+e);if(fs.accessSync(t)){if((o=fs.statSync(t)).isDirectory()){var a=t.lastIndexOf("/");let e=t.substring(a);t.endsWith("/")&&(e=t.substring(t.lastIndexOf("/",t.length-2)+1,t.length-1)),t+=e}else if(o.isFile()&&e!==t)throw new Error("copyFileSync: fail copyFile failed")}else if(a=obtainUpperPath(t),!fs.accessSync(a.upperPath))throw new Error("copyFileSync: fail no such file or directory: "+t);try{fs.copyFileSync(e,t)}catch(e){throw new Error("copyFileSync: "+e.message)}}fstat({fd:e,success:t,fail:o,complete:a}){const r=new FileCallback({success:t,fail:o,complete:a});(t=checkFd("fstat",e)).isValid?(e=t.fd,fs.stat(e,(e,t)=>{e?r.fail({errMsg:`fstat: failed with error message: ${e.message}, error code: `+e.code}):(e=getFileTypeMode(t)|t.mode,r.success({stat:{mode:e,size:t.size,lastAccessedTime:t.atime,lastModifiedTime:t.mtime,isDirectory:()=>t.isDirectory(),isFile:()=>t.isFile()},errMsg:"fstat: ok"}))})):r.fail(t.checkMsg)}fstatSync({fd:e}){var t=checkFdSync("fstatSync",e);if(!t.isValid)throw new Error(t.errMsg);e=t.fd;try{const o=fs.statSync(e);return{stat:{mode:getFileTypeMode(o)|o.mode,size:o.size,lastAccessedTime:o.atime,lastModifiedTime:o.mtime,isDirectory:()=>o.isDirectory(),isFile:()=>o.isFile()}}}catch(e){throw new Error("fstatSync: "+e.message)}}ftruncate({fd:e,length:t,success:o,fail:a,complete:r}){const s=new FileCallback({success:o,fail:a,complete:r});(o=checkFd("ftruncate",e)).isValid?(e=o.fd,(!checkDataType(t,!0,"number")||t<0)&&(t=DEFAULT_LENGTH),fs.truncate(e,t).then(()=>{s.success({errMsg:"ftruncate: ok"})}).catch(e=>{s.fail({errMsg:`ftruncate: failed with error message: ${e.message}, error code: `+e.code})})):s.fail(o.checkMsg)}ftruncateSync({fd:e,length:t}){var o=checkFdSync("ftruncateSync",e);if(!o.isValid)throw new Error(o.errMsg);e=o.fd,(!checkDataType(t,!0,"number")||t<0)&&(t=DEFAULT_LENGTH);try{fs.truncateSync(e,t)}catch(e){throw new Error("ftruncateSync: "+e.message)}}mkdir({dirPath:e,recursive:t,success:o,fail:a,complete:r}){const s=new FileCallback({success:o,fail:a,complete:r});checkDataType(t,!1,"boolean")||(t=Boolean(t)),(o=checkPath("mkdir","dirPath",e)).isValid?fs.accessSync(e)?s.fail({errMsg:"mkdir: dirPath already exists: "+e}):t?(mkdirRecursive("",e.split("/")),s.success({errMsg:"mkdir: ok"})):(a=obtainUpperPath(e),fs.accessSync(a.upperPath)?fs.mkdir(e).then(()=>{s.success({errMsg:"mkdir: ok"})}).catch(e=>{s.fail({errMsg:`mkdir: failed with error message: ${e.message}, error code: `+e.code})}):s.fail({errMsg:"mkdir: failed"})):s.fail(o.checkMsg)}mkdirSync(e,t){checkDataType(t,!1,"boolean")||(t=Boolean(t));var o=checkPathSync("mkdirSync","dirPath",e);if(!o.isValid)throw new Error(o.errMsg);if(fs.accessSync(e))throw new Error("mkdirSync: dirPath already exists: "+e);if(!t&&!fs.accessSync(obtainUpperPath(e).upperPath))throw new Error("mkdirSync: fail, recursive is false and upper path does not exist");if(t)try{mkdirRecursive("",e.split("/"))}catch(e){throw new Error("mkdirSync: "+e.message)}else try{fs.mkdirSync(e)}catch(e){throw new Error("mkdirSync: "+e.message)}}read({fd:e,arrayBuffer:o,offset:t=DEFAULT_OFFSET,length:a,position:r,success:s,fail:i,complete:n}){const c=new FileCallback({success:s,fail:i,complete:n});if(!checkDataType(e,!0,"string")||""===e||isNaN(Number(e)))c.fail({errMsg:"read: fail invalid fd"});else if(e=Number(e),checkDataType(o,!0,"arraybuffer"))if((!checkDataType(t,!1,"number")||t<0)&&(t=Number(t),isNaN(t)||t<0)&&(t=DEFAULT_OFFSET),(!checkDataType(a,!1,"number")||a<0)&&(a=Number(a),isNaN(a)||a<0)&&(a=DEFAULT_LENGTH),(s=o.byteLength-t)<a)c.fail({errMsg:`read: fail RangeError [ERR_OUT_OF_RANGE]: The value length is out of range. It must be <= ${s}. Received `+a});else{(!checkDataType(r,!1,"number")||r<0)&&(r=DEFAULT_POSITION);const l=t,d=o.slice(l);fs.read(e,d,{offset:r,length:a}).then(e=>{var t=new Uint8Array(d);new Uint8Array(o).set(t,l),console.debug("[AdvancedAPI] the content of arrayBuffer: %s",String.fromCharCode.apply(null,new Uint8Array(d.slice(0,e)))),c.success({bytesRead:e,arrayBuffer:o,errMsg:"read: ok"})}).catch(e=>{c.fail({errMsg:`read: failed with error message: ${e.message},error code: `+e.code})})}else c.fail({errMsg:"read: fail invalid arrayBuffer: "+o})}readSync({fd:e,arrayBuffer:t,offset:o,length:a,position:r}){if(!checkDataType(e,!0,"string")||""===e||isNaN(Number(e)))throw new Error("readSync:fail invalid fd");if(e=Number(e),!checkDataType(t,!0,"arraybuffer"))throw new Error("readSync: fail invalid arrayBuffer");(!checkDataType(o,!1,"number")||o<0)&&(o=Number(o),isNaN(o)||o<0)&&(o=DEFAULT_OFFSET),(!checkDataType(a,!1,"number")||a<0)&&(a=Number(a),isNaN(a)||a<0)&&(a=DEFAULT_LENGTH);var s=t.byteLength-o;if(s<a)throw new Error(`readSync: fail RangeError [ERR_OUT_OF_RANGE]: The value length is out of range. It must be <= ${s}. Received `+a);(!checkDataType(r,!1,"number")||r<0)&&(r=DEFAULT_POSITION);try{var i=o,n=t.slice(i),c=fs.readSync(e,n,{offset:r,length:a}),l=new Uint8Array(n);return new Uint8Array(t).set(l,i),console.debug("[AdvancedAPI] the content of arrayBuffer: %s",String.fromCharCode.apply(null,new Uint8Array(t.slice(0,c)))),{bytesRead:c,arrayBuffer:t}}catch(e){throw new Error("readSync: "+e.message)}}readdir({dirPath:e,success:t,fail:o,complete:a}){const r=new FileCallback({success:t,fail:o,complete:a});(t=checkPathExistence("readdir","dirPath",e)).isValid?fs.statSync(e).isFile()?r.fail({errMsg:"readdir: fail, dirPath not a directory: "+e}):fs.listFile(e).then(e=>{r.success({files:e,errMsg:"readdir: ok"})}).catch(e=>{r.fail({errMsg:`readdir: failed with error message: ${e.message}, error code: `+e.code})}):r.fail(t.checkMsg)}readdirSync(e){var t=checkPathExistence("readdirSync","dirPath",e);if(!t.isValid)throw new Error(t.errMsg);if(fs.statSync(e).isFile())throw new Error("readdirSync: fail not a directory: ${dirPath}");try{return{files:fs.listFileSync(e)}}catch(e){throw new Error("readdirSync: "+e.message)}}readFile({filePath:e,encoding:t,position:o=DEFAULT_POSITION,length:a,success:r,fail:s,complete:i}){e=isSandboxPath(e)?switchInternalToHapSandBox(e):e;const n=new FileCallback({success:r,fail:s,complete:i});if((r=checkPathExistence("readFile","filePath",e)).isValid)if((s=fs.statSync(e)).isDirectory())n.fail({errMsg:"readFile:fail not absolute path: "+e});else if((i=checkEncoding("readFile",t)).isValid)if(s=s.size,a=null==a?s:a,checkDataType(o,!1,"number"))if(checkDataType(a,!1,"number"))if(o<0||s<o)n.fail({errMsg:'readFile:fail the value of "position" is out of range'});else if(a<0||s<a+o)n.fail({errMsg:'readFile:fail the value of "length" is out of range'});else{const c=fs.openSync(e,fs.OpenMode.READ_ONLY),l=new ArrayBuffer(a);fs.read(c.fd,l,{position:o,length:a}).then(()=>{var e=t?buffer.from(l).toString(t):l;n.success({data:e,errMsg:"readFile:ok"})}).catch(e=>{n.fail({errMsg:`readFile:fail error message: ${e.message}, error code: `+e.code})}).finally(()=>{fs.closeSync(c)})}else n.fail({errMsg:"readFile:fail invalid length: "+a});else n.fail({errMsg:"readFile:fail invalid position: "+o});else n.fail({errMsg:i.checkMsg});else n.fail(r.checkMsg)}readFileSync(e,t,o=DEFAULT_POSITION,a){var r=checkPathExistenceSync("readFileSync","filePath",e=isSandboxPath(e)?switchInternalToHapSandBox(e):e);if(!r.isValid)throw new Error(r.errMsg);if((r=fs.statSync(e)).isDirectory())throw new Error("readFileSync:fail illegal operation on a directory, open: "+e);var s=checkEncoding("readFile",t);if(!s.isValid)throw new Error(s.checkMsg);if(s=r.size,a=null==a?s:a,!checkDataType(o,!1,"number"))throw new Error("readFileSync:fail invalid position: "+o);if(!checkDataType(a,!1,"number"))throw new Error("readFileSync:fail invalid length: "+a);if(o<0||s<o)throw new Error('readFileSync:fail the value of "position" is out of range');if(a<0||s<a+o)throw new Error('readFileSync:fail the value of "length" is out of range');try{var i=fs.openSync(e,fs.OpenMode.READ_ONLY),n=new ArrayBuffer(a);return fs.readSync(i.fd,n,{position:o,length:a}),fs.closeSync(i),t?buffer.from(n).toString(t):n}catch(e){throw new Error("readFileSync:fail "+e.message)}}rename({oldPath:e,newPath:t,success:o,fail:a,complete:r}){const s=new FileCallback({success:o,fail:a,complete:r});if((o=checkPathExistence("rename","oldPath",e)).isValid)if((a=checkPath("rename","newPath",t)).isValid){if(!(r=fs.accessSync(t))){var i=obtainUpperPath(t);if(!fs.accessSync(i.upperPath))return void s.fail({errMsg:"rename: fail no such file or directory: "+t})}r&&e!==t?s.fail({errMsg:"rename: fail"}):fs.rename(e,t).then(()=>{s.success({errMsg:"rename: ok"})}).catch(e=>{s.fail({errMsg:`rename: failedwith error message: ${e.message}, error code: `+e.code})})}else s.fail(a.checkMsg);else s.fail(o.checkMsg)}renameSync(e,t){var o=checkPathExistenceSync("renameSync","oldPath",e);if(!o.isValid)throw new Error(o.errMsg);if(!(o=checkPathSync("renameSync","newPath",t)).isValid)throw new Error(o.errMsg);if(!(o=fs.accessSync(t))&&!fs.accessSync(obtainUpperPath(t).upperPath))throw new Error("renameSync: fail no such file or directory, open: "+t);if(o&&e!==t)throw new Error("renameSync: fail");try{fs.renameSync(e,t)}catch(e){throw new Error("renameSync: "+e.message)}}rmdir({dirPath:e,recursive:t,success:o,fail:a,complete:r}){const s=new FileCallback({success:o,fail:a,complete:r});checkDataType(t,!1,"boolean")||(t=Boolean(t)),(o=checkPathExistence("rmdir","dirPath",e)).isValid?fs.statSync(e).isDirectory()?!t&&fs.listFileSync(e).length?s.fail({errMsg:"rmdir: fail directory not empty"}):fs.rmdir(e).then(()=>{console.debug("[AdvanceAPI] rmdir succeed"),s.success({errMsg:"rmdir: ok"})}).catch(e=>{console.error(`[AdvanceAPI] rmdir failed with error message: ${e.message}, error code: `+e.code),s.fail({errMsg:"rmdir: failed"})}):s.fail({errMsg:"rmdir: fail no such directory, open: "+e}):s.fail(o.checkMsg)}rmdirSync(e,t){checkDataType(t,!1,"boolean")||(t=Boolean(t));var o=checkPathExistenceSync("rmdirSync","dirPath",e);if(!o.isValid)throw new Error(o.errMsg);if(!fs.statSync(e).isDirectory())throw new Error("rmdirSync: fail no such directory, open: "+e);if(!t&&0<fs.listFileSync(e).length)throw new Error("rmdirSync: fail directory not empty");try{fs.rmdirSync(e)}catch(e){throw new Error("rmdirSync: "+e.message)}}truncate({filePath:e,length:t,success:o,fail:a,complete:r}){const s=new FileCallback({success:o,fail:a,complete:r});(o=checkPathExistence("truncate","filePath",e)).isValid?fs.statSync(e).isDirectory()?s.fail({errMsg:"truncate: fail, illegal operation on a directory, open: "+e}):((!checkDataType(t,!0,"number")||t<0)&&(t=DEFAULT_LENGTH),fs.truncate(e,t).then(()=>{console.debug("[AdvancedAPI] truncate: success, the read length is: %d",t),s.success({errMsg:"truncate: ok"})}).catch(e=>{console.error(`[AdvancedAPI] truncate: fail with error message: ${e.message}, error code: `+e.code),s.fail({errMsg:`truncate: failed with error message: ${e.message}, error code: `+e.code})})):s.fail(o.checkMsg)}truncateSync({filePath:e,length:t}){var o=checkPathExistenceSync("truncateSync","filePath",e);if(!o.isValid)throw new Error(o.errMsg);if(fs.statSync(e).isDirectory())throw new Error("truncateSync: fail, illegal operation on a directory, open: "+e);(!checkDataType(t,!0,"number")||t<0)&&(t=DEFAULT_LENGTH);try{fs.truncateSync(e,t)}catch(e){throw new Error("truncateSync: "+e.message)}}getFileInfo({filePath:e,success:t,fail:o,complete:a}){t=new FileCallback({success:t,fail:o,complete:a}),e&&checkDataType(e,!0,"string")?fs.accessSync(e)?(o=fs.statSync(e),t.success({size:o.size,errMsg:"getFileInfo:ok "})):t.fail({errMsg:"getFileInfo: fail no such file or directory : "+e}):t.fail({errMsg:"getFileInfo:fail invalid filePath "})}}class ASFile{constructor(){this.DIGESTALGORITHM_VALUES=["MD5","SHA1"],this.saveFileDir=context.filesDir+"/saveFiles",this.fileSystemManager=new FileSystemManager,this.init()}init(){try{FileioBase.ohosMkdirSync(this.saveFileDir)}catch(e){console.debug("[AdvancedAPI] %s 已存在",this.saveFileDir)}}saveFile(e){return new Promise(async(t,o)=>{var a=e.tempFilePath;if(a)try{var r=a.substr(a.lastIndexOf("/")),s=r&&r.split(".").pop();let e=(new Date).getTime();s&&(e+="."+s);var i=getFdFromUriOrSandBoxPath(isSandboxPath(a)?fileuri.getUriFromPath(switchInternalToHapSandBox(a)):a);const n=this.saveFileDir+"/"+e;FileioBase.ohosCopy(i,n).then(()=>{console.debug("[AdvancedAPI] saveFile succeed"),t({savedFilePath:n})}).catch(e=>{console.error("[AdvancedAPI] saveFile failed with error message: "+e.message+", error code: "+e.code),o([e.message,ErrorCode$1.IO_ERROR])})}catch(e){console.error("[AdvancedAPI] tempFilePath does not exist"),o(["tempFilePath does not exist",ErrorCode$1.PARAMETER_ERROR])}else console.error("[AdvancedAPI] invalid tempFilePath."),o(["tempFilePath is required.",ErrorCode$1.PARAMETER_ERROR])})}getSavedFileList(){return new Promise((e,t)=>{var o=[],a=FileioBase.ohosOpendirSync(this.saveFileDir).ohosReadsync();for(let e=0;e<a.length;e++){var r=this.saveFileDir+"/"+a[0],s=FileioBase.ohosStatSync(r);s.isFile()&&(r={filePath:r,createTime:s.mtime,size:s.size},o.push(r))}e({fileList:o})})}getSavedFileInfo(a){return new Promise((e,t)=>{var o=a.filePath;o?(o=getFdFromUriOrSandBoxPath(isSandboxPath(o)?fileuri.getUriFromPath(switchInternalToHapSandBox(o)):o),e({createTime:(e=FileioBase.ohosStatSync(o)).mtime,size:e.size,errMsg:"getSavedFileInfo:ok"})):(console.error("[AdvancedAPI] filePath is required."),t(["filePath is required",ErrorCode$1.PARAMETER_ERROR]))})}removeSavedFile(r){return new Promise((e,t)=>{var o=r.filePath;if(o)try{var a=isSandboxPath(o)?switchInternalToHapSandBox(o):o;FileioBase.ohosUnlinkSync(a),e("success")}catch(e){t(["removeSavedFile is fail",ErrorCode$1.IO_ERROR])}else console.error("[AdvancedAPI] filePath is required."),t(["filePath is required",ErrorCode$1.PARAMETER_ERROR])})}getFileInfo(c){return new Promise((o,e)=>{var t=c.filePath;let{digestAlgorithm:a="MD5"}=c;if(t){"string"==typeof a&&(a=a.toUpperCase()),this.DIGESTALGORITHM_VALUES.includes(a)||(console.error("[AdvancedAPI] digestAlgorithm is invalid."),a="MD5");try{var r=isSandboxPath(t)?fileuri.getUriFromPath(switchInternalToHapSandBox(t)):t,s=FileioBase.ohosOpenSync(r,2).fd;const n=FileioBase.ohosStatSync(s);var i=new ArrayBuffer(n.size);FileioBase.ohosReadSync(s,i),SecurityBase.rsa(a,{data:new Uint8Array(i)}).then(e=>{var t=new util.TextDecoder("utf-8",{ignoreBOM:!0});o({size:n.size,digest:t.decodeWithStream(e,{stream:!1})})})}catch(t){console.error("[AdvancedAPI] getFileInfo fail err = "+JSON.stringify(t)),e(["getFileInfo is fail",ErrorCode$1.IO_ERROR])}}else console.error("[AdvancedAPI] filePath is required."),e(["filePath is required",ErrorCode$1.PARAMETER_ERROR])})}openDocument(a){return new Promise((e,t)=>{var{showMenu:o=!1}=a;o&&console.error("[AdvancedAPI] showMenu do not support.")})}getFileSystemManager(){return this.fileSystemManager}}const name=settings.display.SCREEN_BRIGHTNESS_STATUS;class BrightnessBase{static ohoGetValue(){try{var e=settings.getValueSync(context,name,"1");return console.log("[AdvancedAPI] success to get brightness. value:"+e),Math.round(2.55*e),e}catch(e){console.log("[QAFAPI] Failed to get brightness. Cause:"+JSON.stringify(e))}}}_dec$6=jsMethod({alias:"getValue",common:!1,callback:!0}),_dec2$4=jsMethod({alias:"setValue",common:!1,callback:!0}),_dec3$1=jsMethod({alias:"setKeepScreenOn",common:!1,callback:!0}),_applyDecoratedDescriptor((_class$6=class{getValue(){return new Promise((o,t)=>{try{window.getLastWindow(context).then(e=>{let t=e.getWindowProperties().brightness;(!t||t<0)&&(t=Number(BrightnessBase.ohoGetValue())/255),e={value:Math.round(255*t)},console.debug("[QAFAPI] getValue success, brightness = "+JSON.stringify(e)),o([e])})}catch(e){t([["Failed to get brightness"]]),console.error("Failed to obtain the window properties. Cause: "+JSON.stringify(e))}})}setValue(e){return new Promise((t,o)=>{var a,r=e.value;if(r||0===r)if(isNumber(a=r)){let e=Math.floor(a);e<0?e=1:255<e&&(e=255);const s=e/255;try{window.getLastWindow(context).then(e=>{e.setWindowBrightness(s,e=>{e.code?(o([["setWindowBrightness fail"]]),console.error("[QAFAPI] Failed to set the brightness. Cause: "+JSON.stringify(e))):(t("successed to set"),console.info("[QAFAPI] Succeeded in setting the brightness."))})})}catch(r){console.error("[QAFAPI] Failed to set setting of brightness. Cause:"+JSON.stringify(r)),o([["setWindowBrightness fail"]])}}else o([["inalid param",ErrorCode$1.PARAMETER_ERROR]]);else o([["inalid param",ErrorCode$1.PARAMETER_ERROR]])})}setKeepScreenOn(e){return new Promise((t,o)=>{if(e&&""!==e.keepScreenOn&&null!==e.keepScreenOn){const a=e.keepScreenOn;if("boolean"==typeof a)try{window.getLastWindow(context).then(e=>{e.setWindowKeepScreenOn(a,e=>{e.code?(console.error("[QAFAPI] Failed to set the screen to be always on. Cause: "+JSON.stringify(e)),o([["handling failed"]])):(t(["handling success"]),console.info("[QAFAPI] Succeeded in setting the screen to be always on."))})})}catch(e){console.error("[QAFAPI] Failed to set the screen to be always on. exception: "+JSON.stringify(e)),o([["handling failed"]])}else o([["inalid param",ErrorCode$1.PARAMETER_ERROR]])}else o([["inalid param",ErrorCode$1.PARAMETER_ERROR]])})}}).prototype,"getValue",[_dec$6],Object.getOwnPropertyDescriptor(_class$6.prototype,"getValue"),_class$6.prototype),_applyDecoratedDescriptor(_class$6.prototype,"setValue",[_dec2$4],Object.getOwnPropertyDescriptor(_class$6.prototype,"setValue"),_class$6.prototype),_applyDecoratedDescriptor(_class$6.prototype,"setKeepScreenOn",[_dec3$1],Object.getOwnPropertyDescriptor(_class$6.prototype,"setKeepScreenOn"),_class$6.prototype);let BrightnessBaseModule=_class$6;class ASBrightness extends BrightnessBaseModule{setScreenBrightness(e){if(console.info("[AdvancedAPI] params = "+JSON.stringify(e)),e&&void 0!==e.value&&"number"==typeof e.value){var t=e.value;if(t<=1&&0<=t)return this.setValue({value:Math.round(255*e.value)})}return new Promise((e,t)=>{t(["param is invalid.",ErrorCode$1.PARAMETER_ERROR])})}getScreenBrightness(){return this.getValue()}asSetKeepScreenOn(e){return this.setKeepScreenOn(e)}}class ASBuffer{arrayBufferToBase64(e){return e&&void 0!==e.byteLength?(e instanceof Uint8Array||(e=new Uint8Array(e)),buffer.allocUninitializedFromPool(e.byteLength).fill(e).toString("base64")):new Error("[AdvancedAPI] [arrayBufferToBase64] param type is not arrayBuffer")}base64ToArrayBuffer(e){var t;if("string"==typeof e)return t=buffer.byteLength(e,"base64"),buffer.allocUninitializedFromPool(t).fill(e,0,void 0,"base64").buffer}}class ASInterceptor{constructor(){this.apiLists={},this.globals=[]}addInterceptor(e,t){this.checkApiName(e)&&("string"==typeof e?(void 0===this.apiLists[e]&&(this.apiLists[e]=[]),this.apiLists[e].push(t)):"object"!=typeof e||this.globals.includes(t=e)||this.globals.push(t))}removeInterceptor(e){var t=typeof e;"string"==t?this.apiLists[e]=[]:"object"==t&&0<=(t=this.globals.indexOf(e))&&this.globals.splice(t,1)}checkApiName(e){return"addInterceptor"!==e&&"removeInterceptor"!==e}invoke(e,t){this.globals.forEach(e=>{"function"==typeof(e=e.invoke)&&e(...t)}),(this.apiLists[e]||[]).forEach(e=>{"function"==typeof(e=e.invoke)&&e(...t)})}success(e,t){const o=[];if(this.globals.forEach(e=>{"function"==typeof(e=e.success)&&o.push(e)}),(this.apiLists[e]||[]).forEach(e=>{"function"==typeof(e=e.success)&&o.push(e)}),o.length){const a=t&&JSON.parse(JSON.stringify(t));return o.forEach(e=>{e(...a)}),a}}fail(e,t){const o=[];if(this.globals.forEach(e=>{"function"==typeof(e=e.fail)&&o.push(e)}),(this.apiLists[e]||[]).forEach(e=>{"function"==typeof(e=e.fail)&&o.push(e)}),o.length){const a=t&&JSON.parse(JSON.stringify(t));return o.forEach(e=>{e(...a)}),a}}complete(e,t){const o=[];if(this.globals.forEach(e=>{"function"==typeof(e=e.complete)&&o.push(e)}),(this.apiLists[e]||[]).forEach(e=>{"function"==typeof(e=e.complete)&&o.push(e)}),o.length){const a=t&&JSON.parse(JSON.stringify(t));return o.forEach(e=>{e(...a)}),a}}returnValue(e,t){this.globals.forEach(e=>{"function"==typeof(e=e.returnValue)&&e(t)}),(this.apiLists[e]||[]).forEach(e=>{"function"==typeof(e=e.returnValue)&&e(t)})}}const SCAN_TYPE_AS_TO_HM={barCode:scanCore.ScanType.ONE_D_CODE,qrCode:scanCore.ScanType.TWO_D_CODE,datamatrix:scanCore.ScanType.DATAMATRIX_CODE,pdf417:scanCore.ScanType.PDF417_CODE};class ASScan{scanCode(i={}){return new Promise((t,o)=>{var{onlyFromCamera:e=!1,hideAlbum:a=!1,scanType:r=[]}=i,s=[];for(let e=0;e<r.length;e++){if(!SCAN_TYPE_AS_TO_HM[r[e]])return void o(["Parameter scanType invalid!",ErrorCode$1.PARAMETER_ERROR]);s.push(SCAN_TYPE_AS_TO_HM[r[e]])}if(isBoolean(e))if(isBoolean(a)){0===s.length&&s.push(scanCore.ScanType.ALL),e={scanTypes:s,enableMultiMode:!1,enableAlbum:!e&&!a};try{scanBarcode.startScan(e).then(e=>{t({result:e.originalValue,scanType:this.scanTypeHmToAs(e.scanType),rawData:gBase64.btoa(e.originalValue),charSet:"utf-8"})}).catch(e=>{o(["scanCode fail!",ErrorCode$1.COMMON_ERROR])})}catch(e){o(["scanCode fail!",ErrorCode$1.COMMON_ERROR])}}else o(["Parameter hideAlbum invalid!",ErrorCode$1.PARAMETER_ERROR]);else o(["Parameter onlyFromCamera invalid!",ErrorCode$1.PARAMETER_ERROR])})}scanTypeHmToAs(e){let t="UNKNOWN";switch(e){case scanCore.ScanType.DATAMATRIX_CODE:t="DATA_MATRIX";break;case scanCore.ScanType.PDF417_CODE:t="PDF_417";break;case scanCore.ScanType.AZTEC_CODE:t="AZTEC";break;case scanCore.ScanType.CODABAR_CODE:t="CODABAR";break;case scanCore.ScanType.CODE39_CODE:t="CODE_39";break;case scanCore.ScanType.CODE93_CODE:t="CODE_93";break;case scanCore.ScanType.CODE128_CODE:t="CODE_128";break;case scanCore.ScanType.EAN8_CODE:t="EAN_8";break;case scanCore.ScanType.EAN13_CODE:t="EAN_13";break;case scanCore.ScanType.ITF14_CODE:t="ITF";break;case scanCore.ScanType.QR_CODE:t="QR_CODE";break;case scanCore.ScanType.UPC_A_CODE:t="UPC_A";break;case scanCore.ScanType.UPC_E_CODE:t="UPC_E";break;case scanCore.ScanType.MULTIFUNCTIONAL_CODE:t="MULTIFUNCTIONAL";break;case scanCore.ScanType.ONE_D_CODE:t="CODABAR";break;case scanCore.ScanType.TWO_D_CODE:t="QR_CODE"}return t}}const asModulesMap=new Map,moduleInstance=(asModulesMap.set("ASDevice",ASDevice),asModulesMap.set("ASLocation",ASLocation),asModulesMap.set("ASNetwork",ASNetwork),asModulesMap.set("ASPhone",ASPhone),asModulesMap.set("ASClipboard",ASClipboard),asModulesMap.set("ASPrompt",ASPrompt),asModulesMap.set("ASRouter",ASRouter),asModulesMap.set("ASStorage",ASStorage),asModulesMap.set("ASRequest",ASRequest),asModulesMap.set("ASSocket",ASSocket),asModulesMap.set("ASBluetooth",ASBluetooth),asModulesMap.set("ASWindow",ASWindow),asModulesMap.set("ASBatteryInfo",ASBatteryInfo),asModulesMap.set("ASWifi",ASWifi),asModulesMap.set("ASAuthentication",ASAuthentication),asModulesMap.set("ASAccelerometer",ASAccelerometer),asModulesMap.set("ASCompass",ASCompass),asModulesMap.set("ASGyroscope",ASGyroscope),asModulesMap.set("ASContact",ASContact),asModulesMap.set("ASVibrator",ASVibrator),asModulesMap.set("ASCapture",ASCapture),asModulesMap.set("ASKeyboard",ASKeyboard),asModulesMap.set("ASAccount",ASAccount),asModulesMap.set("ASImage",ASImage),asModulesMap.set("ASBrightness",ASBrightness),asModulesMap.set("ASFile",ASFile),asModulesMap.set("ASBuffer",ASBuffer),asModulesMap.set("ASRecorder",ASRecorder),asModulesMap.set("ASAudio",ASAudio),asModulesMap.set("ASBGAudio",ASBGAudio),asModulesMap.set("ASVideo",ASViedo),asModulesMap.set("ASCamera",ASCamera),asModulesMap.set("ASInterceptor",ASInterceptor),asModulesMap.set("ASMediaFile",ASMediaFile),asModulesMap.set("ASScan",ASScan),{});function requireAPI$1(e){var t;return moduleInstance[e]||(console.debug("[AdvancedAPI] create %s",e),t=asModulesMap.get(e),moduleInstance[e]=new t),moduleInstance[e]}class CallbackManager{constructor(e){this.lastCallbackId=0,this.callbacks=[]}add(e){return this.lastCallbackId++,(this.callbacks[this.lastCallbackId]=e).__callbackId=this.lastCallbackId,this.lastCallbackId}consume(e,t,o){var a=this.callbacks[e];return void 0===o||!1===o?this.callbacks[e]=void 0:a.isKeepAlive=!0,"function"==typeof a?a(t):new Error(`invalid callback id "${e}"`)}close(){this.callbacks=this.callbacks.map(e=>{})}}const callbackManager=new CallbackManager;function interceptCallback(e,a,t=!0,o=!0){if(!(t||0!==e.length&&o))return{args:e};const r=e[0],s={};let i=!1;if("object"==typeof r&&"[object object]"===Object.prototype.toString.call(r).toLowerCase()&&1===e.length)for(const d in r){var n=r[d];"function"==typeof n?s[d]=n:i=!0}else i=!0;"function"==typeof r&&(t=!1,r.isConnected?r.cb&&(e[0]=r.cb.id):(((o=e=>{r.apply(null,e.arguments)}).originFn=r).cb=o,e[0]=o));let c;var l,o=Object.keys(s).length;if(t&&o<=0){class u{constructor(){this.promise=new Promise((e,t)=>{this.reject=t,this.resolve=e})}}c=new u}return(0<o||c)&&((l=e=>{let t=s[e.method];advancedResult(a,e);var o=triggerMethodIntercept(a,e.method,e.arguments)||e.arguments,{ignoreComplete:o=!1}=(void 0!==t&&t.apply(null,o),e);o||(o=triggerMethodIntercept(a,"complete",e.arguments)||e.arguments,void 0!==(t=s.complete)&&t.apply(null,o)),c&&(o=(o=e.arguments)&&0<o.length?o[0]:void 0,"success"===e.method||"callback"===e.method?c.resolve(o):c.reject(o))}).__onlyPromise=o<=0,i?e.push(l):e=[l]),(r&&!r.isConnected||c)&&(e=e.map(e=>normalize(e))),r&&r.cb&&(r.isConnected=!0),{args:e,promise:c,needPromise:t}}function normalize(e){var t;return"function"==typeof e?(t=callbackManager.add(e),e.id=t):e}function advancedResult(e,t){var o;"success"===t.method?(t.arguments[0]&&"object"==typeof t.arguments[0]||(t.arguments[0]={}),void 0===(o=t.arguments[0]).errMsg&&(o.errMsg=e+":ok"),void 0===o.errCode&&(o.errCode=0)):"fail"===t.method&&(o=t.arguments||[],t.arguments=[{moduleName:""+e,errMsg:e+":fail:"+o.shift(),errCode:o.shift()}])}function triggerMethodIntercept(e,t,o){var a=requireAPI("ASInterceptor");if("function"==typeof(t=a[t]))return t.call(a,e,o)}class JSCallback{constructor(e){this.id=e.id,this._valid=!0}invoke(e){this._valid?callbackManager.consume(this.id,e,e.ifKeepAlive):console.error(`[AdvancedAPI] callback ${this.id} had be destroyed.`)}invokeAndKeepAlive(e){this._valid?callbackManager.consume(this.id,e,!0):console.error(`[AdvancedAPI] callback ${this.id} had be destroyed.`)}destroy(){this.id=void 0,this._valid=!1}}const jsCallbackMap=new Map;function getSystemInfo(...e){console.debug("[AdvancedAPI] start getSystemInfo");const t=e.pop();requireAPI("ASDevice").getSystemInfo().then(e=>{t.invoke(Result.success(e))})}function getSystemInfoSync(){return console.debug("[AdvancedAPI] start getSystemInfoSync"),requireAPI("ASDevice").getSystemInfoSync()}function getDeviceInfo(...e){return console.debug("[AdvancedAPI] start getDeviceInfo"),e.pop(),e=requireAPI("ASDevice"),console.debug("[AdvancedAPI] device.getInfo"),e=e.getDeviceInfo()}function getWindowInfo(...e){return console.debug("[AdvancedAPI] start getWindowInfo"),e.pop(),requireAPI("ASDevice").getWindowInfo()}function getAppBaseInfo(...e){return console.debug("[AdvancedAPI] start getAppBaseInfo"),e.pop(),requireAPI("ASDevice").getAppBaseInfo()}function getAppAuthorizeSetting(...e){return console.debug("[AdvancedAPI] start getAppAuthorizeSetting"),e.pop(),requireAPI("ASDevice").getAppAuthorizeSetting()}function getSystemSetting(...e){return console.debug("[AdvancedAPI] start getSystemSetting"),e.pop(),e=requireAPI("ASDevice"),console.debug("[AdvancedAPI] device.getSystemSetting"),e=e.getSystemSetting()}function openAppAuthorizeSetting(...e){console.debug("[AdvancedAPI] start getSystemSetting");var e=e.pop(),t=requireAPI("ASDevice");try{t.openAppAuthorizeSetting(),e.invoke(Result.success("success"))}catch(t){e.invoke(Result.fail(["fail"],201))}}function getLocation(...e){console.debug("[AdvancedAPI] start getLocation");const o=e.pop();e=requireAPI("ASLocation"),console.debug("[AdvancedAPI] geolocation.getLocation"),e.getLocation().then(e=>{console.debug("[AdvancedAPI] geolocation.getLocation success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] geolocation.getLocation fail"),o.invoke(Result.fail([e[0][0],e[0][1]]))})}function onLocationChange(...e){console.debug("[AdvancedAPI] start onLocationChange"),e=e.pop(),requireAPI("ASLocation").onLocationChange(e)}function offLocationChange(...e){console.debug("[AdvancedAPI] start offLocationChange");const t=e.pop();(e=requireAPI("ASLocation")).offLocationChange(t),e.getLocation({timeout:5e3,coordType:"wgs86"}).then(e=>{console.debug("[AdvancedAPI] geolocation.offLocationChange callback"),t.invokeAndKeepAlive(Result.success(e))},e=>{t.invokeAndKeepAlive(Result.fail([e[0][0],e[0][1]]))})}function onLocationChangeError(...e){console.debug("[AdvancedAPI] start onLocationChangeError");const t=e.pop();requireAPI("ASLocation").onLocationChangeError(e=>{console.debug("[AdvancedAPI] geolocation.onLocationChange success"),t.invokeAndKeepAlive(Result.callback(e))})}function offLocationChangeError(...e){console.debug("[AdvancedAPI] start offLocationChangeError"),e=e.pop(),requireAPI("ASLocation").offLocationChangeError(),e.invoke(Result.success())}function startLocationUpdate(...e){console.debug("[AdvancedAPI] start startLocationUpdate");const o=e.pop();requireAPI("ASLocation").startLocationUpdate().then(e=>{console.debug("[AdvancedAPI] geolocation.startLocationUpdate success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] geolocation.startLocationUpdate fail"),o.invoke(Result.fail([e[0][0],e[0][1]]))})}function startLocationUpdateBackground(...e){console.debug("[AdvancedAPI] start startLocationUpdateBackground");const o=e.pop();requireAPI("ASLocation").startLocationUpdateBackground().then(e=>{console.debug("[AdvancedAPI] geolocation.startLocationUpdateBackground success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] geolocation.startLocationUpdateBackground fail"),o.invoke(Result.fail([e[0][0],e[0][1]]))})}function stopLocationUpdate(...e){console.debug("[AdvancedAPI] start stopLocationUpdate");const o=e.pop();requireAPI("ASLocation").stopLocationUpdate(o).then(e=>{console.debug("[AdvancedAPI] geolocation.stopLocationUpdate success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] geolocation.stopLocationUpdate fail"),o.invoke(Result.fail([e[0][0],e[0][1]]))})}function setClipboardData(...e){const t=e.pop();e=e.pop(),requireAPI("ASClipboard").setClipboardData(e).then(e=>{t.invoke(Result.success())},e=>{t.invoke(Result.fail(e))})}function getClipboardData(...e){const t=e.pop();requireAPI("ASClipboard").getClipboardData().then(e=>{t.invoke(Result.success({data:e.text}))},e=>{t.invoke(Result.fail(e))})}function getNetworkType(...e){const o=e.pop();requireAPI("ASNetwork").getType().then(e=>{o.invoke(Result.success({networkType:e[0].type}))},(e,t)=>{console.error("[AdvancedAPI] network.getNetworkType fail"+JSON.stringify(e)),o.invoke(Result.fail([e,t]))})}function onNetworkStatusChange(...e){e=e.pop(),requireAPI("ASNetwork").onSubscribe(e)}function offNetworkStatusChange(...e){e=e.pop(),requireAPI("ASNetwork").offSubscribe(e)}function makePhoneCall(...e){const t=e.pop();e=e.pop(),requireAPI("ASPhone").makePhoneCall(e).then(()=>{t.invoke(Result.success())},e=>{console.error("[AdvancedAPI] start makePhoneCall fail"),t.invoke(Result.fail([e,-1]))})}function showToast(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASPrompt").showToast(e).then(e=>{t.invoke(Result.success(e))}).catch(e=>{t.invoke(Result.fail(e))})}function showModal(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASPrompt").showDialog(e).then(e=>{t.invoke(Result.success(e))},()=>{t.invoke(Result.fail("fail"))})}function showActionSheet(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASPrompt").showContextMenu(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function navigateTo(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASRouter").navigateTo(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function redirectTo(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASRouter").redirectTo(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function reLaunch(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASRouter").reLaunch(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function navigateBack(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASRouter").navigateBack(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function setStorage(...e){console.debug("[AdvancedAPI] start setStorage");const o=e.pop();requireAPI("ASStorage").setStorage(e[0]).then(e=>{console.debug("[AdvancedAPI] storage.setStorage success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] storage.setStorage fail"),o.invoke(Result.fail([e,t]))})}function setStorageSync(...e){console.debug("[AdvancedAPI] start setStorageSync");var t={};return t.key=e[0],t.data=e[1],requireAPI("ASStorage").setStorageSync(t)}function getStorage(...e){console.debug("[AdvancedAPI] start getStorage");const o=e.pop();requireAPI("ASStorage").getStorage(e[0]).then(e=>{console.debug("[AdvancedAPI] storage.getStorage success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] storage.getStorage fail"),o.invoke(Result.fail([e,t]))})}function getStorageSync(...e){console.debug("[AdvancedAPI] start getStorageSync");var t={};return t.key=e[0],requireAPI("ASStorage").getStorageSync(t)}function getStorageInfo(...e){console.debug("[AdvancedAPI] start getStorageInfo");const o=e.pop();requireAPI("ASStorage").getStorageInfo().then(e=>{console.debug("[AdvancedAPI] storage.getStorageInfo success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] storage.getStorageInfo fail"),o.invoke(Result.fail([e,t]))})}function getStorageInfoSync(){return requireAPI("ASStorage").getStorageInfoSync()}function removeStorage(...e){console.debug("[AdvancedAPI] start removeStorage");const o=e.pop();requireAPI("ASStorage").removeStorage(e[0]).then(e=>{console.debug("[AdvancedAPI] storage.removeStorage success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] storage.removeStorage fail"),o.invoke(Result.fail([e,t]))})}function removeStorageSync(...e){return requireAPI("ASStorage").removeStorageSync(e[0])}function clearStorage(...e){console.debug("[AdvancedAPI] start removeStorage");const o=e.pop();requireAPI("ASStorage").clearStorage().then(e=>{console.debug("[AdvancedAPI] storage.removeStorage success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] storage.removeStorage fail"),o.invoke(Result.fail([e,t]))})}function clearStorageSync(){return requireAPI("ASStorage").clearStorageSync()}function request(...e){var t=e.pop(),e=e.pop(),o=requireAPI("ASRequest"),o=(console.debug("[AdvancedAPI] request"),o.request(e));if(!e||e.success||e.fail||e.complete)return e||t.invoke(Result.fail(["illegal params",-1])),o;t.invoke(Result.success(o))}function uploadFile(...e){var t=e.pop(),e=e.pop(),o=requireAPI("ASRequest"),o=(console.debug("[AdvancedAPI] uploadFile"),o.uploadFile(e));if(!e||e.success||e.fail||e.complete)return e||t.invoke(Result.fail(["illegal params",-1])),o;t.invoke(Result.success(o))}function downloadFile(...e){var t=e.pop(),e=e.pop(),o=requireAPI("ASRequest"),o=(console.debug("[AdvancedAPI] downloadFile"),o.downloadFile(e));if(!e||e.success||e.fail||e.complete)return e||t.invoke(Result.fail(["illegal params",-1])),o;t.invoke(Result.success(o))}function connectSocket(...e){var t=e.pop(),e=e.pop(),o=requireAPI("ASSocket"),o=(console.debug("[AdvancedAPI] connect socket"),o.connectSocket(e));if(e){if(!e.success&&!e.fail&&!e.complete)return void t.invoke(Result.success(o))}else t.invoke(Result.fail("connectSocket:fail Missing required parameter `url`"));return o}function sendSocketMessage(...e){var e=e.pop(),t=requireAPI("ASSocket");console.debug("[AdvancedAPI] socket send msg"),t.sendSocketMessage(e)}function closeSocket(...e){var e=e.pop(),t=requireAPI("ASSocket");console.debug("[AdvancedAPI] socket close"),t.closeSocket(e)}function onSocketOpen(...e){e=e.pop(),requireAPI("ASSocket").onSocketOpen(e)}function onSocketError(...e){e=e.pop(),requireAPI("ASSocket").onSocketError(e)}function onSocketMessage(...e){e=e.pop(),requireAPI("ASSocket").onSocketMessage(e)}function onSocketClose(...e){e=e.pop(),requireAPI("ASSocket").onSocketClose(e)}function openBluetoothAdapter(...e){const t=e.pop();requireAPI("ASBluetooth").openBluetoothAdapter().then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function closeBluetoothAdapter(...e){const t=e.pop();requireAPI("ASBluetooth").closeBluetoothAdapter().then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function startBluetoothDevicesDiscovery(...e){const t=e.pop();e=e.pop(),requireAPI("ASBluetooth").startBluetoothDevicesDiscovery(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function stopBluetoothDevicesDiscovery(...e){const t=e.pop();requireAPI("ASBluetooth").stopBluetoothDevicesDiscovery().then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function onBluetoothDeviceFound(...e){e=e.pop(),requireAPI("ASBluetooth").onBluetoothDeviceFound(e)}function offBluetoothDeviceFound(...e){e=e.pop(),requireAPI("ASBluetooth").offBluetoothDeviceFound(e)}function onBluetoothAdapterStateChange(...e){e=e.pop(),requireAPI("ASBluetooth").onBluetoothAdapterStateChange(e)}function offBluetoothAdapterStateChange(...e){e=e.pop(),requireAPI("ASBluetooth").offBluetoothAdapterStateChange(e)}function getBluetoothDevices(...e){const t=e.pop();requireAPI("ASBluetooth").getBluetoothDevices().then(e=>{e=e&&e[0]&&e[0][0]||{},t.invoke(Result.success(e))},e=>{console.info("[AdvancedAPI] getBluetoothDevices fail"+JSON.stringify(e)),t.invoke(Result.fail(...e))})}function getConnectedBluetoothDevices(...e){const t=e.pop();e=e.pop(),requireAPI("ASBluetooth").getConnectedBluetoothDevices(e).then(e=>{console.info("[AdvancedAPI] getConnectedBluetoothDevices success"+JSON.stringify(e)),t.invoke(Result.success(e))},e=>{console.info("[AdvancedAPI] getConnectedBluetoothDevices fail"+JSON.stringify(e)),t.invoke(Result.fail(...e))})}function getBluetoothAdapterState(...e){const t=e.pop();requireAPI("ASBluetooth").getBluetoothAdapterState().then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function setBLEMTU(...e){const t=e.pop();e=e.pop(),requireAPI("ASBluetooth").asSetBLEMTU(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function writeBLECharacteristicValue(...e){const t=e.pop();e=e.pop(),requireAPI("ASBluetooth").asWriteBLECharacteristicValue(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function readBLECharacteristicValue(...e){const t=e.pop();e=e.pop(),requireAPI("ASBluetooth").asReadBLECharacteristicValue(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function onBLEConnectionStateChange(...e){e=e.pop(),requireAPI("ASBluetooth").asOnBLEConnectionStateChange(e)}function offBLEConnectionStateChange(...e){e=e.pop(),requireAPI("ASBluetooth").asOffBLEConnectionStateChange(e)}function onBLECharacteristicValueChange(...e){e=e.pop(),requireAPI("ASBluetooth").asOnBLECharacteristicValueChange(e)}function offBLECharacteristicValueChange(...e){e=e.pop(),requireAPI("ASBluetooth").asOffBLECharacteristicValueChange(e)}function notifyBLECharacteristicValueChange(...e){const t=e.pop();e=e.pop(),requireAPI("ASBluetooth").asNotifyBLECharacteristicValueChange(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function getBLEDeviceServices(...e){const t=e.pop();e=e.pop(),requireAPI("ASBluetooth").asGetBLEDeviceServices(e).then(e=>{t.invoke(Result.success(e[0][0]))},e=>{t.invoke(Result.fail(...e))})}function getBLEDeviceRSSI(...e){const t=e.pop();e=e.pop(),requireAPI("ASBluetooth").asGetBLEDeviceRSSI(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function getBLEDeviceCharacteristics(...e){console.debug("[AdvancedAPI] enter getBLEDeviceCharacteristics");const t=e.pop();e=e.pop(),requireAPI("ASBluetooth").asGetBLEDeviceCharacteristics(e).then(e=>{t.invoke(Result.success(e[0]))},e=>{t.invoke(Result.fail(...e))})}function createBLEConnection(...e){const t=e.pop();var{deviceId:e,timeout:o}=e.pop()||{};requireAPI("ASBluetooth").asCreateBLEConnection({deviceId:e,timeout:o}).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function closeBLEConnection(...e){const t=e.pop();e=e.pop(),requireAPI("ASBluetooth").asCloseBLEConnection({deviceId:e?e.deviceId:void 0}).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(...e))})}function setBackgroundColor(...e){const t=e.pop();requireAPI("ASWindow").setBackgroundColor(...e).then(()=>{t.invoke(Result.success())},e=>{t.invoke(Result.fail(e))})}function getBatteryInfo(...e){const o=e.pop();requireAPI("ASBatteryInfo").asGetBatteryInfo().then(e=>{o.invoke(Result.success({level:100*e[0][0].level,isCharging:e[0][0].charging}))},(e,t)=>{o.invoke(Result.fail([e,t]))})}function startWifi(...e){const t=e.pop();requireAPI("ASWifi").startWifi().then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function stopWifi(...e){const t=e.pop();requireAPI("ASWifi").stopWifi().then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function getConnectedWifi(...e){const t=e.pop();e=e.pop(),requireAPI("ASWifi").getConnectedWifi(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function getWifiList(...e){const t=e.pop();e=e.pop(),requireAPI("ASWifi").getWifiList(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function onGetWifiList(...e){e=e.pop(),requireAPI("ASWifi").onGetWifiList(e)}function offGetWifiList(...e){e=e.pop(),requireAPI("ASWifi").offGetWifiList(e)}function connectWifi(...e){const t=e.pop();e=e.pop(),requireAPI("ASWifi").connectWifi(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function onWifiConnected(...e){e=e.pop(),requireAPI("ASWifi").onWifiConnected(e)}function offWifiConnected(...e){e=e.pop(),requireAPI("ASWifi").offWifiConnected(e)}function onWifiConnectedWithPartialInfo(...e){e=e.pop(),requireAPI("ASWifi").onWifiConnectedWithPartialInfo(e)}function offWifiConnectedWithPartialInfo(...e){e=e.pop(),requireAPI("ASWifi").offWifiConnectedWithPartialInfo(e)}function onWindowResize(...e){e=e.pop();const o=requireAPI("ASWindow");o.callbacks||(o.callbacks=[]),o.callbacks.push(e),o.onWindowResize(t=>{o.callbacks.forEach(e=>{e(t)})})}function offWindowResize(...e){var e=e.pop(),t=requireAPI("ASWindow"),o=t.callbacks.indexOf(e);0<=o?(console.debug("[AdvancedAPI] unsubscribe one"),t.callbacks.splice(o,1)):void 0===e&&(console.debug("[AdvancedAPI] unsubscribe all index = %d",o),t.callbacks=[],t.offWindowResize(()=>{console.debug("[AdvancedAPI] unsubscribe all callbacks")}))}function startSoterAuthentication(...e){console.debug("[AdvancedAPI] start startSoterAuthentication");const t=e.pop();e=e.pop(),console.debug("[AdvancedAPI] params = %s",JSON.stringify(e)),requireAPI("ASAuthentication").start(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function checkIsSupportSoterAuthentication(...e){console.debug("[AdvancedAPI] start checkIsSupportSoterAuthentication");const t=e.pop();requireAPI("ASAuthentication").getSupportedType().then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function checkIsSoterEnrolledInDevice(...e){console.debug("[AdvancedAPI] start checkIsSoterEnrolledInDevice");const t=e.pop();e=e.pop(),console.debug("[AdvancedAPI] params = %s",JSON.stringify(e)),requireAPI("ASAuthentication").isEnrolled(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function onAccelerometerChange(...e){console.debug("[AdvancedAPI] start onAccelerometerChange"),e=e.pop(),requireAPI("ASAccelerometer").onAccelerometerChange(e).then(e=>{console.debug("[AdvancedAPI] onAccelerometerChange success")},(e,t)=>{console.debug("[AdvancedAPI] onAccelerometerChange fail errMsg = %o, code = %d",e,t)})}function offAccelerometerChange(...e){console.debug("[AdvancedAPI] start offAccelerometerChange"),e=e.pop(),requireAPI("ASAccelerometer").offAccelerometerChange(e).then(e=>{console.debug("[AdvancedAPI] offAccelerometerChange success")},(e,t)=>{console.debug("[AdvancedAPI] offAccelerometerChange fail errMsg = %o, code = %d",e,t)})}function startAccelerometer(...e){console.debug("[AdvancedAPI] start startAccelerometer");const o=e.pop();requireAPI("ASAccelerometer").startAccelerometer(e[0]).then(e=>{console.debug("[AdvancedAPI] startAccelerometer success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] startAccelerometer fail errMsg = %o, code = %d",e,t),o.invoke(Result.fail([e,t]))})}function stopAccelerometer(...e){console.debug("[AdvancedAPI] start stopAccelerometer");const o=e.pop();requireAPI("ASAccelerometer").stopAccelerometer().then(e=>{console.debug("[AdvancedAPI] startAccelerometer success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] startAccelerometer fail"),o.invoke(Result.fail([e,t]))})}function onCompassChange(...e){console.debug("[AdvancedAPI] start onCompassChange"),e=e.pop(),requireAPI("ASCompass").onCompassChange(e).then(e=>{console.debug("[AdvancedAPI] onCompassChange success")},(e,t)=>{console.debug("[AdvancedAPI] onCompassChange fail errMsg = %o, code = %d",e,t)})}function offCompassChange(...e){console.debug("[AdvancedAPI] start offCompassChange"),e=e.pop(),requireAPI("ASCompass").offCompassChange(e).then(e=>{console.debug("[AdvancedAPI] offCompassChange success")},(e,t)=>{console.debug("[AdvancedAPI] offCompassChange fail errMsg = %o, code = %d",e,t)})}function startCompass(...e){console.debug("[AdvancedAPI] start startCompass");const o=e.pop();requireAPI("ASCompass").startCompass().then(e=>{console.debug("[AdvancedAPI] startCompass success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] startCompass fail"),o.invoke(Result.fail([e,t]))})}function stopCompass(...e){console.debug("[AdvancedAPI] start stopCompass");const o=e.pop();requireAPI("ASCompass").stopCompass().then(e=>{console.debug("[AdvancedAPI] stopCompass success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] stopCompass fail"),o.invoke(Result.fail([e,t]))})}function onGyroscopeChange(...e){console.debug("[AdvancedAPI] start onGyroscopeChange"),e=e.pop(),requireAPI("ASGyroscope").onGyroscopeChange(e).then(e=>{console.debug("[AdvancedAPI] onGyroscopeChange success")},(e,t)=>{console.debug("[AdvancedAPI] onGyroscopeChange fail errMsg = %o, code = %d",e,t)})}function startGyroscope(...e){console.debug("[AdvancedAPI] start startCompass");const o=e.pop();requireAPI("ASGyroscope").startGyroscope(e[0]).then(e=>{console.debug("[AdvancedAPI] startCompass success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] startCompass fail errMsg = %o, code = %d",e,t),o.invoke(Result.fail([e,t]))})}function stopGyroscope(...e){console.debug("[AdvancedAPI] start stopGyroscope");const o=e.pop();requireAPI("ASGyroscope").stopGyroscope().then(e=>{console.debug("[AdvancedAPI] stopGyroscope success"),o.invoke(Result.success(e))},(e,t)=>{console.debug("[AdvancedAPI] stopGyroscope fail errMsg = %o, code = %d",e,t),o.invoke(Result.fail([e,t]))})}function addPhoneContact(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASContact").addPhoneContact(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function vibrate(...e){const t=e.pop();requireAPI("ASVibrator").vibrate().then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function vibrateLong(...e){const t=e.pop();requireAPI("ASVibrator").vibrateLong().then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function vibrateShort(...e){const t=e.pop();requireAPI("ASVibrator").vibrateShort().then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function onUserCaptureScreen(...e){e=e.pop(),requireAPI("ASCapture").onUserCaptureScreen(e)}function offUserCaptureScreen(...e){e=e.pop(),requireAPI("ASCapture").offUserCaptureScreen(e)}function setUserCaptureScreen(...e){const t=e.pop();var o;(e=e.pop())&&"boolean"==typeof e.enable?(o=requireAPI("ASCapture"),console.debug("[AdvancedAPI] Set UserCaptureScreen to: ",e.enable),o.setUserCaptureScreen(e.enable).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})):(console.error("[AdvancedAPI] illegal params"),t.invoke(Result.fail(["illegal params",-1])))}function hideKeyboard(...e){var t=requireAPI("ASKeyboard");const o=e.pop();t.hideKeyboard().then(()=>{console.debug("[AdvancedAPI] hideKeyboard success"),o.invoke(Result.success())},(e,t)=>{console.debug("[AdvancedAPI] hideKeyboard fail, code: %d, error: %s",t,e),o.invoke(Result.fail())})}function onKeyboardHeightChange(...e){e=e.pop(),requireAPI("ASKeyboard").onKeyboardHeightChange(e)}function offKeyboardHeightChange(...e){e=e.pop(),requireAPI("ASKeyboard").offKeyboardHeightChange(e)}function getProvider(...e){var t=e.pop(),o={service:((e=e.pop())||{}).service,provider:["huawei"],providers:[]};return e&&t.invoke(Result.success([JSON.parse(JSON.stringify(o))])),"huawei"}function login(...e){const t=e.pop();var e=e.pop(),o=requireAPI("ASAccount");console.debug("[AdvancedAPI] ASAccount login"),o.login(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function getUserInfo(...e){const t=e.pop();var e=e.pop(),o=requireAPI("ASAccount");console.debug("[AdvancedAPI] ASAccount getUserInfo"),o.getUserInfo(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function chooseImage(...e){console.debug("[AdvancedAPI] start chooseImage");const t=e.pop();var o=requireAPI("ASImage"),e=e[0];o.chooseImage(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function previewImage(){}function closePreviewImage(){}function getImageInfo(...e){console.debug("[AdvancedAPI] start getImageInfo");const t=e.pop();var o=requireAPI("ASImage"),e=e[0];o.getImageInfo(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function saveImageToPhotosAlbum(...e){console.debug("[AdvancedAPI] start saveImageToPhotosAlbum");const t=e.pop();var o=requireAPI("ASImage"),e=e[0];o.saveImageToPhotosAlbum(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function compressImage(...e){console.debug("[AdvancedAPI] start compressImage");const t=e.pop();var o=requireAPI("ASImage"),e=e[0];o.compressImage(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function setScreenBrightness(...e){const t=e.pop();e=e.pop(),requireAPI("ASBrightness").setScreenBrightness(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function getScreenBrightness(...e){const t=e.pop();requireAPI("ASBrightness").getScreenBrightness().then(e=>{console.info("[AdvancedAPI] getScreenBrightness raw = "+e[0].value),e=e[0].value/255,console.info("[AdvancedAPI] getScreenBrightness = "+e),t.invoke(Result.success({value:e}))},e=>{t.invoke(Result.fail(e))})}function setKeepScreenOn(...e){const t=e.pop();e=e.pop(),requireAPI("ASBrightness").asSetKeepScreenOn(e).then(()=>{t.invoke(Result.success())},()=>{t.invoke(Result.fail())})}function saveFile(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASFile").saveFile(e).then(e=>{t.invoke(Result.success(e))}).catch(e=>{t.invoke(Result.fail(e))})}function getSavedFileList(...e){const t=e.pop();requireAPI("ASFile").getSavedFileList().then(e=>{t.invoke(Result.success(e))}).catch(e=>{t.invoke(Result.fail(e))})}function getSavedFileInfo(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASFile").getSavedFileInfo(e).then(e=>{t.invoke(Result.success(e))}).catch(e=>{t.invoke(Result.fail(e))})}function removeSavedFile(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASFile").removeSavedFile(e).then(e=>{t.invoke(Result.success(e))}).catch(e=>{t.invoke(Result.fail(e))})}function getFileInfo(...e){const t=e.pop();e=e.pop()||{},requireAPI("ASFile").getFileInfo(e).then(e=>{t.invoke(Result.success(e))}).catch(e=>{t.invoke(Result.fail(e))})}function getFileSystemManager(){return requireAPI("ASFile").getFileSystemManager()}function base64ToArrayBuffer(e){return requireAPI("ASBuffer").base64ToArrayBuffer(e)}function arrayBufferToBase64(e){return requireAPI("ASBuffer").arrayBufferToBase64(e)}function chooseFile(...e){console.debug("[AdvancedAPI] start chooseFile");const t=e.pop();var o=requireAPI("ASMediaFile"),e=e[0];o.chooseFile(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function getRecorderManager(...e){console.debug("[AdvancedAPI] start getRecorderManager"),e.pop();var t=requireAPI("ASRecorder"),e=e[0];return t.getRecorderManager(e)}function getBackgroundAudioManager(){return console.debug("[AdvancedAPI] start getBackgroundAudioManager"),requireAPI("ASBGAudio").getBackgroundAudioManager()}function createInnerAudioContext(){return console.debug("[AdvancedAPI] start createInnerAudioContext"),requireAPI("ASAudio").createInnerAudioContext()}function chooseVideo(...e){console.debug("[AdvancedAPI] start chooseVideo");const t=e.pop();var o=requireAPI("ASVideo"),e=e[0];o.chooseVideo(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function chooseMedia(...e){console.debug("[AdvancedAPI] start chooseMedia");const t=e.pop();var o=requireAPI("ASVideo"),e=e[0];o.chooseMedia(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function saveVideoToPhotosAlbum(...e){console.debug("[AdvancedAPI] start saveVideoToPhotosAlbum");const t=e.pop();var o=requireAPI("ASVideo"),e=e[0];o.saveVideoToPhotosAlbum(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function getVideoInfo(...e){console.debug("[AdvancedAPI] start getVideoInfo");const t=e.pop();var o=requireAPI("ASVideo"),e=e[0];o.getVideoInfo(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function compressVideo(){}function openVideoEditor(){}function createCameraContext(){return console.debug("[AdvancedAPI] start createCameraContext"),requireAPI("ASCamera").createCameraContext()}function scanCode(...e){console.debug("[AdvancedAPI] start scanCode");const t=e.pop();e=e[0],requireAPI("ASScan").scanCode(e).then(e=>{t.invoke(Result.success(e))},e=>{t.invoke(Result.fail(e))})}function addInterceptor(...e){requireAPI("ASInterceptor").addInterceptor(...e)}function removeInterceptor(...e){requireAPI("ASInterceptor").removeInterceptor(...e)}const asInterfaceList={getSystemInfo:{method:getSystemInfo},getSystemInfoSync:{method:getSystemInfoSync,needPromise:!1,needCallback:!1},getDeviceInfo:{method:getDeviceInfo,needPromise:!1},getWindowInfo:{method:getWindowInfo,needPromise:!1},getAppBaseInfo:{method:getAppBaseInfo,needPromise:!1},getAppAuthorizeSetting:{method:getAppAuthorizeSetting,needPromise:!1},getSystemSetting:{method:getSystemSetting,needPromise:!1},openAppAuthorizeSetting:{method:openAppAuthorizeSetting},getLocation:{method:getLocation},onLocationChange:{method:onLocationChange},offLocationChange:{method:offLocationChange,needPromise:!1},startLocationUpdate:{method:startLocationUpdate},startLocationUpdateBackground:{method:startLocationUpdateBackground},stopLocationUpdate:{method:stopLocationUpdate},onLocationChangeError:{method:onLocationChangeError},offLocationChangeError:{method:offLocationChangeError},setClipboardData:{method:setClipboardData},getClipboardData:{method:getClipboardData},getNetworkType:{method:getNetworkType},onNetworkStatusChange:{method:onNetworkStatusChange,needPromise:!1,needCallback:!1},offNetworkStatusChange:{method:offNetworkStatusChange,needPromise:!1,needCallback:!1},makePhoneCall:{method:makePhoneCall},showToast:{method:showToast},showModal:{method:showModal},showActionSheet:{method:showActionSheet},setBackgroundColor:{method:setBackgroundColor},navigateTo:{method:navigateTo},redirectTo:{method:redirectTo},reLaunch:{method:reLaunch},navigateBack:{method:navigateBack},getStorage:{method:getStorage},getStorageSync:{method:getStorageSync,needPromise:!1},setStorage:{method:setStorage},setStorageSync:{method:setStorageSync,needPromise:!1},getStorageInfo:{method:getStorageInfo},getStorageInfoSync:{method:getStorageInfoSync,needPromise:!1},removeStorage:{method:removeStorage},removeStorageSync:{method:removeStorageSync,needPromise:!1},clearStorage:{method:clearStorage},clearStorageSync:{method:clearStorageSync,needPromise:!1},request:{method:request},uploadFile:{method:uploadFile},downloadFile:{method:downloadFile},connectSocket:{method:connectSocket},sendSocketMessage:{method:sendSocketMessage,needPromise:!1,needCallback:!1},closeSocket:{method:closeSocket,needPromise:!1,needCallback:!1},onSocketOpen:{method:onSocketOpen,needPromise:!1,needCallback:!1},onSocketError:{method:onSocketError,needPromise:!1,needCallback:!1},onSocketMessage:{method:onSocketMessage,needPromise:!1,needCallback:!1},onSocketClose:{method:onSocketClose,needPromise:!1,needCallback:!1},openBluetoothAdapter:{method:openBluetoothAdapter},startBluetoothDevicesDiscovery:{method:startBluetoothDevicesDiscovery},onBluetoothDeviceFound:{method:onBluetoothDeviceFound,needPromise:!1,needCallback:!1},offBluetoothDeviceFound:{method:offBluetoothDeviceFound,needPromise:!1,needCallback:!1},stopBluetoothDevicesDiscovery:{method:stopBluetoothDevicesDiscovery},onBluetoothAdapterStateChange:{method:onBluetoothAdapterStateChange,needPromise:!1,needCallback:!1},offBluetoothAdapterStateChange:{method:offBluetoothAdapterStateChange,needPromise:!1,needCallback:!1},getConnectedBluetoothDevices:{method:getConnectedBluetoothDevices},getBluetoothAdapterState:{method:getBluetoothAdapterState},closeBluetoothAdapter:{method:closeBluetoothAdapter},getBluetoothDevices:{method:getBluetoothDevices},setBLEMTU:{method:setBLEMTU},writeBLECharacteristicValue:{method:writeBLECharacteristicValue},readBLECharacteristicValue:{method:readBLECharacteristicValue},onBLEConnectionStateChange:{method:onBLEConnectionStateChange,needPromise:!1,needCallback:!1},offBLEConnectionStateChange:{method:offBLEConnectionStateChange,needPromise:!1,needCallback:!1},onBLECharacteristicValueChange:{method:onBLECharacteristicValueChange,needPromise:!1,needCallback:!1},offBLECharacteristicValueChange:{method:offBLECharacteristicValueChange,needPromise:!1,needCallback:!1},notifyBLECharacteristicValueChange:{method:notifyBLECharacteristicValueChange},getBLEDeviceServices:{method:getBLEDeviceServices},getBLEDeviceRSSI:{method:getBLEDeviceRSSI},getBLEDeviceCharacteristics:{method:getBLEDeviceCharacteristics},createBLEConnection:{method:createBLEConnection},closeBLEConnection:{method:closeBLEConnection},getBatteryInfo:{method:getBatteryInfo},onAccelerometerChange:{method:onAccelerometerChange,needPromise:!1,needCallback:!1},offAccelerometerChange:{method:offAccelerometerChange,needPromise:!1,needCallback:!1},startAccelerometer:{method:startAccelerometer},stopAccelerometer:{method:stopAccelerometer},onCompassChange:{method:onCompassChange,needPromise:!1,needCallback:!1},offCompassChange:{method:offCompassChange,needPromise:!1,needCallback:!1},startCompass:{method:startCompass},stopCompass:{method:stopCompass},onGyroscopeChange:{method:onGyroscopeChange,needPromise:!1,needCallback:!1},startGyroscope:{method:startGyroscope},stopGyroscope:{method:stopGyroscope},startWifi:{method:startWifi},stopWifi:{method:stopWifi},getConnectedWifi:{method:getConnectedWifi},getWifiList:{method:getWifiList},onGetWifiList:{method:onGetWifiList,needPromise:!1,needCallback:!1},offGetWifiList:{method:offGetWifiList,needPromise:!1,needCallback:!1},connectWifi:{method:connectWifi},onWifiConnected:{method:onWifiConnected,needPromise:!1,needCallback:!1},offWifiConnected:{method:offWifiConnected,needPromise:!1,needCallback:!1},onWifiConnectedWithPartialInfo:{method:onWifiConnectedWithPartialInfo,needPromise:!1,needCallback:!1},offWifiConnectedWithPartialInfo:{method:offWifiConnectedWithPartialInfo,needPromise:!1,needCallback:!1},onWindowResize:{method:onWindowResize,needPromise:!1,needCallback:!1},offWindowResize:{method:offWindowResize,needPromise:!1,needCallback:!1},startSoterAuthentication:{method:startSoterAuthentication},checkIsSupportSoterAuthentication:{method:checkIsSupportSoterAuthentication},checkIsSoterEnrolledInDevice:{method:checkIsSoterEnrolledInDevice},addPhoneContact:{method:addPhoneContact},vibrate:{method:vibrate},vibrateLong:{method:vibrateLong},vibrateShort:{method:vibrateShort},onUserCaptureScreen:{method:onUserCaptureScreen,needPromise:!1,needCallback:!1},offUserCaptureScreen:{method:offUserCaptureScreen,needPromise:!1,needCallback:!1},setUserCaptureScreen:{method:setUserCaptureScreen},hideKeyboard:{method:hideKeyboard},onKeyboardHeightChange:{method:onKeyboardHeightChange,needPromise:!1,needCallback:!1},offKeyboardHeightChange:{method:offKeyboardHeightChange,needPromise:!1,needCallback:!1},getProvider:{method:getProvider,needPromise:!1},login:{method:login},getUserInfo:{method:getUserInfo},chooseImage:{method:chooseImage},previewImage:{method:previewImage},closePreviewImage:{method:closePreviewImage},getImageInfo:{method:getImageInfo},saveImageToPhotosAlbum:{method:saveImageToPhotosAlbum},compressImage:{method:compressImage},setScreenBrightness:{method:setScreenBrightness},getScreenBrightness:{method:getScreenBrightness},setKeepScreenOn:{method:setKeepScreenOn},saveFile:{method:saveFile},getSavedFileList:{method:getSavedFileList},getSavedFileInfo:{method:getSavedFileInfo},removeSavedFile:{method:removeSavedFile},getFileInfo:{method:getFileInfo},getFileSystemManager:{method:getFileSystemManager,needPromise:!1,needCallback:!1},base64ToArrayBuffer:{method:base64ToArrayBuffer,needPromise:!1,needCallback:!1},arrayBufferToBase64:{method:arrayBufferToBase64,needPromise:!1,needCallback:!1},chooseFile:{method:chooseFile},getRecorderManager:{method:getRecorderManager,needPromise:!1,needCallback:!1},getBackgroundAudioManager:{method:getBackgroundAudioManager,needPromise:!1,needCallback:!1},createInnerAudioContext:{method:createInnerAudioContext,needPromise:!1,needCallback:!1},chooseVideo:{method:chooseVideo},chooseMedia:{method:chooseMedia},saveVideoToPhotosAlbum:{method:saveVideoToPhotosAlbum},getVideoInfo:{method:getVideoInfo},compressVideo:{method:compressVideo},openVideoEditor:{method:openVideoEditor},createCameraContext:{method:createCameraContext,needPromise:!1,needCallback:!1},scanCode:{method:scanCode},addInterceptor:{method:addInterceptor,needPromise:!1,needCallback:!1},removeInterceptor:{method:removeInterceptor,needPromise:!1,needCallback:!1}};function invokeModule(e,...t){console.debug("[AdvancedAPI] invokeModule moduleName = %s",e);var o=t.pop();if("number"==typeof o){let e=jsCallbackMap.get(o);e||(e=new JSCallback({id:o}),jsCallbackMap.set(o,e)),t.push(e)}else t.push(o);return o=asInterfaceList[e],triggerInterceptInvoke(e,t),triggerInterceptReturnValue(e,o=o.method.apply(null,t)),o}function triggerInterceptInvoke(e,t){var o=requireAPI("ASInterceptor");!1!==asInterfaceList[e].needCallback&&((t=[...t]).pop(),o.invoke(e,t))}function triggerInterceptReturnValue(e,t){requireAPI("ASInterceptor").returnValue(e,t)}function createAs(){const e={};return Object.keys(asInterfaceList).forEach(o=>{Object.defineProperty(e,o,{get:()=>(...e)=>{e=(t=interceptCallback(e,o,asInterfaceList[o].needPromise,asInterfaceList[o].needCallback)).args||[];var t=t.promise,e=invokeModule(o,...e);return t?t.promise:e}})}),e}const as=createAs(),AdvancedApi={init:function(e){console.debug("[AdvancedAPI] init"),globalThis.as=as,globalThis.requireAPI=requireAPI$1,globalThis.isStageModel=!0,globalThis.abilityContext=e,media.createAVRecorder().then(e=>{globalThis.commonAvRecorder=e}),bundleManager.getBundleInfoForSelf(bundleManager.BundleFlag.GET_BUNDLE_INFO_WITH_SIGNATURE_INFO|bundleManager.BundleFlag.GET_BUNDLE_INFO_WITH_APPLICATION).then(e=>{globalThis.bundleInfoForSelf=e}),window.getLastWindow(e).then(e=>{globalThis.lastWindow=e}),initContextOnStageModel(e)}};export default AdvancedApi;export{as,createAs};
